import{r as d,u as $t,j as e,L as qs,a as Gs,N as zt,t as tn,c as an,b as ut,S as Ut,R as ke,C as nn,d as rn,e as Gt,f as K,g as de,P as Vt,h as ln,E as on,i as xt,T as Ze,k as G,l as Me,B as cn,m as dn,n as mn,O as Bt,o as un,p as Ht,q as Kt,D as Wt,A as Qt,s as Yt,v as xn,w as pn,x as re,y as hn,z as gn,U as fs,G as Rs,Z as fn,F as Qe,H as Ye,W as jn,I as Zt,M as Jt,J as yn,K as vn,Q as _n,X as ve,V as cs,Y as Xt,_ as ea,$ as bn,a0 as ie,a1 as ns,a2 as Nn,a3 as sa,a4 as us,a5 as xs,a6 as rs,a7 as wn,a8 as ta,a9 as aa,aa as $s,ab as pe,ac as na,ad as ra,ae as En,af as An,ag as ia,ah as Cn,ai as la,aj as Sn,ak as Dn,al as kn,am as qn,an as Os,ao as Ls,ap as nt,aq as Tn,ar as oa,as as In,at as Mn,au as Fn,av as Pn,aw as ca,ax as On,ay as Ln,az as Rn,aA as $n,aB as da,aC as ma,aD as ua,aE as zn,aF as Un,aG as At,aH as Gn,aI as js,aJ as Vn,aK as Bn,aL as Ct,aM as St,aN as zs,aO as Hn,aP as Dt,aQ as lt,aR as Kn,aS as Wn,aT as Qn,aU as Yn,aV as Zn,aW as Jn,aX as Xn,aY as we,aZ as xa,a_ as er,a$ as Ge,b0 as ot,b1 as Ve,b2 as Be,b3 as Pe,b4 as Us,b5 as sr,b6 as Ms,b7 as pa,b8 as kt,b9 as ha,ba as tr,bb as rt,bc as qt,bd as ar,be as nr,bf as rr,bg as ir,bh as lr,bi as or,bj as B,bk as Ke,bl as ds,bm as cr,bn as We,bo as ms,bp as vs,bq as _s,br as Ts,bs as dr,bt as Vs,bu as Je,bv as mr,bw as ga,bx as ct,by as dt,bz as Bs,bA as ur,bB as xr,bC as pr,bD as hr,bE as Tt,bF as ps,bG as It,bH as gr,bI as fr,bJ as fa,bK as jr,bL as yr,bM as ys,bN as vr,bO as _r,bP as br,bQ as De,bR as Nr,bS as wr,bT as Er,bU as Ar}from"./vendor-DpgFA11e.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function a(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=a(i);fetch(i.href,r)}})();const Cr=s=>{try{const t="ideal_body_2024",a=t+JSON.stringify(s)+t;return btoa(a)}catch(t){return console.error("Encryption error:",t),null}},Sr=s=>{try{const t="ideal_body_2024",n=atob(s).replace(new RegExp(`^${t}|${t}$`,"g"),"");return JSON.parse(n)}catch(t){return console.error("Decryption error:",t),null}},Dr=()=>{window.performance&&window.performance.clearMarks&&window.performance.clearMarks(),console.clear()},kr=s=>{const a=/[A-Z]/.test(s),n=/[a-z]/.test(s),i=/\d/.test(s),r=/[!@#$%^&*(),.?":{}|<>]/.test(s),c=[s.length>=6,a,n,i,r].filter(Boolean).length;return{isValid:s.length>=6,score:c,strength:c<2?"weak":c<4?"medium":"strong",suggestions:[s.length<6&&"كلمة المرور يجب أن تكون 6 أحرف على الأقل",!i&&"أضف أرقام لتقوية كلمة المرور",!r&&"أضف رموز خاصة لتقوية كلمة المرور"].filter(Boolean)}},qr=s=>{const t=s.replace(/[\s\-\(\)]/g,"");return/^\d+$/.test(t)?t.length<8||t.length>15?{isValid:!1,message:"رقم الهاتف يجب أن يكون بين 8-15 رقم"}:{isValid:!0,cleanPhone:t}:{isValid:!1,message:"رقم الهاتف يجب أن يحتوي على أرقام فقط"}},Mt=s=>typeof s!="string"?s:s.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"),Ft=(s,t)=>{const a=JSON.parse(localStorage.getItem("failed_login_attempts")||"{}"),n=Date.now();a[s]||(a[s]=[]),a[s].push({timestamp:n,reason:t}),a[s]=a[s].slice(-10),localStorage.setItem("failed_login_attempts",JSON.stringify(a))},Pt=s=>{const a=JSON.parse(localStorage.getItem("failed_login_attempts")||"{}")[s]||[],n=Date.now(),i=n-5*60*1e3,r=a.filter(c=>c.timestamp>i);return{count:r.length,isBlocked:r.length>=5,timeUntilUnblock:r.length>=5?Math.ceil((r[0].timestamp+5*60*1e3-n)/1e3):0}},Tr=s=>{const t=JSON.parse(localStorage.getItem("failed_login_attempts")||"{}");delete t[s],localStorage.setItem("failed_login_attempts",JSON.stringify(t))},ja=d.createContext(),ss={TOKEN:"admin_token",USER_DATA:"admin_user_data",PHONE:"admin_phone",REMEMBER_ME:"admin_remember_me"},Ir=({children:s})=>{const[t,a]=d.useState(!1),[n,i]=d.useState(null),[r,c]=d.useState(!0),x=$t(),p=h=>Cr(h),o=h=>Sr(h),j=(h,m,u,v=!1)=>{const A=v?localStorage:sessionStorage;A.setItem(ss.TOKEN,p(h)),A.setItem(ss.USER_DATA,p(m)),A.setItem(ss.PHONE,p(u)),A.setItem(ss.REMEMBER_ME,v.toString())},y=()=>{const h=localStorage.getItem(ss.REMEMBER_ME)==="true",m=h?localStorage:sessionStorage,u=m.getItem(ss.TOKEN),v=m.getItem(ss.USER_DATA),A=m.getItem(ss.PHONE);return!u||!v||!A?null:{token:o(u),userData:o(v),phone:o(A),rememberMe:h}},g=()=>{[localStorage,sessionStorage].forEach(h=>{Object.values(ss).forEach(m=>{h.removeItem(m)})})},f=(h,m,u,v=!1)=>{j(h,m,u,v),localStorage.setItem("session_start",Date.now().toString()),a(!0),i(m),x("/dashboard")},_=()=>{g(),Dr(),localStorage.removeItem("session_start"),a(!1),i(null),x("/")},q=async()=>{c(!0);try{const h=y();if(!h){c(!1);return}a(!0),i(h.userData)}catch(h){console.error("Auth check failed:",h),g()}finally{c(!1)}};d.useEffect(()=>{q()},[]),d.useEffect(()=>((()=>{const m=y();m&&!m.rememberMe&&window.addEventListener("beforeunload",g)})(),()=>{window.removeEventListener("beforeunload",g)}),[]);const b={isAuthenticated:t,user:n,isLoading:r,login:f,logout:_,getAuthData:y};return e.jsx(ja.Provider,{value:b,children:s})},Hs=()=>{const s=d.useContext(ja);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s};function $e({text:s="جاري تحميل البيانات..."}){return e.jsxs("div",{className:"flex items-center justify-center gap-2 py-8 text-secondary",children:[e.jsx(qs,{className:"animate-spin w-5 h-5"}),s]})}const Mr=({children:s})=>{const{isAuthenticated:t,isLoading:a}=Hs(),n=Gs();return a?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx($e,{size:"lg"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"جاري التحقق من بيانات المصادقة"})]})}):t?s:e.jsx(zt,{to:"/",state:{from:n},replace:!0})};function se(...s){return tn(an(s))}function F({className:s,type:t,...a}){return e.jsx("input",{type:t,"data-slot":"input",className:se("file:text-foreground rounded-full placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0  shadow  bg-gray-100 px-3 py-1 text-base  transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...a})}const pt=ut("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-secondary rounded-full transition-colors text-white cursor-pointer shadow-xs hover:bg-secondary/90",destructive:"bg-destructive rounded-full text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:" bg-background cursor-pointer border-1 border-gray-200 rounded-full shadow hover:bg-secondary/50  dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80 cursor-pointer ",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 shadow",link:"text-primary underline-offset-4 hover:underline ",Delete:" text-xs  border-destructive px-2 py-2 cursor-pointer bg-destructive/20  rounded-full flex gap-1 text-destructive hover:text-destructive/90 hover:scale-105 transition-all",Edit:" text-xs  border-primary px-2 py-2 cursor-pointer bg-primary/20  rounded-full flex gap-1 text-primary hover:text-primary/90 hover:scale-105 transition-all"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function k({className:s,variant:t,size:a,asChild:n=!1,...i}){const r=n?Ut:"button";return e.jsx(r,{"data-slot":"button",className:se(pt({variant:t,size:a,className:s})),...i})}const Fr=ut("leading-relaxed",{variants:{variant:{h2:"text-black text-base text-xl font-medium",p:"text-muted-foreground text-sm font-medium",secondary:"text-secondary  text-xs ",para:"text-muted-foreground text-xs  text-sm font-normal",md:"text-foreground text-md font-medium ",blackSmall:"text-foreground text-xs",whiteSmall:"text-background text-xs"}},defaultVariants:{variant:"blackMedium"}}),l=ke.forwardRef(({className:s,variant:t,...a},n)=>e.jsx("p",{ref:n,className:se(Fr({variant:t}),s),...a}));l.displayName="Typography";function Pr({className:s,...t}){return e.jsx(nn,{"data-slot":"checkbox",className:se("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(rn,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(Gt,{className:"size-3.5"})})})}const z="http://idealbody25.online:3118",ya=`${z}/query/auth/userImages/images`,ht=`${z}/query/managePersonalData/activities/activitiesImages/images`,gt=`${z}/query/trainings/trainingImages/images`,va=`${z}/query/exercise/exerciseFiles/images`,_a=`${z}/query/exercise/exerciseFiles/videos`,Is=`${z}/query/food/foodImages/images`,mt=`${z}/query/equipments/equipmentImages/images`,it=`${z}/query/challenges/challengesImages/images`,Or=async s=>{try{return(await K.post(`${z}/api84818auth/loginAdmin`,s)).data}catch(t){throw t}},Lr=()=>de({mutationFn:Or,onSuccess:s=>{console.log("Login successful:",s)},onError:s=>{console.error("Login failed:",s)}});function Rr(){const[s,t]=d.useState(""),[a,n]=d.useState(""),[i,r]=d.useState(!1),[c,x]=d.useState(!1),[p,o]=d.useState(""),{isAuthenticated:j,login:y}=Hs(),g=Lr();if(j)return e.jsx(zt,{to:"/dashboard",replace:!0});d.useEffect(()=>{const b=localStorage.getItem("saved_phone"),h=localStorage.getItem("remember_me")==="true";b&&h&&(t(b),r(!0))},[]);const[f,_]=d.useState({count:0,isBlocked:!1,timeUntilUnblock:0}),q=async b=>{b.preventDefault(),o("");const h=Mt(s.trim()),m=Mt(a),u=Pt(h);if(u.isBlocked){o(`تم حظر تسجيل الدخول لمدة ${Math.ceil(u.timeUntilUnblock/60)} دقيقة بسبب المحاولات المتكررة`);return}const v=qr(h);if(!v.isValid){o(v.message);return}if(!kr(m).isValid){o("كلمة المرور يجب أن تكون على الأقل 6 أحرف");return}try{const I={phone:v.cleanPhone,password:m},S=await g.mutateAsync(I);S.status==="success"?(Tr(v.cleanPhone),i?(localStorage.setItem("saved_phone",v.cleanPhone),localStorage.setItem("remember_me","true")):(localStorage.removeItem("saved_phone"),localStorage.removeItem("remember_me")),y(S.token||"dummy_token",S.data||{phone:v.cleanPhone,name:S.data?.name},v.cleanPhone,i),G.success("تم تسجيل الدخول بنجاح!")):(Ft(v.cleanPhone,"invalid_credentials"),o(S.message||"فشل في تسجيل الدخول"))}catch(I){console.error("Login error:",I),Ft(v.cleanPhone,I.response?.status||"unknown_error");let S="حدث خطأ أثناء تسجيل الدخول";I.response?.data?.message?S=I.response.data.message:I.response?.status===401?S="رقم الهاتف أو كلمة المرور غير صحيحة":I.response?.status===429?S="تم تجاوز عدد المحاولات المسموحة، يرجى المحاولة لاحقاً":navigator.onLine||(S="لا يوجد اتصال بالإنترنت"),o(S),G.error(S),_(Pt(v.cleanPhone))}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs("form",{onSubmit:q,className:"bg-white  rounded-2xl p-8 w-full max-w-md flex flex-col gap-6  shadow-md",dir:"rtl",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(l,{className:"text-2xl font-bold text-primary mb-2",children:"تسجيل الدخول"}),e.jsx("p",{className:"text-muted-foreground",children:"مرحباً بكِ مجدداً في لوحة تحكم المدربة"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{htmlFor:"phone",className:"text-sm font-medium text-secondary flex items-center gap-2",children:[e.jsx(Vt,{className:"w-4 h-4"}),"رقم الهاتف"]}),e.jsx(F,{id:"phone",type:"tel",placeholder:"05xxxxxxxx",value:s,onChange:b=>{const h=b.target.value.replace(/[^0-9]/g,"");t(h),o("")},maxLength:15,autoComplete:"tel",className:"text-left",disabled:g.isPending})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{htmlFor:"password",className:"text-sm font-medium text-secondary flex items-center gap-2",children:[e.jsx(ln,{className:"w-4 h-4"}),"كلمة المرور"]}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{id:"password",type:c?"text":"password",placeholder:"••••••••",value:a,onChange:b=>{n(b.target.value),o("")},autoComplete:"current-password",disabled:g.isPending,className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>x(!c),className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",disabled:g.isPending,children:c?e.jsx(on,{className:"w-4 h-4"}):e.jsx(xt,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Pr,{id:"remember",checked:i,onCheckedChange:r,disabled:g.isPending}),e.jsx("label",{htmlFor:"remember",className:"text-sm mx-2 font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:"تذكرني"})]}),p&&e.jsxs("div",{className:"bg-destructive/10 text-destructive text-sm rounded-lg px-3 py-2 text-center border border-destructive/20 flex items-center gap-2",children:[e.jsx(Ze,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:p})]}),f.count>0&&!f.isBlocked&&e.jsxs("div",{className:"bg-yellow-50 text-custom-yellow-text text-sm rounded-lg px-3 py-2 text-center border border-yellow-200 flex items-center gap-2",children:[e.jsx(Ze,{className:"w-4 h-4 flex-shrink-0"}),e.jsxs("span",{children:["تحذير: ",f.count," محاولة فاشلة.",5-f.count," محاولات متبقية قبل الحظر المؤقت."]})]}),e.jsx(k,{type:"submit",disabled:g.isPending,className:"w-full",children:g.isPending?e.jsx(e.Fragment,{children:"جاري تسجيل الدخول..."}):"دخول"}),e.jsx("div",{className:"flex justify-center items-center mt-4 text-xs text-muted-foreground",children:e.jsx("span",{children:"© 2025 لوحة تحكم المدربة - جميع الحقوق محفوظة"})})]})})}const $r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADcAAAA3CAYAAACo29JGAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAA+MSURBVHgB7VoJfFTVuf/uMuudfTLZt3GybwQICQECEVAkKKIoUFBUqFRw5YnSSq2t+pRS9bUqVR6Pn4BigYLgA4FCAyghsUIACRACo2HIQsIkmSWz363n3smGxQJha/vjm9/NnXvmnDPf/9u/MwG4RbfoP46wyxy7KXQ1jEjRFRppGZIwIb7wPq1ck+bDmKP/teN3/4vGSXQxcJPpqqT81IDZWxfk3DPBG+iEIE+DSkaBKsLQEPveHUldU3i4iYTDVRDDkre3eM/THs4PHjYIrZ42AF8gYdbwiYPhJgMT6GrA4ZVnqswbbSclPoZmlbiEBwyDdq8L8rRpw+BfgEjoP/FHPUftvsM+eUtgeMOkxBxjjEyFqQk5eIKhQJ95BLpYCAuS6xoT/RWuM12LyCYy//rQF7w5msh2m8/FbesoH/Rdi3RMWuKQGYdb10x/MKIoc5/ddlapHlFtVmeov3b/T7TVag3Cdaar0ZxAgnBE3zJIVTxHse8+u/P1t4TnvPiffAQhHRVJjVtSHJE+S6NOX7iitpJTSYxS+Dcg0V9LVCWmJcULdu0qe5/fO+3DI9OH3d8VKRUJsfoh93TNlXw/87PmPmsJuAF0VWY5Km5U8fMDplUmyGW8nw2xGIYTidoYzMMHHFZfY+V+x/GX3ij/vxo0lV9ctODgmPSsg0NWz3oCbhD1V4KCUGQL8n9aP9QYxQQ4mqCBxTmOwxwBN3gDPgXFylOnZ5TN7SR9q78+W+Oo87XVvjJo9lKPKrjimzM1XrgBqaK/qYAfEztuoUWjhqqOZvJgexMKfySD42g7lA6EiwEGa3ae4894mjuEBQ2OU/s+rP7COy990gYIR8/rTv0BJ2p7bPLAX6tJ9YlH/rpS9u6xzWM3NhwncR5jcKzX0s84mthlA1902GZucvz1wT/8/rjP+rsE3lA0O+yX170G7Y9Z8jPNj7789MDRuQPWzzAD2HG7v8Xa6Di3Wq40zc/RRDMMcDjSHivH5OS8qg8W7W2sUxjxiKnZ+uTbO4NeSIuIj/rk2PaNcJ3pSlMBkQzJkqcLx7267MQGC4SFQ6MLswVs9dvOVs4uNCauiJYrQSvXEl84qyeU2/ZsQ5+/8dn3m/AkaVK6SR9118SEwYlwA+hKwInJetqQiQ1ZxpimIes+/R4uNC3C5bTvo0GownDQqTXcp1/u3tvnc84WstXaWm21B1u/EZ4lEBbMdaPLBScyMitzZuX87LKYtXV/EWrH7gQugh6hHaG5I7O4Ilqq4EMsg533O3zV56r9/2TP6wpMoMsBJ4CgJ6ZOem1O5pji79sal8wuf7MKeoMROzl10uQ56WUbIqQYF2BZ4HgOFFJ5T/VSWlpKdtbVSaWEXp4dl6FkfCEVJ2MVbAhkGoUGvvmbtboaqoW517QHvFjE6lvUClrhc4w56a8Wzj2Rp438U8raB6dDbzOKDYwcmPd83vQjOVoj08kEw8LieZBKZTyG4y0aGSWXg0QJPCeR4iTOMBwCL5guL6YMSqqAGq5h7e2r5vwE+k99i/IeupjmQsMSZ30UrUu77bOjO8YA7GUfyXzghDvY/vuUtU/Ohwt9hack6l8lKNW8jw317oWYDoVCQOJ4jIdhQcjYfoYGF7rkQhSVkASHsLEcywwyppO/+fLTx5YOffaDJI1RF+IY9qKs99zwnmfhCxXqCM0vq9ZMrWqs8l8OOOjkOqboWL8y35K28Mm4kkcNEmza5PLVm7tZ7zu3I+Bc+p2n7f48XRT42W6rQppBLw8dAnsoCDZPW6DO1Vi9s6Fq4dzsyTsmxKWrkDBoizJesrR+faGb07zaKI95wsHJgOFYtJoXlI90wYt2zfPhZ1780/WMXu4gA09HxsOklMHZCNzBywFH1jRupprd9YXt7m9PHlLMiC+3O4om5T+xlgt6Pvv/2l9P7ivTE+1Hd59ylLoH6GI0PYMYxrE8Rr9dt33xiZZT6896rCcFVu9IGvfTXF20CmmHiZGYJCvs20d9UmsryE0peuEUTTO030tyXcyH7xyyZgSDA9GPOS4MUjBrYdweCEKpswOCXOii7dPFwIniR8CEeE1+cGzNXBVEm7RK03NKid77g7minXcw7gbERnaX0kArU+M7XYcX7rBu+0PXPCJFm2OZkTJmeSKl9ZukEYqltq2FH58+Yh6eMeGPUkyKevkQiROEqC1hU55DO/IkIL/tAcOJY2FwAlA1chA5SQLB8MTlgvshUMwDLW0H6lfhfdYwF25CGLAea+VBKZVDS6jtWDcwdLEPpU84nqPV05Fyk+Ldug1Fq8+cjCzNvHudlJQyiEgM+SmO1nI42gkxjuMY3xYMgQJYLMgERUMXtciHAQpC9DIBMOAU+PxeR3/Ahbn9R8AXENanRhUmK1AE3Nd66nD4I2Cnpj24ZXR0sixWEQMf2DYO/dhmlY/KLttKkQo6yIYkYozgMFFjmMA5WuWkOezJ+Ni6B7a8UiSXy3UXYUuU5s93nXRVuCoc0KdxvhJwlySG57x8175I7nxTwG6tOlEldANYlnFA4X3JRXdnaBLhvdObCt6u2cfdW/jw12oZxQSZkKRHY1hY90hxYssgYFQrJOgsxuEKBMD1Y99dEWgRbt3nNHDNwSFXdzDIH5DhgElpwLa0HfhN10f8A5Y7d5eYUuHN+vU5fzyyO3Bf8SyrllIzITpEYjgWTlCozsYxtIuwA8p/uOBX6K7HiMTlI595HQNCLwqub5zGBUQYRin01C9OrZqDzmSuD7hz3vY2TgSJsUpS6v/w4Odbaqf+6Uy9xw4mmZ76Zd0qy/raCu/EoT9rMWh0DE3TJGBdwMT2D+ld0JyY3IUBHlQkAVtb2/UaecoilgsnfsFuOQinAyG4eGkGHjfnwmzvufd/YbUeuNbgRP5CXMguxG8LFU2saSq/K1ufuarD70rK1ibxTx99N7qi+bD/roInXFGGCBZFfFJ0UkyIelhXbxu+C1oTChcBqAJFycN+P3Beb090FCNmV+RkxVQQgsGRUUDzvsDFmLsacCKw0Umjh002j3hIL1VCrb9x04t73t+/fNQbFRqFwfd4+cuRO1t9zORRP/PHmWJYpDJC0JLQNfA4Fw4eAnVpS4wIIsqwB8vFzp4QEzbHhbUlAsTCV5DkQU6QP1qCX9WhbFHc8KHz0u/db1araI1Sw2Stevj+hyzT9kTr9NbcdVPShEkTRsz3J0QncBwCBqKGuoDwYf8CUXsXAhPek0i19mCI1+AESgUhMZF3gxRzIJoT4AKgRalAD6prCk7kZVxc8e7bVCpORVKSP5/76rFYgyUhWmfi7vl8bqowqWzEMx0ZCWkSjmUx0eSw8FLRx6A3dvNcV1nF9WrSjUrMqUbD2bnlL09W4KoIIXywyBi7BQui5fD4os4K/76WwzVwDVMBn6bPKhmgj1OgNMCSCknL/HVvrxH2e6vjvTHChPHDnjqTlZilAzHp8livTLhe6SAQchlqQlB45FC3QKJqw+F0i2mAZnkwa6lOmvZV0+ATXWB8ynhU4nXAeS/DoF7RJ+yzr8Xes90Pmey3Wcapox6OQJWISaEn/ty2f3bfz8oKn61JS0hNFL4PFcJ99MT18iHeeNhTUyHWjcIzicqv0txh0HY+nNZQ09tdHHCLhjy37ZnsseODHMNrlGpsuX37nBc2vrW8W9gX47Hfv/IkKmOKhLqOkxGtL259RzgnEVohpih3SqUlyZJDIDNCZRUWLuT5niDRnexxnIBWZxsyNAZkEinISCkEgkHocDsB5UGkUTlY4uO7qyE8Qqoa3+Ru5WzOZqym+RR/p6HgpUvx2G/NGRSayGilHjY2VfwKwkKii3KmbR2cUlxMYDiHCmFc0AYvVsEodIcr3nC7Eq6zgBADTK98KXSwdPzsSWSeSDBozvNV53Lb525r22w9Amp0bBjima78iGM+2t95KR77DU6KEZRBqYF3Tqz7GD1yQzOnrMxNHjxBguMol9FE9/lluC3rBsaFPU5Eh4u5qi+FUDObhPozkpWAGx1XjFUaGiZtem3m+YBX+1TevZ9nkbHgY8KHBDhByi7FY7/BqUgZVutrqGpsbPSXZsx602LOeIRC9SLLMiSBk2KWxvjusMaLYV94iWO4GNdBR+nF5pTsCv/C+0gqElWJuIAUBkRFup/dU/Wl8H3HXMXeWIWBEubpJBRqVXyHLsVjf8CJKsnTm6kap3VxdGThbzGV9EWX1w0dne1i60ILfkRIkZSDQCEBszzqrvlwIBHMMog0RKDkjM5UwGxKgADqNQVFK0g5tHd2QACt8yCAct5s6OZz2bfLTLvqU+5HpZjfSOnoQ62HtsA1PB7s+V2tIHpo6fmZ28UQmBY9bIgF5TetVouKWzXKR6C8LSo3V62OibjDPPpO4RnUaqN4Bw1i1qTKiBiQplKlmNCYNj8+P1WlUpnC67V6FURFphlzM5BtRI4xF0XBjx+7X/I4/ko0F3puwKxlz2SPH33e676t0lWzWFi/fuRTI/c3VidoZOqzLcFz36UaMjMJL8Pds2fBkoeHzL3vvZJ5oxdXrTw6Y2zZQGv76QOdNK/K1yWYDrTVNpVZXrGM/GLe0oq7Plqysm5deUlUHl/rtCdPyy7GKm21TTP3vrbyn/BzyV+Jrui3gnh18jv5hoRUsyGuvWDto+PQkMTHK7K8TKfnSOtpp4xUttc1OwpbsLMNLZS/Zlf9/tOJuDm71nn0q+VH1u/90mUNFSgHDV9d/0U9SRr1FqWhcfmxzccMWGSBjbGfPdx89Lya0pk21VXuVpB8Xnnz4f1wo2h6xrRj7lk7+fEpKbKcuCkvRWlHmoVxuTwmCSBFBlFRFECWaL4mZH5ZsQ/cK7xXSZMyC2IfGQ4wWPAR0GoTkQnGKIX3KWhdRES6WnifGTNlUhZaH6FMGjQhc8Hs5ORkORrGdLp8XTzEK+I1WYIPXnZuvqKAEivVyL9y1Hyy3Wqlc6Pz01jaHrg7b/G2BsehDR5/MxmvLRshNahUntCwHQQuH8Uy3o70iNImN2MvkVNKKj0pLjlWVjLO6W8hqEhjEMck1TwbGJ4oVX67u63utzrK+HM8pSTT46yRORm/Nl/35Apj8ukaszFn3MlzO7ZpFYm6RveJRZfL7xX9RvZY9owtw6KSDj6++43/RtJXu1xuPkmfUez0NdcJlSGByYJSGUPwnCIOHcuyXKf3DK3F/KwrKPEA64/Vxd7O83SjP+hsDwaCnMGYksrSTk+I5E4yHedJRqmX6ShTdNDvCsilhmwWOmvlnK8pRKgLAu3+b0DBazv83zXAdaC+/4XQrfGb8U9sN+M7b9EtukW36D+Y/g4XDPEVyFQH7QAAAABJRU5ErkJggg==";Me.use(cn).use(dn).use(mn).init({fallbackLng:"en",interpolation:{escapeValue:!1},backend:{loadPath:"/locales/{{lng}}/translation.json"}});const Fs=xn,Ks=pn,zr=un,ba=d.forwardRef(({className:s,...t},a)=>e.jsx(Bt,{className:se("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:a}));ba.displayName=Bt.displayName;const bs=d.forwardRef(({className:s,...t},a)=>e.jsxs(zr,{children:[e.jsx(ba,{}),e.jsx(Ht,{ref:a,className:se("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t})]}));bs.displayName=Ht.displayName;const Ns=({className:s,...t})=>e.jsx("div",{className:se("flex flex-col space-y-2 text-center sm:text-left",s),...t});Ns.displayName="AlertDialogHeader";const ws=({className:s,...t})=>e.jsx("div",{className:se("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});ws.displayName="AlertDialogFooter";const Es=d.forwardRef(({className:s,...t},a)=>e.jsx(Kt,{ref:a,className:se("text-lg font-semibold",s),...t}));Es.displayName=Kt.displayName;const As=d.forwardRef(({className:s,...t},a)=>e.jsx(Wt,{ref:a,className:se("text-sm text-muted-foreground",s),...t}));As.displayName=Wt.displayName;const Cs=d.forwardRef(({className:s,...t},a)=>e.jsx(Qt,{ref:a,className:se(pt(),s),...t}));Cs.displayName=Qt.displayName;const Ss=d.forwardRef(({className:s,...t},a)=>e.jsx(Yt,{ref:a,className:se(pt({variant:"outline"}),"mt-2 sm:mt-0",s),...t}));Ss.displayName=Yt.displayName;const Ur=(s="")=>{const{logout:t,user:a}=Hs(),{t:n}=re(),i=()=>{t()};return e.jsxs(Fs,{children:[e.jsx(Ks,{asChild:!0,children:e.jsxs("button",{className:"flex items-center gap-2 ps-1 text-sm hover:bg-gray-100 py-3 rounded-lg cursor-pointer",children:[e.jsx(hn,{className:"w-4 h-4 mr-2"}),n("logout.button")]})}),e.jsxs(bs,{children:[e.jsxs(Ns,{className:"text-start",children:[e.jsx(Es,{className:"text-start",children:n("logout.title")}),e.jsxs(As,{children:[n("logout.description"),a?.phone&&e.jsx("span",{className:"block mt-2 text-sm font-medium",children:n("logout.current_user",{phone:a.phone})})]})]}),e.jsxs(ws,{children:[e.jsx(Ss,{children:n("logout.cancel")}),e.jsx(Cs,{onClick:i,className:"bg-destructive hover:bg-destructive/90",children:n("logout.confirm")})]})]})]})},Gr=()=>{const{t:s}=re(),t=Gs(),[a,n]=d.useState(!1),{user:i}=Hs(),r=[{title:s("sidebar.dashboard"),icon:gn,href:"/dashboard"},{title:s("sidebar.trainees"),icon:fs,href:"/dashboard/trainees"},{title:s("sidebar.coupons"),icon:Rs,href:"/dashboard/coupon"},{title:s("sidebar.challenges"),icon:fn,href:"/dashboard/challenges"},{title:s("sidebar.finance"),icon:Qe,href:"/dashboard/finance"}],c=[{title:s("sidebar.exercise"),icon:Ye,href:"/dashboard/activites"},{title:s("sidebar.equipment"),icon:jn,href:"/dashboard/equipments"},{title:s("sidebar.meals"),icon:Zt,href:"/dashboard/meals"},{title:s("sidebar.feedback"),icon:Jt,href:"/dashboard/feedback"},{title:s("sidebar.plans"),icon:yn,href:"/dashboard/plans"},{title:s("sidebar.start"),icon:vn,href:"/dashboard/StartYourMind"}],x=()=>{Me.changeLanguage(Me.language==="ar"?"en":"ar")},p=({item:o})=>{const j=t.pathname===o.href;return e.jsxs(ea,{to:o.href,className:`flex items-center gap-3 rounded-xl px-4 py-[10px] text-sm font-medium 
          ${j?"bg-gradient-to-l from-primary to-secondary text-white shadow-sm":"hover:bg-gray-100"}
        `,onClick:()=>n(!1),children:[e.jsx(o.icon,{className:`size-4 ${j?"text-white":"text-gray-700"}`}),e.jsx("span",{className:"truncate",children:o.title})]})};return d.useEffect(()=>{document.documentElement.dir=Me.language==="ar"?"rtl":"ltr",document.documentElement.lang=Me.language},[Me.language]),e.jsxs(e.Fragment,{children:[!a&&e.jsx("div",{className:`lg:hidden fixed top-4 z-[100] transition-all duration-300 
          ${Me.language==="ar"?"right-4":"left-4"}`,children:e.jsx(k,{onClick:()=>n(!0),children:e.jsx(_n,{})})}),e.jsxs("aside",{className:`
    fixed top-0 z-40 h-full bg-white border-gray-200 shadow-sm transition-transform duration-300
    min-w-[15rem]
    ${Me.language==="ar"?"right-0 border-l":"left-0 border-r"}
    ${a?"translate-x-0":Me.language==="ar"?"translate-x-full":"-translate-x-full"}
    lg:translate-x-0 lg:static lg:flex
  `,children:[e.jsx("button",{onClick:()=>n(!1),className:"lg:hidden p-2 absolute end-0 rounded-lg hover:bg-gray-100 text-gray-500",children:e.jsx(ve,{size:18})}),e.jsxs("div",{className:"flex flex-col h-full w-full",children:[e.jsx("div",{className:"flex items-center justify-between border-b border-gray-200 px-4 pt-4 pb-4 gap-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:$r,alt:"Logo",className:"shadow rounded-md size-12 object-cover"}),e.jsxs("div",{children:[e.jsx(l,{variant:"md",children:"Ideal Body"}),e.jsx(l,{variant:"para",children:s("sidebar.admimDashboard")})]})]})}),e.jsxs("div",{className:"overflow-y-auto flex-1",children:[e.jsxs("div",{className:"px-2 pt-4",children:[e.jsx("div",{className:"px-2 mb-2 text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:s("sidebar.main_menu")}),e.jsx("nav",{className:"flex flex-col gap-4",children:r.map((o,j)=>e.jsx(p,{item:o},j))})]}),e.jsxs("div",{className:"px-2 pt-6 pb-2 border-t border-gray-200 mt-4",children:[e.jsx("div",{className:"px-2 mb-2 text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:s("sidebar.content_management")}),e.jsxs("nav",{className:"flex flex-col gap-4",children:[c.map((o,j)=>e.jsx(p,{item:o},j)),e.jsx(Ur,{})]})]})]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-white font-bold text-[15px]",children:e.jsx(cs,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[e.jsx("span",{className:"text-[14px] font-medium text-gray-900 leading-tight truncate",children:i?.name||s("user.admin")}),e.jsx("span",{className:"text-xs text-gray-500 truncate",children:i?.phone||"غير محدد"})]}),e.jsxs("button",{onClick:x,className:"flex items-center gap-1 px-2 py-1 text-xs rounded-full text-foreground/80 transition-all duration-200 hover:bg-gradient-to-r hover:from-primary/10 hover:to-secondary/10 hover:shadow-md hover:text-primary group",children:[e.jsx(Xt,{className:"w-4 h-4 transition-transform duration-200 group-hover:rotate-12 group-hover:scale-110"}),e.jsx("span",{className:"font-semibold tracking-wide transition-colors duration-200",children:Me.language==="ar"?"EN":"Ar"})]})]})})]})]})]})};function Vr(){return e.jsxs("div",{className:"flex h-screen ",children:[e.jsx(Gr,{}),e.jsx("main",{className:"flex-auto overflow-auto",children:e.jsx("div",{className:"p-6 pt-16 lg:pt-5",children:e.jsx(bn,{})})})]})}function je({name:s,number:t,icon:a,Text:n,ColorOfText:i,bgText:r,para:c}){return e.jsxs("div",{className:"flex flex-col gap-2 py-5 px-4 min-w-60 shadow-md rounded-xl hover:shadow-lg border-1 border-gray-200 transform transition-transform duration-200 hover:-translate-y-1",children:[e.jsx("div",{children:e.jsx(l,{variant:"md",children:s})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{variant:"md",children:t}),e.jsx("span",{children:a})]}),e.jsxs("div",{className:"flex items-center  gap-1",children:[e.jsx("span",{className:`${r} ${i} text-sm px-2 py-0.5 rounded-lg`,children:n}),e.jsx("span",{children:e.jsx(l,{variant:"p",children:c})})]})]})}async function Br(){return(await K.post(`${z}/api84818auth/getAllUsers`)).data}async function Hr({field:s,value:t}){return(await K.post(`${z}/api84818auth/getUserData`,{field:s,value:String(t)})).data}function ft(){return ie({queryKey:["all-users"],queryFn:Br})}function Na(s,t={}){return ie({queryKey:["user",s],queryFn:()=>Hr(s),enabled:!!s?.value,...t})}function wa(){return e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded mb-2 w-1/2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded mb-4 w-1/3"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})}const Kr=()=>{const{t:s,i18n:t}=re(),a=t.language==="ar",{data:n,isLoading:i,error:r}=ft(),[c,x]=d.useState([]);d.useEffect(()=>{if(n?.data){const j=n.data,y=p(j);x(y)}},[n]);const p=j=>{const y=new Date,g=[];for(let f=3;f>=0;f--){const _=new Date(y);_.setDate(y.getDate()-f*7),_.setHours(0,0,0,0);const q=new Date(_);q.setDate(_.getDate()+6),q.setHours(23,59,59,999);const b=j.filter(m=>{const u=new Date(m.created_at);return u>=_&&u<=q}),h=a?`الأسبوع ${4-f}`:`Week ${4-f}`;g.push({week:h,subscribers:b.length,date:_})}return g},o=({active:j,payload:y,label:g})=>j&&y&&y.length?e.jsxs("div",{className:"bg-white p-3 border border-gray-200 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-gray-800",children:g}),e.jsxs("p",{className:"text-secondary",children:[a?"المشتركين":"Subscribers",": ",y[0].value]})]}):null;return i?e.jsx("div",{className:"rounded-2xl shadow-sm bg-white p-4 w-full max-w-md",children:e.jsx(wa,{})}):r?e.jsx("div",{className:"rounded-2xl shadow-sm bg-white p-4 w-full max-w-md",children:e.jsx(l,{variant:"p",className:"text-destructive",children:a?"خطأ في تحميل البيانات":"Error loading data"})}):e.jsxs("div",{className:"rounded-2xl shadow-sm bg-white p-4 w-full max-w-md transform transition-transform duration-200 hover:-translate-y-1",dir:a?"rtl":"ltr",children:[e.jsxs("div",{className:"flex items-center justify-between ",children:[e.jsxs("div",{className:a?"text-right":"text-left",children:[e.jsx(l,{variant:"md",children:s("chart.title")}),e.jsx(l,{variant:"p",children:s("chart.subtitle")})]}),e.jsx("span",{className:"text-secondary",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-7 h-7",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 12h4l3 8 4-16 3 8h4"})})})]}),e.jsx("div",{className:"h-64",children:e.jsx(ns,{width:"100%",height:"130%",children:e.jsxs(Nn,{data:c,margin:{top:10,bottom:5,left:-30,right:10},children:[e.jsx(sa,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(us,{dataKey:"week",fontSize:12,tick:{fill:"#6b7280"}}),e.jsx(xs,{fontSize:12,tick:{fill:"#6b7280",dx:a?-15:0,textAnchor:"end"},domain:[0,"auto"],tickFormatter:j=>`${j}`}),e.jsx(rs,{content:e.jsx(o,{})}),e.jsx(wn,{type:"monotone",dataKey:"subscribers",stroke:"#c34f97",strokeWidth:4,dot:{r:5,fill:"#c34f97"},activeDot:{r:8,stroke:"#c34f97",strokeWidth:2}})]})})})]})};async function Ea(){return(await K.post(`${z}/api84818datar/getDataGoal`)).data}async function Wr(){return(await K.post(`${z}/api84818datar/getAllUsersPDR`)).data}function Aa(){return ie({queryKey:["data-goal"],queryFn:Ea})}function Ca(){return ie({queryKey:["all-users-pdr"],queryFn:Wr})}function Qr(){return ie({queryKey:["data-goal-by-user"],queryFn:Ea})}const Ot=["#c34f97","#6d3fa9","#a084ca","#f3c7e6"],Yr=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"w-6 h-6 text-secondary",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",strokeWidth:"2"}),e.jsx("circle",{cx:"12",cy:"12",r:"6",strokeWidth:"2"}),e.jsx("circle",{cx:"12",cy:"12",r:"2",strokeWidth:"2",fill:"#c34f97"})]}),Zr=()=>{const{t:s,i18n:t}=re(),a=t.language==="ar",{data:n,isLoading:i,error:r}=Ca(),{data:c,isLoading:x,error:p}=Aa(),[o,j]=d.useState([]);d.useEffect(()=>{if(n?.data&&c?.data){const f=n.data,_=c.data,q=y(f,_,a);j(q)}},[n,c,t.language,a]);const y=(f,_,q)=>{const b={};f.forEach(u=>{const v=u.personalData_goal_id;v&&(b[v]=(b[v]||0)+1)});const h=f.length;return _.map((u,v)=>{const A=b[u.goal_id]||0,I=h>0?Math.round(A/h*100):0,S=q?u.goal_titleAr||u.goal_titleEn||`Goal ${u.goal_id}`:u.goal_titleEn||u.goal_titleAr||`Goal ${u.goal_id}`;return{name:u.goal_id,label:S,value:I,count:A,color:Ot[v%Ot.length]}})},g=({active:f,payload:_})=>{if(f&&_&&_.length){const q=_[0].payload;return e.jsxs("div",{className:"bg-white p-3 border border-gray-200 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-gray-800",children:q.label}),e.jsxs("p",{className:"text-secondary",children:[s("goals.percentage"),": ",q.value,"%"]}),e.jsxs("p",{className:"text-secondary",children:[s("goals.count"),": ",q.count]})]})}return null};return i||x?e.jsx("div",{className:"rounded-2xl shadow-sm bg-white p-4 w-full max-w-md",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded mb-4"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})}):r||p?e.jsx("div",{className:"rounded-2xl shadow-sm bg-white p-4 w-full max-w-md",children:e.jsx(l,{variant:"p",className:"text-destructive",children:a?"خطأ في تحميل البيانات":"Error loading data"})}):e.jsxs("div",{className:"rounded-2xl shadow-sm bg-white p-4 w-full max-w-md relative transform transition-transform duration-200 hover:-translate-y-1",dir:a?"rtl":"ltr",children:[e.jsx("span",{className:`absolute top-4 ${a?"left-4":"right-4"}`,children:e.jsx(Yr,{})}),e.jsxs("div",{className:a?"text-right":"text-left",children:[e.jsx(l,{variant:"md",children:s("goals.title")}),e.jsx(l,{variant:"p",children:s("goals.subtitle")})]}),e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx(ns,{width:"100%",height:"100%",children:e.jsxs(ta,{children:[e.jsx(aa,{data:o,dataKey:"value",nameKey:"label",cx:"50%",cy:"50%",innerRadius:45,outerRadius:85,paddingAngle:3,startAngle:90,endAngle:-270,children:o.map((f,_)=>e.jsx($s,{fill:f.color},`cell-${_}`))}),e.jsx(rs,{content:e.jsx(g,{})})]})})}),e.jsx("div",{className:"flex flex-col gap-10",children:o.map((f,_)=>e.jsxs("div",{className:"flex items-center gap-2 border-b-1 border-muted-foreground/20",children:[e.jsx("span",{className:"inline-block w-4 h-4 rounded-full",style:{backgroundColor:f.color}}),e.jsxs("span",{className:"text-md",children:[f.label," ",e.jsxs("b",{children:[f.value,"%"]})]})]},f.name))})]})};async function Jr(){return(await K.post(`${z}/api84818datar/getDataOffers`)).data}async function Xr(s){return console.log("submitData:",s),(await K.post(`${z}/api84818datar/updateDataOffers`,s)).data}async function ei(s){return(await K.post(`${z}/api84818datar/deleteDataOffers`,{offers_id:s})).data}function Ws(){return ie({queryKey:["offers"],queryFn:Jr})}function si(){const s=pe();return de({mutationFn:t=>Xr(t),onSuccess:()=>{s.invalidateQueries({queryKey:["offers"]})}})}function ti(){const s=pe();return de({mutationFn:t=>ei(t),onSuccess:()=>{s.invalidateQueries({queryKey:["offers"]})}})}const ai=async(s={})=>{try{const t={};return s.date&&(t.date=s.date),(await K.post(`${z}/api84818datafinancial/getRevenueAndPayments`,t)).data}catch(t){throw console.error("❌ Error fetching financial stats:",t),t?.response?.data||{status:"error",message:"Unexpected error occurred"}}},ni=async s=>{try{const t=`${z}/api84818datar/updatePaymentStatus`,{data:a}=await K.post(t,s);return a}catch(t){throw t}},Sa=(s={},t={})=>{const a=s?.date??null;return ie({queryKey:["financial_stats",a],queryFn:()=>ai(s),enabled:!!a,staleTime:2*60*1e3,cacheTime:5*60*1e3,...t})},ri=()=>de({mutationFn:s=>ni(s)}),ze=kn,Ue=qn,Oe=d.forwardRef(({className:s,children:t,...a},n)=>e.jsxs(na,{ref:n,className:se("flex h-10  w-full items-center justify-between rounded-full text-sm border-1 border-gray-300 bg-background px-3 py-2 text-muted-foreground ring-offset-background placeholder:text-muted-foreground focus:outline-none   disabled:cursor-not-allowed disabled:opacity-50 ",s),...a,children:[e.jsx(ra,{className:"h-4 w-4"}),t,e.jsx(En,{asChild:!0})]}));Oe.displayName=na.displayName;const Le=d.forwardRef(({className:s,children:t,...a},n)=>e.jsx(An,{children:e.jsx(ia,{ref:n,className:se("relative z-50 bg-white w-full   min-w-[8rem] overflow-hidden rounded border-1 border-gray-300 !text-start  text-multed-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a,children:e.jsx(Cn,{className:"p-1  ",children:t})})}));Le.displayName=ia.displayName;const Ce=d.forwardRef(({className:s,children:t,...a},n)=>e.jsxs(la,{ref:n,className:se("relative flex w-full  cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-secondary data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Sn,{children:e.jsx(Gt,{className:"h-4 w-4"})})}),e.jsx(Dn,{children:t})]}));Ce.displayName=la.displayName;const ii=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"w-6 h-6 text-secondary",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",strokeWidth:"2"}),e.jsx("path",{d:"M8 17h8M9 21h6",strokeWidth:"2"}),e.jsx("path",{d:"M8 7v2a4 4 0 008 0V7",strokeWidth:"2"})]}),li=()=>{const s=new Date,t=Me.language==="ar",[a,n]=d.useState(s.getFullYear().toString()),[i,r]=d.useState("all"),{data:c,isLoading:x,error:p}=Ws(),{data:o,isLoading:j,error:y,refetch:g}=Sa({date:a}),f=d.useMemo(()=>{const m=s.getFullYear()+1;return Array.from({length:m-2025+1},(u,v)=>(2025+v).toString())},[s]);d.useEffect(()=>{g?.({date:a})},[a,i,g]);const _=c?.data||[],q=o?.data?.payments||[],b=d.useMemo(()=>_.map(h=>{const m=q.filter(A=>A.payments_offerid===h.offers_id),v=(i==="all"?m:m.filter(A=>new Date(A.payments_date).getMonth()+1===Number(i))).reduce((A,I)=>A+Number(I.payments_amount_net||0),0);return{name:h.offers_titleEn.toLowerCase(),label:t?h.offers_titleAr:h.offers_titleEn,revenue:v,originalPrice:h.offers_price||0}}),[_,q,i,t]);return x||j?e.jsx("div",{className:"rounded-2xl shadow-sm bg-white p-4 w-full max-w-md",children:e.jsx(wa,{})}):p||y?e.jsx("div",{className:"rounded-2xl shadow-sm bg-white p-4 w-full max-w-md",children:e.jsx(l,{variant:"p",className:"text-destructive",children:t?"خطأ في تحميل البيانات":"Error loading data"})}):e.jsxs("div",{className:"rounded-2xl shadow-sm bg-white p-4 w-full relative transform transition-transform duration-200 hover:-translate-y-1",dir:t?"rtl":"ltr",children:[e.jsx("span",{className:`absolute top-4 ${t?"left-4":"right-4"}`,children:e.jsx(ii,{})}),e.jsxs("div",{className:t?"text-right":"text-left",children:[e.jsx(l,{variant:"md",children:t?"أداء الاشتراكات":"Subscription Performance"}),e.jsx(l,{variant:"p",children:t?"عرض الأسعار وإجمالي الإيرادات":"View prices and total revenue"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-5 mt-4 mb-4",children:[e.jsxs(ze,{value:a,onValueChange:n,children:[e.jsx(Oe,{children:e.jsx(Ue,{placeholder:t?"اختر السنة":"Select Year"})}),e.jsx(Le,{children:f.map(h=>e.jsx(Ce,{value:h,children:h},h))})]}),e.jsxs(ze,{value:i,onValueChange:r,children:[e.jsx(Oe,{children:e.jsx(Ue,{placeholder:t?"اختر الشهر":"Select Month"})}),e.jsxs(Le,{children:[e.jsx(Ce,{value:"all",children:t?"كل السنة":"All year"}),Array.from({length:12},(h,m)=>{const u=(m+1).toString().padStart(2,"0");return e.jsxs(Ce,{value:u,children:[new Date(0,m).toLocaleString(t?"ar":"en",{month:"long"})," ",a]},u)})]})]})]}),e.jsx("div",{className:"h-72 w-full xl:w-[22rem] flex items-center justify-center",children:e.jsx(ns,{width:"100%",height:"100%",children:e.jsxs(Os,{data:b,barCategoryGap:10,maxBarSize:60,children:[e.jsx(sa,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(us,{dataKey:"label",fontSize:14,axisLine:!1,tickLine:!1}),e.jsx(xs,{fontSize:13,tick:{fill:"#6b7280",dx:t?-25:-10},axisLine:!1,tickLine:!1}),e.jsx(rs,{formatter:h=>[`${h.toFixed(2)} $`,t?"إجمالي الإيرادات":"Revenue"]}),e.jsx(Ls,{dataKey:"revenue",radius:[5,5,0,0],barSize:35,children:b.map(h=>e.jsx($s,{fill:"hsl(324 58% 59%)"},h.name))})]})})}),e.jsx("div",{className:`flex ${t?"flex-row-reverse":"flex-row"} mt-4 gap-2`,children:b.map(h=>e.jsxs("div",{className:"flex flex-col min-w-15 text-center bg-gray-50 rounded-lg ",children:[e.jsx("span",{className:"text-xs font-medium mb-2",children:h.label}),e.jsx("div",{className:"text-xs font-bold text-primary-foreground",children:h.originalPrice===0?t?"مجاني":"Free":`$${h.originalPrice.toFixed(2)}`}),e.jsxs("div",{className:" pt-2 w-full",children:[e.jsx("span",{className:"text-xs text-muted-foreground block",children:t?"إجمالي الإيرادات":"Total Revenue"}),e.jsxs("span",{className:"text-accent-foreground text-xs font-bold",children:["$",h.revenue.toFixed(2)]})]})]},h.name))})]})};function Da(s,t){const a=s.map(r=>({[t("stats.name")]:r.name,[t("stats.value")]:r.number,[t("stats.change")]:r.text,[t("stats.note")]:r.para})),n=nt.json_to_sheet(a),i=nt.book_new();nt.book_append_sheet(i,n,"Stats"),Tn(i,"dashboard_stats.xlsx")}const oi=async()=>{try{return(await K.post(`${z}/api84818datar/getDataDietType`)).data}catch(s){throw s}},Ds=()=>ie({queryKey:["dietType"],queryFn:oi});function ci(){const{t:s,i18n:t}=re(),a=t.language==="ar",{data:n,isLoading:i}=ft(),{data:r,isLoading:c}=Aa(),{data:x,isLoading:p}=Ca(),{data:o,isLoading:j}=Ds(),y=n?.data||[],g=y.filter(L=>L.users_approve===1).length,f=new Date;f.setDate(f.getDate()-7);const _=y.filter(L=>new Date(L.created_at)>=f).length,q=new Date;q.setDate(q.getDate()-14);const b=new Date;b.setDate(b.getDate()-7);const h=y.filter(L=>{const W=new Date(L.created_at);return W>=q&&W<b}).length,m=y.filter(L=>{const W=new Date(L.last_log),Re=new Date;Re.setDate(Re.getDate()-14);const es=new Date;return es.setDate(es.getDate()-7),L.users_approve===1&&W>=Re&&W<es}).length,u=m>0?Math.round((g-m)/m*100):0,v=h>0?Math.round((_-h)/h*100):0,A=r?.data||[],I=x?.data||[],S={};I.forEach(L=>{const W=L.personalData_goal_id;S[W]=(S[W]||0)+1});const C=Object.keys(S).length>0?Object.keys(S).reduce((L,W)=>S[L]>S[W]?L:S[L]<S[W]?W:parseInt(L)<parseInt(W)?L:W):null,M=C?A.find(L=>L.goal_id==C):null,$=M&&(a?M.goal_titleAr:M.goal_titleEn)||s("stats.no_data"),H=C&&S[C]||0,Y=Math.max(...Object.values(S));Object.keys(S).filter(L=>S[L]===Y).length>1;const J=I.length,ae=J>0?Math.round(H/J*100):0,Se=o?.data||[],E={};I.forEach(L=>{const W=L.personalData_dietType_id;W&&(E[W]=(E[W]||0)+1)});const T=Object.keys(E).length>0?Object.keys(E).reduce((L,W)=>E[L]>E[W]?L:E[L]<E[W]?W:parseInt(L)<parseInt(W)?L:W):null,Z=T?Se.find(L=>L.diettype_id==T):null,ce=Z&&(a?Z.diettype_titleAr:Z.diettype_titleEn)||s("stats.no_data"),ge=T&&E[T]||0,D=Math.max(...Object.values(E));Object.keys(E).filter(L=>E[L]===D).length>1;const w=Object.values(E).reduce((L,W)=>L+W,0),N=w>0?Math.round(ge/w*100):0,Q=[{name:s("stats.total_active_users"),number:g,text:`${u>=0?"+":""}${u}%`,para:s("stats.vs_last_week")},{name:s("stats.weekly_signups"),number:_,text:`${v>=0?"+":""}${v}%`,para:s("stats.this_week")},{name:s("stats.most_popular_goal"),number:c||p?"...":$,text:c||p?"...":`${ae}%`,para:s("stats.of_users")},{name:s("stats.most_popular_diet"),number:j||p?"...":ce,text:j||p?"...":`${N}%`,para:s("stats.following")}];return e.jsxs("div",{className:"flex flex-col gap-10",children:[e.jsxs("div",{className:"flex flex-col text-center lg:text-start gap-5 lg:flex-row justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(l,{variant:"h2",className:"text-lg font-semibold",children:s("dashboard.title")}),e.jsx(l,{variant:"p",className:"text-sm text-muted-foreground",children:s("dashboard.subtitle")})]}),e.jsxs(k,{onClick:()=>Da(Q,s),children:[e.jsx(oa,{size:15}),e.jsx("p",{children:s("dashboard.export_report")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4",children:[e.jsx(je,{name:s("stats.total_active_users"),number:i?"...":g.toString(),icon:e.jsx(fs,{className:"bg-secondary rounded-xl p-2 text-white",size:40}),Text:i?"...":`${u>=0?"+":""}${u}%`,ColorOfText:u>=0?"text-green-600":"text-red-600",bgText:u>=0?"bg-green-100":"bg-red-100",para:s("stats.vs_last_week")}),e.jsx(je,{name:s("stats.weekly_signups"),number:i?"...":_.toString(),icon:e.jsx(In,{className:"bg-primary rounded-xl p-2 text-white",size:40}),Text:i?"...":`${v>=0?"+":""}${v}%`,ColorOfText:v>=0?"text-green-600":"text-red-600",bgText:v>=0?"bg-green-100":"bg-red-100",para:s("stats.this_week")}),e.jsx(je,{name:s("stats.most_popular_goal"),number:c||p?"...":$,icon:e.jsx(Mn,{className:"bg-accent-foreground/60 rounded-xl p-2 text-white",size:40}),Text:c||p?"...":`${ae}%`,ColorOfText:"text-accent-foreground",bgText:"bg-accent-foreground/25",para:s("stats.of_users")}),e.jsx(je,{name:s("stats.most_popular_diet"),number:j||p?"...":ce,icon:e.jsx(Zt,{className:"bg-muted rounded-xl p-2 text-white",size:40}),Text:j||p?"...":`${N}%`,ColorOfText:"text-primary",bgText:"bg-primary/20",para:s("stats.following")})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4",children:[e.jsx(Kr,{}),e.jsx(Zr,{}),e.jsx(li,{})]})]})}function Qs({className:s,...t}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto ",children:e.jsx("table",{"data-slot":"table",className:se("w-full caption-bottom text-sm",s),...t})})}function Ys({className:s,...t}){return e.jsx("thead",{"data-slot":"table-header ",className:se("[&_tr]:border-b",s),...t})}function Zs({className:s,...t}){return e.jsx("tbody",{"data-slot":"table-body",className:se("[&_tr:last-child]:border-0",s),...t})}function is({className:s,...t}){return e.jsx("tr",{"data-slot":"table-row  ",className:se("border-b-1 border-muted-foreground/20 ",s),...t})}function fe({className:s,...t}){return e.jsx("th",{"data-slot":"table-head",className:se("text-foreground  text-center h-10 px-2  align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}function oe({className:s,...t}){return e.jsx("td",{"data-slot":"table-cell",className:se("p-2 align-middle text-center  whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}function me({...s}){return e.jsx(Fn,{"data-slot":"dialog",...s})}function di({...s}){return e.jsx(Rn,{"data-slot":"dialog-portal",...s})}function ka({...s}){return e.jsx(ca,{"data-slot":"dialog-close",...s})}function mi({className:s,...t}){return e.jsx($n,{"data-slot":"dialog-overlay",className:se("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50 border-none",s),...t})}function ue({className:s,children:t,showCloseButton:a=!0,...n}){return e.jsxs(di,{"data-slot":"dialog-portal",children:[e.jsx(mi,{}),e.jsxs(Pn,{"data-slot":"dialog-content",className:se("bg-background border-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",s),...n,children:[t,a&&e.jsxs(ca,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(ve,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function ye({className:s,...t}){return e.jsx("div",{"data-slot":"dialog-header",className:se("flex flex-col gap-2 text-center sm:text-left",s),...t})}function be({className:s,...t}){return e.jsx("div",{"data-slot":"dialog-footer",className:se("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",s),...t})}function xe({className:s,...t}){return e.jsx(On,{"data-slot":"dialog-title",className:se("text-lg leading-none font-semibold",s),...t})}function Ie({className:s,...t}){return e.jsx(Ln,{"data-slot":"dialog-description",className:se("text-muted-foreground text-sm",s),...t})}const qa=zn,jt=d.forwardRef(({className:s,...t},a)=>e.jsx(da,{ref:a,className:se("inline-flex !bg-white shadow p-1 text-muted-foreground",s),...t}));jt.displayName=da.displayName;const hs=d.forwardRef(({className:s,...t},a)=>e.jsx(ma,{ref:a,className:se("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-secondary data-[state=active]:border-primary data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:rounded-full",s),...t}));hs.displayName=ma.displayName;const gs=d.forwardRef(({className:s,...t},a)=>e.jsx(ua,{ref:a,className:se("mt-2  focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t}));gs.displayName=ua.displayName;async function ui(s){return(await K.post(`${z}/api84818datar/getPDR`,{personalData_users_id:s})).data}async function xi(s){return(await K.post(`${z}/api84818auth/deleteUserById`,{users_id:String(s)})).data}function yt(s){return ie({queryKey:["personal-data",s],queryFn:()=>ui(s),enabled:!!s})}function pi(){return de({mutationFn:xi})}async function hi(){return(await K.post(`${z}/api84818datar/getDataGender`)).data}function gi(){return ie({queryKey:["gender-data"],queryFn:hi})}async function fi(){return(await K.post(`${z}/api84818datar/getDataSpecialPrograms`)).data}function ji(){return ie({queryKey:["special-programs"],queryFn:fi})}async function yi(){return(await K.post(`${z}/api84818datar/getDataTypicalDay`)).data}function vi(){return ie({queryKey:["typical-day"],queryFn:yi})}async function _i(){return(await K.post(`${z}/api84818datar/getDataActivities`)).data}function bi(){return ie({queryKey:["activity-levels"],queryFn:_i})}async function Ni(){return(await K.post(`${z}/api84818datar/getDataEnergyLevels`)).data}function wi(){return ie({queryKey:["energy-levels"],queryFn:Ni})}async function Ei(){return(await K.post(`${z}/api84818datar/getDataAreasAttention`)).data}function Ai(){return ie({queryKey:["areas-attention"],queryFn:Ei})}async function Ci(){return(await K.post(`${z}/api84818datar/getDataLastIdealWeight`)).data}function Si(){return ie({queryKey:["last-ideal-weight"],queryFn:Ci})}async function Di(){return(await K.post(`${z}/api84818datar/getDataPhysicallyActive`)).data}function ki(){return ie({queryKey:["physically-active"],queryFn:Di})}async function qi(){return(await K.post(`${z}/api84818datar/getDataSpecialEvent`)).data}function Ti(){return ie({queryKey:["special-event"],queryFn:qi})}const Ii=async()=>(await K.post(`${z}/api84818datar/getDataBadHabits`)).data,Mi=()=>ie({queryKey:["badHabits"],queryFn:Ii}),Fi=async()=>{try{return(await K.post(`${z}/api84818datar/getDataDailyWater`)).data}catch(s){throw console.error("Error fetching water data:",s),s}},Pi=()=>ie({queryKey:["waterData"],queryFn:Fi,staleTime:5*60*1e3,cacheTime:10*60*1e3}),Oi=async()=>(await K.post(`${z}/api84818datar/getDataRestNight`)).data,Li=()=>ie({queryKey:["sleepData"],queryFn:Oi,staleTime:5*60*1e3,cacheTime:10*60*1e3});async function Ri(){return(await K.post(`${z}/api84818datar/getDataBodyType`)).data}const $i={BODY_TYPES:"body_types"};function zi(){return ie({queryKey:[$i.BODY_TYPES],queryFn:Ri})}const Ui={ar:"ar-EG",en:"en-GB","ar-EG":"ar-EG","en-GB":"en-GB"};function Gi(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number"){const t=String(s).length===10?s*1e3:s,a=new Date(t);return isNaN(a.getTime())?null:a}if(typeof s=="string"){if(/^\d{10}$/.test(s)){const a=new Date(Number(s)*1e3);return isNaN(a.getTime())?null:a}const t=new Date(s);return isNaN(t.getTime())?null:t}return null}function Vi(s){const t="en-GB",a=typeof navigator<"u"?navigator.language:null;return Ui[s]||s||a||t}function ts(s,t,a={}){const n=Gi(s);if(!n)return"-";const i=Vi(t),r={year:"numeric",month:"long",day:"2-digit"},c=["hour","minute","second","timeZoneName"].some(p=>Object.prototype.hasOwnProperty.call(a,p)),x={...r,...a};return c?n.toLocaleString(i,x):n.toLocaleDateString(i,x)}function Bi({trainee:s,personalData_users_id:t}){const{t:a,i18n:n}=re(),i=n.language==="ar",r=i?"text-right":"text-left",c=i?"flex-row-reverse":"flex-row",x=i?"flex-row-reverse":"flex-row",p=i?"text-right":"text-left",{data:o}=yt(t),{data:j}=gi(),{data:y}=ji(),{data:g}=vi(),{data:f}=bi(),{data:_}=wi(),{data:q}=Ai(),{data:b}=Si(),{data:h}=ki(),{data:m}=Ti(),{data:u}=Mi(),{data:v}=Pi(),{data:A}=Li(),{data:I}=Ds(),{data:S}=zi(),C=o?.data,M=Array.isArray(j?.data)?j.data:[],$=Array.isArray(y?.data)?y.data:[],H=Array.isArray(g?.data)?g.data:[],Y=Array.isArray(f?.data)?f.data:[],ee=Array.isArray(_?.data)?_.data:[],J=Array.isArray(q?.data)?q.data:[],ae=Array.isArray(b?.data)?b.data:[],Se=Array.isArray(h?.data)?h.data:[],E=Array.isArray(m?.data)?m.data:[],T=Array.isArray(u?.data)?u.data:[],Z=Array.isArray(S?.data)?S.data:[],ce=Array.isArray(v?.data)?v.data:[],ge=Array.isArray(A?.data)?A.data:[],D=Array.isArray(I?.data)?I.data:[],X=C?.personalData_areasAttention_id,w=J.find(te=>String(te.areasattention_id)===String(X)),N=Ga(C,M,i),Q=Va(C,$,i,a),{typicalDayName:L}=Ba(C,H,i,a),W=Ha(C,Y,i),Re=Ka(C,ee,i),es=Wa(C,ae,i),za=Qa(C,Se,i),Ua=Ya(C,E,i),Xs=Za(C,T),et=Ja(C,ce),st=Xa(C,ge),tt=en(C,D);if(Et(C,Z,i),!C||M.length===0)return e.jsx($e,{});if(!s)return e.jsx("div",{className:"text-center text-destructive py-6",children:a("error_loading_user")});const Nt=C.personalData_birthdate,ls=C.personalData_currentWeight,wt=C.personalData_height,os=C.personalData_goalWeight;let Ps=null,ks=null;ls&&os&&(ls>os?(Ps=ls-os,ks="lose"):os>ls&&(Ps=os-ls,ks="gain"));function Ga(te,ne,he){if(!te||ne.length===0)return"-";const le=ne.find(Ee=>String(Ee.gender_id)===String(te.personalData_gender_id));return le?he?le.gender_nameAr:le.gender_nameEn:"-"}function Et(te,ne,he){try{if(!te?.personalData_bodyType_id||!Array.isArray(ne))return"-";const le=ne.find(Ee=>String(Ee.bodyType_id)===String(te.personalData_bodyType_id));return le?he?le.bodyType_titleAr:le.bodyType_titleEn:"-"}catch{return"-"}}function Va(te,ne,he,le){if(!te||ne.length===0)return le("trainee.special.none");const Ee=ne.find(at=>String(at.specialPrograms_id)===String(te.personalData_specialPrograms_id));return Ee?he?Ee.specialPrograms_nameAr:Ee.specialPrograms_nameEn:le("trainee.special.none")}function Ba(te,ne,he,le){let Ee=le("trainee.special.desk_job"),at=e.jsx(Zn,{className:"w-4 h-4 text-muted-foreground"});return te&&ne.length>0&&ne.find(sn=>String(sn.typicalday_id)===String(te.personalData_typicalDay_id)),{typicalDayName:Ee,typicalDayIcon:at}}function Ha(te,ne,he){if(!te||ne.length===0)return"-";const le=ne.find(Ee=>String(Ee.activities_id)===String(te.personalData_areasAttention_id));return le?he?le.activities_titleAr:le.activities_titleEn:"-"}function Ka(te,ne,he){if(!te||ne.length===0)return"-";const le=ne.find(Ee=>String(Ee.energylevels_id)===String(te.personalData_energyLevels_id));return le?he?le.energylevels_titleAr:le.energylevels_titleEn:"-"}function Wa(te,ne,he){if(!te||ne.length===0)return"-";const le=ne.find(Ee=>String(Ee.lastidealweight_id)===String(te.personalData_lastIdealWeight_id));return le?he?le.lastidealweight_titleAr:le.lastidealweight_titleEn:"-"}function Qa(te,ne,he){if(!te||ne.length===0)return"-";const le=ne.find(Ee=>String(Ee.physicallyactive_id)===String(te.personalData_physicallyActive_id));return le?he?le.physicallyactive_titleAr:le.physicallyactive_titleEn:"-"}function Ya(te,ne,he){if(!te||ne.length===0)return"-";const le=ne.find(Ee=>String(Ee.specialevent_id)===String(te.personalData_specialEvent_id));return le?he?le.specialevent_titleAr:le.specialevent_titleEn:"-"}function Za(te,ne){return!te||ne.length===0?null:ne.find(he=>String(he.badHabits_id)===String(te.personalData_badHabits_id))}function Ja(te,ne){return!te||ne.length===0?null:ne.find(he=>String(he.dailywater_id)===String(te.personalData_dailyWater_id))}function Xa(te,ne){return!te||ne.length===0?null:ne.find(he=>String(he.restnight_id)===String(te.personalData_restNight_id))}function en(te,ne){return!te||ne.length===0?null:ne.find(he=>String(he.diettype_id)===String(te.personalData_dietType_id))}return e.jsxs("div",{className:"space-y-6",children:[e.jsx(as,{title:a("trainee.personal_info.title"),icon:e.jsx(cs,{className:"w-5 h-5"}),align:r,flexDir:c,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ne,{icon:e.jsx(cs,{size:16,className:"text-secondary"}),label:a("trainee.personal_info.gender"),value:N,flexDirection:x,textAlign:p}),e.jsx(Ne,{icon:e.jsx(Vt,{size:16,className:"text-secondary"}),label:a("trainee.personal_info.phone"),value:s.users_phone||"-",flexDirection:x,textAlign:p}),e.jsx(Ne,{icon:e.jsx(Un,{size:16,className:"text-secondary"}),label:a("trainee.personal_info.birthday"),value:Nt?ts(Nt,n.language):"-",flexDirection:x,textAlign:p}),e.jsx(Ne,{icon:e.jsx(cs,{size:16,className:"text-secondary"}),label:a("trainee.personal_info.body_type"),value:C?Et(C,Z,i):"-",flexDirection:x,textAlign:p})]})}),e.jsx(as,{title:a("trainee.measurements.title"),icon:e.jsx(At,{className:"w-5 h-5"}),align:r,flexDir:c,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ne,{icon:e.jsx(At,{size:16,className:"text-secondary"}),label:a("trainee.measurements.height"),value:wt?`${wt} cm`:"-",flexDirection:x,textAlign:p}),e.jsx(Ne,{icon:e.jsx(Gn,{size:16,className:"text-secondary"}),label:a("trainee.measurements.current_weight"),value:ls?`${ls} kg`:"-",flexDirection:x,textAlign:p}),e.jsx(Ne,{icon:e.jsx(js,{size:16,className:"text-secondary"}),label:a("trainee.measurements.target_weight"),value:os?`${os} kg`:"-",flexDirection:x,textAlign:p}),ks&&Ps!==null&&e.jsx(Ne,{icon:e.jsx(Vn,{size:16,className:"text-secondary"}),label:a(ks==="lose"?"trainee.measurements.weight_to_lose":"trainee.measurements.weight_to_gain"),value:`${Ps} kg`,flexDirection:x,textAlign:p,valueClassName:ks==="lose"?"text-destructive font-medium":"text-accent-foreground font-medium"})]})}),e.jsx(as,{title:a("trainee.special.title"),icon:e.jsx(Ze,{className:"w-5 h-5"}),align:r,flexDir:c,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ne,{icon:e.jsx(Ze,{size:16,className:"text-secondary"}),label:a("trainee.special.programs_needed"),value:Q,flexDirection:x,textAlign:p}),e.jsx(Ne,{icon:e.jsx(Bn,{size:16,className:"text-secondary"}),label:a("trainee.special.daily_activity"),value:L,flexDirection:x,textAlign:p})]})}),e.jsx(as,{title:a("energy_activity.title"),icon:e.jsx(Ct,{className:"w-5 h-5"}),align:r,flexDir:c,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ne,{icon:e.jsx(Ct,{size:16,className:"text-secondary"}),label:a("energy_activity.daily_energy_levels"),value:Re,flexDirection:x,textAlign:p}),e.jsx(Ne,{icon:e.jsx(St,{size:16,className:"text-secondary"}),label:a("energy_activity.physical_activity_level"),value:za,flexDirection:x,textAlign:p})]})}),e.jsx(as,{title:a("focus_areas.title"),icon:e.jsx(Hn,{className:"w-5 h-5"}),align:r,flexDir:c,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ne,{icon:e.jsx(js,{size:16,className:"text-secondary"}),label:a("focus_areas.attention_area"),value:w?i?w.areasattention_titleAr:w.areasattention_titleEn:"-",flexDirection:x,textAlign:p}),e.jsx(Ne,{icon:e.jsx(St,{size:16,className:"text-secondary"}),label:a("energy_activity.activity_level_api"),value:W,flexDirection:x,textAlign:p}),e.jsx(Ne,{icon:e.jsx(zs,{size:16,className:"text-secondary"}),label:a("focus_areas.event_motivation"),value:Ua,flexDirection:x,textAlign:p})]})}),e.jsx(as,{title:a("weight_history.title"),icon:e.jsx(Dt,{className:"w-5 h-5"}),align:r,flexDir:c,children:e.jsx("div",{className:"space-y-4",children:e.jsx(Ne,{icon:e.jsx(Dt,{size:16,className:"text-secondary"}),label:a("weight_history.last_ideal_weight"),value:es,flexDirection:x,textAlign:p})})}),e.jsx(as,{title:a("weight_history.bad_habits"),icon:e.jsx(lt,{className:"w-5 h-5"}),align:r,flexDir:c,children:e.jsx("div",{className:"space-y-4",children:e.jsx(Ne,{icon:e.jsx(lt,{size:16,className:"text-secondary"}),label:a("weight_history.bad_habits"),value:Xs?e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium bg-destructive/20 text-destructive",children:i?Xs.badHabits_titleAr:Xs.badHabits_titleEn}):e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium bg-destructive/60 text-destructive",children:"-"}),flexDirection:x,textAlign:p})})}),e.jsx(as,{title:a("health_lifestyle.title","Health & Lifestyle"),icon:e.jsx(Yn,{className:"w-5 h-5"}),align:r,flexDir:c,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ne,{icon:e.jsx(Kn,{size:16,className:"text-secondary"}),label:a("health_lifestyle.sleep_quality"),value:st?i?st.restnight_titleAr:st.restnight_titleEn:a("health_lifestyle.good"),flexDirection:x,textAlign:p}),e.jsx(Ne,{icon:e.jsx(Wn,{size:16,className:"text-secondary"}),label:a("dashboard.water_intake","Water Intake"),value:et?i?et.dailywater_titleAr:et.dailywater_titleEn:"-",flexDirection:x,textAlign:p}),e.jsx(Ne,{icon:e.jsx(Qn,{size:16,className:"text-secondary"}),label:a("dashboard.diet_type"),value:tt?i?tt.diettype_titleAr:tt.diettype_titleEn:"-",flexDirection:x,textAlign:p})]})})]})}function as({title:s,icon:t,children:a}){const{i18n:n}=re(),i=n.language==="ar",r=i?"flex-row-reverse":"flex-row",c=i?"text-right":"text-left";return e.jsxs("div",{className:"bg-white flex flex-col gap-3 rounded-2xl shadow-lg p-6 max-w-md mx-auto",children:[e.jsxs("div",{className:`flex items-center gap-2 text-muted-foreground ${r}`,children:[t,e.jsx(l,{variant:"md",className:c,children:s})]}),a]})}function Ne({icon:s,label:t,value:a,flexDirection:n,textAlign:i,valueClassName:r=""}){return e.jsxs("div",{className:`flex items-center ${n} justify-between p-3 rounded-lg bg-muted-foreground/5  shadow `,children:[e.jsxs("div",{className:`flex items-center gap-3  ${n}`,children:[e.jsx("div",{className:"w-8 h-8 bg-secondary/15  rounded-full flex items-center justify-center",children:s}),e.jsx(l,{variant:"p",className:`font-medium text-secondary ${i}`,children:t})]}),e.jsx(l,{variant:"para",className:`${i} ${r}`,children:a})]})}const Hi=async s=>(console.log("userData",s),(await K.post(`${z}/api84818datatrainings/getDataTraining`,s)).data),Ki=async s=>(await K.post(`${z}/api84818datatrainings/insertUserTraining`,s)).data,Wi=async s=>(await K.post(`${z}/api84818datatrainings/deleteUserTraining`,s)).data,Qi=({personalData_users_id:s,training_activities_id:t,trainings_id:a=[]})=>ie({queryKey:["userTrainings",s,t,a],queryFn:()=>Hi({personalData_users_id:s,training_activities_id:t,trainings_id:a}),enabled:!!s&&!!t,select:n=>n.data}),Yi=()=>{const s=pe();return de({mutationFn:Ki,onSuccess:(t,a)=>{s.invalidateQueries({queryKey:["userTrainings"]})}})},Zi=()=>{const s=pe();return de({mutationFn:Wi,onSuccess:()=>{s.invalidateQueries({queryKey:["userTrainings"]})}})};async function Ji(s){return(await K.post(`${z}/api84818datatrainings/getTrainingsByActivityId`,{activite_id:s})).data}async function Xi(s){return(await K.post(`${z}/api84818datatrainings/insertDataTraining`,s)).data}async function el(s){return(await K.post(`${z}/api84818datatrainings/deleteDataTraining`,{trainings_id:s})).data}async function sl(s){return(await K.post(`${z}/api84818datatrainings/updateDataTraining`,s)).data}function Ta(s){return ie({queryKey:["trainings-by-activity",s],queryFn:()=>Ji(s),enabled:!!s,staleTime:5*60*1e3,cacheTime:10*60*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1})}function tl(s){const t=pe();return de({mutationFn:Xi,onSuccess:()=>{t.invalidateQueries({queryKey:["trainings-by-activity",s]})}})}function al(){const s=pe();return de({mutationFn:el,onSuccess:(t,a)=>{s.invalidateQueries({queryKey:["trainings-by-activity"]})}})}function nl(){const s=pe();return de({mutationFn:sl,onSuccess:(t,a)=>{s.invalidateQueries({queryKey:["trainings-by-activity"]})}})}const rl=ut("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-white hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function il({className:s,variant:t,...a}){return e.jsx("div",{className:se(rl({variant:t}),s),...a})}function He({className:s,...t}){return e.jsx(Jn,{"data-slot":"label",className:se("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...t})}const Ae=d.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:se("rounded-lg  bg-white text-card-foreground ",s),...t}));Ae.displayName="Card";const Fe=d.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:se("flex flex-col space-y-1.5 p-6",s),...t}));Fe.displayName="CardHeader";const qe=d.forwardRef(({className:s,...t},a)=>e.jsx("h3",{ref:a,className:se("text-2xl font-semibold leading-none tracking-tight",s),...t}));qe.displayName="CardTitle";const ll=d.forwardRef(({className:s,...t},a)=>e.jsx("p",{ref:a,className:se("text-sm text-muted-foreground",s),...t}));ll.displayName="CardDescription";const Te=d.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:se("p-6 pt-0",s),...t}));Te.displayName="CardContent";const Ia=d.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:se("flex items-center p-6 pt-0",s),...t}));Ia.displayName="CardFooter";function ol({personalData:s,availableTrainings:t,daysOfWeek:a,t:n,i18n:i}){const[r,c]=d.useState(""),[x,p]=d.useState(""),o=Yi(),j=y=>{if(y.preventDefault(),!r||!x){G.error(n("workouts_tab.toasts.select_training_and_day"));return}o.mutate({user_id:s.personalData_users_id,training_id:r,daysOfWeek_id:x},{onSuccess:()=>{G.success(n("workouts_tab.toasts.add_success")),c(""),p("")},onError:g=>{G.error(`${n("workouts_tab.toasts.add_error")} ${g.message}`)}})};return e.jsxs(Ae,{className:"mb-6",children:[e.jsx(Fe,{children:e.jsx(qe,{className:"text-center",children:e.jsx(l,{variant:"md",children:n("workouts_tab.assign_new_training")})})}),e.jsx(Te,{children:e.jsxs("form",{onSubmit:j,className:"grid grid-cols-1 gap-4 ",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(He,{htmlFor:"training-select",children:e.jsx(l,{variant:"para",children:n("workouts_tab.select_training_plan")})}),e.jsxs(ze,{onValueChange:c,value:r,children:[e.jsx(Oe,{id:"training-select",children:e.jsx(Ue,{placeholder:n("workouts_tab.choose_training_plan")})}),e.jsx(Le,{children:t?.map(y=>e.jsx(Ce,{value:String(y.trainings_id),children:i.language==="ar"?y.trainings_nameAr:y.trainings_nameEn},y.trainings_id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(He,{htmlFor:"day-select",children:e.jsx(l,{variant:"para",children:n("workouts_tab.select_day")})}),e.jsxs(ze,{onValueChange:p,value:x,children:[e.jsx(Oe,{id:"day-select",children:e.jsx(Ue,{placeholder:n("workouts_tab.choose_day")})}),e.jsx(Le,{children:a.map(y=>e.jsx(Ce,{value:String(y.id),children:y.name},y.id))})]})]}),e.jsx(k,{className:"w-fit",type:"submit",disabled:o.isLoading,children:o.isLoading?n("workouts_tab.assigning_training_button"):n("workouts_tab.assign_training_button")})]})})]})}function cl({personalData:s}){const{t,i18n:a}=re(),n=[{id:1,name:t("workouts_tab.days.sunday")},{id:2,name:t("workouts_tab.days.monday")},{id:3,name:t("workouts_tab.days.tuesday")},{id:4,name:t("workouts_tab.days.wednesday")},{id:5,name:t("workouts_tab.days.thursday")},{id:6,name:t("workouts_tab.days.friday")},{id:7,name:t("workouts_tab.days.saturday")}],[i,r]=d.useState(null),c=Zi(),x=_=>{r(_)},p=()=>{i&&c.mutate({id:i.id},{onSuccess:()=>{G.success(t("workouts_tab.toasts.delete_success")),r(null)},onError:_=>{G.error(t("workouts_tab.toasts.delete_error")),console.error("Delete error:",_)}})},{data:o,isLoading:j,isError:y}=Qi({personalData_users_id:s?.personalData_users_id,training_activities_id:s?.personalData_activities_id});console.log("userTrainings",o);const{data:g,isLoading:f}=Ta(s?.personalData_activities_id);return j||f?e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx(qs,{className:"animate-spin"})}):e.jsx(Fs,{open:!!i,onOpenChange:_=>!_&&r(null),children:e.jsxs("div",{className:"",children:[e.jsx(ol,{personalData:s,availableTrainings:g?.data,daysOfWeek:n,t,i18n:a}),e.jsx("div",{className:"flex-center mb-4",children:e.jsx(l,{className:"text-center",variant:"md",children:t("workouts_tab.weekly_plan_title")})}),o&&o.length>0?e.jsx("div",{className:"grid grid-cols-2 gap-4",children:n.map(_=>{const q=o.filter(b=>b.daysOfWeek_id===_.id);return e.jsxs(Ae,{className:"flex flex-col  transition-all duration-300 shadow hover:shadow-lg hover:border-primary/50",children:[e.jsx(Fe,{className:"flex-row  items-center justify-between p-4   bg-primary/80 rounded-t-xl text-center",children:e.jsx(qe,{children:e.jsx(l,{variant:"whiteSmall",children:_.name})})}),e.jsx(Te,{className:"p-4  flex flex-col",children:q.length>0?e.jsx("ul",{className:"space-y-2 flex-1  ",children:q.map(b=>e.jsxs("li",{className:"group relative shadow p-2  rounded-md transition-colors ",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:`${gt}/${b.trainings_img}`,alt:a.language==="ar"?b.trainings_nameAr:b.trainings_nameEn,className:"w-12 h-12 object-cover rounded-full border-2 border-white shadow-sm"}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx(l,{variant:"para",children:a.language==="ar"?b.trainings_nameAr:b.trainings_nameEn}),e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center mt-1",children:[e.jsx(Xn,{className:"w-3 h-3 me-1.5"}),ts(b.assigned_at,a.language)]})]})]}),e.jsx(Ks,{asChild:!0,children:e.jsx(k,{variant:"delete",size:"icon",className:"absolute -top-3 -start-3 w-7 h-7 rounded-full bg-destructive/10 hover:bg-destructive/20 transition-colors",onClick:()=>x(b),children:e.jsx(we,{className:"w-3 h-3 text-destructive"})})})]},b.id))}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center text-muted-foreground",children:[e.jsx(xa,{className:"w-10 h-10 mb-2 text-gray-300 dark:text-gray-600"}),e.jsx("p",{className:"text-sm font-medium",children:t("workouts_tab.no_training_scheduled")}),e.jsx("p",{className:"text-xs",children:t("workouts_tab.assign_workout_for_day")})]})})]},_.id)})}):e.jsxs("div",{className:"text-center p-12 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:t("workouts_tab.no_workouts_assigned_title")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:t("workouts_tab.no_workouts_assigned_desc")})]}),e.jsxs(bs,{children:[e.jsxs(Ns,{children:[e.jsx(Es,{children:t("workouts_tab.delete_dialog_title")}),e.jsx(As,{children:t("workouts_tab.delete_dialog_desc")})]}),e.jsxs(ws,{children:[e.jsx(Ss,{children:t("common.cancel")}),e.jsx(Cs,{onClick:p,disabled:c.isLoading,children:c.isLoading?e.jsx(qs,{className:"w-4 h-4 animate-spin"}):t("common.delete")})]})]})]})})}const dl=async s=>(await K.post(`${z}/api84818datafood/getUserFoods`,{user_id:s})).data,ml=async s=>(await K.post(`${z}/api84818datafood/insertUserFood`,s)).data,ul=async s=>{console.log("🔥 deleteUserFood API - called with id:",s);const t=await K.post(`${z}/api84818datafood/deleteUserFood`,{id:s});return console.log("🔥 deleteUserFood API - response:",t.data),t.data},xl=s=>ie({queryKey:["userFoodData",s],queryFn:()=>dl(s),staleTime:5*60*1e3,cacheTime:10*60*1e3,enabled:!!s}),pl=()=>{const s=pe();return de({mutationFn:ml,onSuccess:()=>{s.invalidateQueries({queryKey:["userFoodData"]})}})},hl=()=>{const s=pe();return de({mutationFn:t=>(console.log("🔥 useDeleteUserFood - mutationFn called with id:",t),ul(t)),onSuccess:()=>{console.log("🔥 useDeleteUserFood - onSuccess called"),s.invalidateQueries({queryKey:["userFoodData"]})},onError:t=>{console.log("🔥 useDeleteUserFood - onError called:",t)}})},gl=async()=>(await K.post(`${z}/api84818datafood/getAllFood`)).data.data,fl=async s=>(await K.post(`${z}/api84818datafood/insertDataFood`,s)).data,jl=async s=>(await K.post(`${z}/api84818datafood/updateDataFood`,s)).data,yl=async s=>(await K.post(`${z}/api84818datafood/deleteDataFood`,s)).data,Ma=()=>ie({queryKey:["meals"],queryFn:gl,staleTime:1e3*60*5,cacheTime:1e3*60*10,refetchOnWindowFocus:!1}),vl=()=>{const s=pe();return de({mutationFn:fl,onSuccess:()=>{s.invalidateQueries({queryKey:["meals"]})}})},_l=()=>{const s=pe();return de({mutationFn:t=>jl(t),onSuccess:()=>{s.invalidateQueries({queryKey:["allMeals"]})},onError:t=>{console.error("فشل تحديث الوجبة:",t)}})},bl=()=>{const s=pe();return de({mutationFn:t=>yl({food_id:t}),onSuccess:()=>{s.invalidateQueries({queryKey:["meals"]})},onError:t=>{console.error("❌ خطأ في الحذف:",t)}})};function Nl({personalData_users_id:s,availableMeals:t,daysOfWeek:a,t:n,i18n:i}){const[r,c]=d.useState(""),[x,p]=d.useState(""),o=pl(),j=y=>{if(y.preventDefault(),!r||!x){G.error(n("meals_tab.toasts.select_meal_and_day"));return}o.mutate({user_id:s,food_id:r,daysOfWeek_id:x},{onSuccess:()=>{G.success(n("meals_tab.toasts.add_success")),c(""),p("")},onError:g=>{G.error(`${n("meals_tab.toasts.add_error")} ${g.message}`)}})};return e.jsxs(Ae,{className:"mb-6",children:[e.jsx(Fe,{children:e.jsx(qe,{className:"text-center",children:e.jsx(l,{variant:"md",children:n("meals_tab.assign_new_meal")})})}),e.jsx(Te,{children:e.jsxs("form",{onSubmit:j,className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(He,{htmlFor:"meal-select",children:e.jsx(l,{variant:"para",children:n("meals_tab.select_meal_plan")})}),e.jsxs(ze,{onValueChange:c,value:r,children:[e.jsx(Oe,{id:"meal-select",children:e.jsx(Ue,{placeholder:n("meals_tab.choose_meal_plan")})}),e.jsx(Le,{children:t?.map(y=>e.jsx(Ce,{value:String(y.food_id),children:i.language==="ar"?y.food_nameAr:y.food_nameEn},y.food_id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(He,{htmlFor:"day-select",children:e.jsx(l,{variant:"para",children:n("meals_tab.select_day")})}),e.jsxs(ze,{onValueChange:p,value:x,children:[e.jsx(Oe,{id:"day-select",children:e.jsx(Ue,{placeholder:n("meals_tab.choose_day")})}),e.jsx(Le,{children:a.map(y=>e.jsx(Ce,{value:String(y.id),children:y.name},y.id))})]})]}),e.jsx(k,{className:"w-fit",type:"submit",disabled:o.isLoading,children:o.isLoading?n("meals_tab.assigning_meal_button"):n("meals_tab.assign_meal_button")})]})})]})}function wl({personalData_users_id:s,personalDataRes:t}){const{t:a,i18n:n}=re(),i=Me.language==="ar",r=[{id:1,name:a("meals_tab.days.sunday")},{id:2,name:a("meals_tab.days.monday")},{id:3,name:a("meals_tab.days.tuesday")},{id:4,name:a("meals_tab.days.wednesday")},{id:5,name:a("meals_tab.days.thursday")},{id:6,name:a("meals_tab.days.friday")},{id:7,name:a("meals_tab.days.saturday")}],[c,x]=d.useState(null),p=hl(),o=v=>{x(v)},j=()=>{!c||!c.id||(console.log("🔥 handleConfirmDelete - mealToDelete.id:",c.id),p.mutate(c.id,{onSuccess:()=>{console.log("🔥 handleConfirmDelete - onSuccess"),G.success(a("meals_tab.toasts.delete_success")),x(null)},onError:v=>{console.log("🔥 handleConfirmDelete - onError:",v),G.error(a("meals_tab.toasts.delete_error")),x(null)}}))},{data:y,isLoading:g,error:f}=xl(s),{data:_}=Ma(),{data:q}=Ds();if(g)return e.jsx("div",{className:"p-6 text-center",children:"Loading..."});if(f)return e.jsx("div",{className:"p-6 text-center text-destructive",children:"Error occurred"});const b=Number(t.data.personalData_dietType_id),h=q?.data.find(v=>Number(v.diettype_id)===b),m=_?.filter(v=>Number(v.food_diettype_id)===h?.diettype_id)||[],u=y?.data?.map(v=>({..._?.find(S=>S.food_id===v.food_id),...v}))||[];return g?e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx(qs,{className:"animate-spin"})}):e.jsx(Fs,{open:!!c,onOpenChange:v=>{v||x(null)},children:e.jsxs("div",{className:"p-6",children:[h&&e.jsx("div",{className:"mb-6",children:e.jsx(l,{variant:"h2",className:"text-center",children:i?h.diettype_titleAr:h.diettype_titleEn})}),e.jsx(Nl,{personalData_users_id:s,availableMeals:m,daysOfWeek:r,t:a,i18n:n}),e.jsx("div",{className:"flex-center mb-4",children:e.jsx(l,{className:"text-center",variant:"md",children:a("meals_tab.weekly_plan_title")})}),u&&u.length>0?e.jsx("div",{className:"grid grid-cols-2 gap-4",children:r.map(v=>{const A=u.filter(I=>I.daysOfWeek_id===v.id);return e.jsxs(Ae,{className:"flex flex-col transition-all duration-300 shadow hover:shadow-lg hover:border-primary/50",children:[e.jsx(Fe,{className:"flex-row items-center justify-between p-4 bg-primary/80 rounded-t-xl text-center",children:e.jsx(qe,{children:e.jsx(l,{variant:"whiteSmall",children:v.name})})}),e.jsx(Te,{className:"p-4 flex flex-col",children:A.length>0?e.jsx("ul",{className:"space-y-2 flex-1",children:A.map(I=>e.jsxs("li",{className:"group relative shadow p-2 rounded-md transition-colors",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0",children:[e.jsx("img",{src:`${Is}/${I.food_img}`,alt:i?I.food_nameAr:I.food_nameEn,className:"w-full h-full object-cover",onError:S=>{S.target.style.display="none",S.target.nextSibling.style.display="flex"}}),e.jsx("div",{className:"w-full h-full bg-primary/10 rounded-full flex items-center justify-center",style:{display:"none"},children:e.jsx(l,{variant:"para",className:"text-primary font-bold text-xs",children:i?"وجبة":"Meal"})})]}),e.jsx("div",{className:"flex-1",children:e.jsx(l,{variant:"para",className:"font-semibold",children:i?I.food_nameAr:I.food_nameEn})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-1 text-xs bg-gray-50 dark:bg-gray-800 p-2 rounded",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-custom-yellow-text",children:I.food_kcal||0}),e.jsx("div",{className:"text-muted-foreground",children:i?"سعرة":"Cal"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-semibold text-primary-foreground",children:[I.food_carbs||0,"g"]}),e.jsx("div",{className:"text-muted-foreground",children:i?"كارب":"Carb"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-semibold text-accent-foreground",children:[I.food_protein||0,"g"]}),e.jsx("div",{className:"text-muted-foreground",children:i?"بروتين":"Protein"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-semibold text-primary",children:[I.food_fat||0,"g"]}),e.jsx("div",{className:"text-muted-foreground",children:i?"دهون":"Fat"})]})]})]}),e.jsx(Ks,{asChild:!0,children:e.jsx(k,{variant:"delete",size:"icon",className:"absolute -top-3 -start-3 w-7 h-7 rounded-full bg-destructive/10 hover:bg-destructive/20 transition-colors",onClick:()=>o(I),children:e.jsx(we,{className:"w-3 h-3 text-destructive"})})})]},I.id))}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center text-muted-foreground",children:[e.jsx(xa,{className:"w-10 h-10 mb-2 text-gray-300 dark:text-gray-600"}),e.jsx("p",{className:"text-sm font-medium text-start",children:a("meals_tab.no_meal_scheduled")}),e.jsx("p",{className:"text-xs",children:a("meals_tab.assign_meal_for_day")})]})})]},v.id)})}):e.jsxs("div",{className:" p-12  border-gray-300  rounded-lg rtl:text-end ltr:text",children:[e.jsx(l,{variant:"md",children:a("meals_tab.no_meals_assigned_title")}),e.jsx(l,{variant:"para",children:a("meals_tab.no_meals_assigned_desc")})]}),e.jsxs(bs,{children:[e.jsxs(Ns,{children:[e.jsx(Es,{className:"text-start",children:a("meals_tab.delete_dialog_title")}),e.jsx(As,{className:"text-start",children:a("meals_tab.delete_dialog_desc")})]}),e.jsxs(ws,{children:[e.jsx(Ss,{children:a("common.cancel")}),e.jsx(Cs,{onClick:j,disabled:p.isLoading,children:p.isLoading?e.jsx(qs,{className:"w-4 h-4 animate-spin"}):a("common.delete")})]})]})]})})}function El({users_id:s,trainees:t,onClose:a}){const{t:n,i18n:i}=re(),r=i.language==="ar",[c,x]=d.useState(!1),p=t.find(C=>C.users_id===s),o=p?.users_approve===1,{data:j}=yt(s),y=j?.data,g=y?.personalData_goal_id,{data:f}=Qr(),q=(Array.isArray(f?.data)?f.data:[]).find(C=>String(C.goal_id)===String(g)),b=r?q?.goal_titleAr:q?.goal_titleEn;let h={};b==="Lose Weight"||b==="اخسر الوزن"?h={borderColor:"var(--secondary)",color:"var(--secondary)",background:"rgba(195, 79, 151, 0.08)"}:b==="Build Muscle"||b==="ابنِ عضلاتك"?h={borderColor:"var(--primary)",color:"var(--primary)",background:"rgba(92, 63, 131, 0.08)"}:b==="Keep Fit"||b==="حافظ على لياقتك"?h={borderColor:"var(--primary-foreground)",color:"var(--primary-foreground)",background:"rgba(6, 104, 234, 0.08)"}:b&&(h={borderColor:"var(--muted)",color:"var(--muted-foreground)",background:"rgba(232, 184, 216, 0.15)"});const m=p?.users_approve===1?n("trainees_table.active"):n("trainees_table.not_active");p?.goal;const u=p?.created_at?`${ts(p.created_at,r)} - ${new Date(p.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:"-",v={color:m===n("trainees_table.active")?"var(--accent-foreground)":"var(--destructive)",background:m===n("trainees_table.active")?"#e6f9ed":"#ffeaea",borderColor:m===n("trainees_table.active")?"var(--accent-foreground)":"var(--destructive)"},{mutate:A,isPending:I}=pi(),S=()=>{A(s,{onSuccess:C=>{C?.status==="success"?(G.success(n("trainee.delete_success","تم حذف المستخدم بنجاح ✅")),x(!1),a&&a()):G.error(n("trainee.delete_failed","تعذر الحذف، تحقق من السيرفر"))},onError:()=>{G.error(n("trainee.delete_error","حدث خطأ أثناء الحذف ❌"))}})};return e.jsx("div",{children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"",children:[e.jsx("div",{className:"",children:e.jsxs("div",{className:`flex items-center gap-2 text-sm mb-6 ${r?"flex-row-reverse":""}`,children:[e.jsxs("button",{onClick:()=>{a&&a()},className:"flex items-center gap-1 text-muted-foreground hover:underline",children:[e.jsx(er,{className:"w-4 h-4"}),e.jsx("span",{children:n("trainee.back_to_trainees")})]}),e.jsx("span",{children:"/"}),e.jsx(l,{variant:"blackSmall",children:p?.users_name||"-"})]})}),e.jsxs("div",{className:"flex items-center bg-white rounded-2xl p-6 shadow-sm  gap-6 max-w-2xl mb-8",children:[e.jsxs("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-secondary to-primary flex items-center justify-center text-white text-2xl font-bold overflow-hidden",children:[p?.users_img?e.jsx("img",{className:"w-full h-full object-cover",src:`${ya}/${p.users_img}`,alt:p.users_name,onError:C=>{C.target.style.display="none",C.target.nextSibling.style.display="flex"}}):null,p?.users_name?e.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{display:p?.users_img?"none":"flex"},children:p.users_name.split(" ").map(C=>C[0]).join("").toUpperCase()}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:'"-"'})]}),e.jsxs("div",{className:"flex-1 space-y-2 min-w-0",children:[e.jsx(l,{variant:"h2",children:p?.users_name||"-"}),e.jsx(l,{variant:"p",children:p?.users_phone||"-"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap text-xs",children:[o&&b&&e.jsx("span",{className:"px-2 py-0.5 rounded-full font-medium border",style:h,children:b}),e.jsx("span",{className:"px-2 py-0.5 rounded-full font-medium border",style:v,children:m}),e.jsxs("span",{className:"text-muted-foreground",children:["• ",n("trainees_table.joined_date")," ",u]})]})]}),e.jsxs("button",{className:"flex items-center gap-1 border text-xs font-semibold border-red-200 text-destructive px-2 py-1.5 cursor-pointer rounded-full hover:bg-red-50 transition",onClick:()=>x(!0),children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{children:n("trainee.delete_confirm")})]})]}),e.jsx(me,{open:c,onOpenChange:x,children:e.jsxs(ue,{className:"max-w-md w-full rounded-xl p-6 border-none pt-12",children:[e.jsx(xe,{className:"text-destructive",children:n("trainee.delete_title")}),e.jsx(Ie,{className:"mb-4",children:n("trainee.delete_desc")}),e.jsxs(be,{children:[e.jsx(ka,{asChild:!0,children:e.jsx(k,{variant:"outline",onClick:()=>x(!1),children:n("trainee.delete_cancel")})}),e.jsx("button",{className:"px-4 py-2 rounded-full bg-destructive text-white hover:bg-destructive/90",onClick:S,children:n("trainee.delete_confirm")})]})]})}),o?e.jsxs(qa,{defaultValue:"profile",className:"w-full",children:[e.jsxs(jt,{className:"w-full justify-between bg-muted rounded-full mb-4",children:[e.jsx(hs,{value:"profile",className:"flex-1",children:n("trainee.tabs.profile")}),e.jsx(hs,{value:"workouts",className:"flex-1",children:n("trainee.tabs.workouts")}),e.jsx(hs,{value:"meals",className:"flex-1",children:n("trainee.tabs.meals")})]}),e.jsx(gs,{value:"profile",children:e.jsx(Bi,{trainee:p,personalData_users_id:p?.users_id})}),e.jsx(gs,{value:"workouts",children:e.jsx(cl,{personalData:y})}),e.jsx(gs,{value:"meals",children:e.jsx(wl,{personalDataRes:j,personalData_users_id:p?.users_id})})]}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(l,{variant:"h3",className:"mb-2",children:r?"الحساب غير مفعل":"Account Not Active"}),e.jsx(l,{variant:"p",children:r?"لا يمكن عرض تفاصيل الحساب لأن الحساب غير مفعل":"Cannot display account details because the account is not active"})]})]})})})}const Al=async()=>{try{return(await K.post(`${z}/api84818dataecoupon/getAllCoupons`)).data}catch(s){throw s}},Cl=async s=>{try{return(await K.post(`${z}/api84818dataecoupon/insertDataCoupon`,s)).data}catch(t){throw t}},Sl=async s=>{try{return(await K.post(`${z}/api84818datafood/updateDataCoupon`,s)).data}catch(t){throw t}},Dl=async s=>{try{return(await K.post(`${z}/api84818dataecoupon/deleteDataCoupon`,{coupon_id:s})).data}catch(t){throw t}},kl=async s=>{try{return(await K.post(`${z}/api84818dataecoupon/getDataCouponUsage`,{user_id:s})).data}catch(t){throw console.error("Error fetching coupon:",t),t}},vt=()=>ie({queryKey:["coupons"],queryFn:async()=>await Al()}),ql=()=>{const s=pe();return de({mutationFn:Cl,onSuccess:()=>{s.invalidateQueries({queryKey:["coupons"]})}})},Tl=()=>{const s=pe();return de({mutationFn:Dl,onSuccess:()=>{s.invalidateQueries({queryKey:["coupons"]})}})},Il=s=>ie({queryKey:["userCoupons",s],queryFn:()=>kl(s),enabled:!!s}),Ml=Ge({payments_amount:ot({invalid_type_error:"قيمة غير صحيحة"}).nonnegative(),payments_amount_net:ot({invalid_type_error:"قيمة غير صحيحة"}).nonnegative()}).refine(s=>s.payments_amount_net<=s.payments_amount,{path:["payments_amount_net"],message:"الصافي يجب أن يكون ≤ الإجمالي"}),Lt=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:2}).format(Number(s||0));function Fl({trainee:s,setPayOpen:t}){const{t:a,i18n:n}=re(),i=n.resolvedLanguage||n.language||"en",r=s?.users_id,c=ts,{data:x,isLoading:p,isError:o}=yt(r),j=x?.data,{data:y,isLoading:g,isError:f}=Il(r),{data:_}=vt(),{data:q}=Ws(),b=j?.personalData_expOffer,h=j?.personalData_offers_id,u=(q?.data||[]).find(w=>w.offers_id===h),v=d.useMemo(()=>{if(!b)return null;try{let w;if(typeof b=="number"||/^\d+$/.test(String(b))){const N=Number(b);w=new Date(String(N).length===10?N*1e3:N)}else if(typeof b=="string"){const N=b.trim(),Q=N.includes(" ")&&!N.includes("T")?N.replace(" ","T"):N;w=new Date(Q)}return w&&!isNaN(w.getTime())?w:null}catch{return null}},[b]),A=w=>{if(!(w instanceof Date))return null;const N=new Date(w);return N.setHours(0,0,0,0),N},I=A(new Date),S=A(v),C=!!S&&S>I,M=!!S&&S<=I,$=y?.data?.[0]?.coupon_name,H=_?.data?.find(w=>w.coupon_name===$),Y=!!H&&!!H.coupon_end&&A(new Date(H.coupon_end))>I,{basePrice:ee,finalPrice:J}=d.useMemo(()=>{const w=Number(u?.offers_price??0),N=w-w*Number(u?.offers_discount??0)/100,Q=N-N*(Y?Number(H.coupon_discount):0)/100;return{basePrice:Number.isFinite(w)?w:0,finalPrice:Number.isFinite(Q)?Number(Q.toFixed(2)):0}},[u,H,Y]),ae=Ve({resolver:Be(Ml),defaultValues:{payments_amount:0,payments_amount_net:0},mode:"onChange"});d.useEffect(()=>{typeof ee=="number"&&typeof J=="number"&&ae.reset({payments_amount:ee,payments_amount_net:J})},[ee,J,ae]);const[Se,E]=d.useState(!1),[T,Z]=d.useState(null),{mutateAsync:ce,isPending:ge}=ri();if(p||g)return e.jsx($e,{});if(o||f)return e.jsx("p",{children:a("error","Something went wrong")});const D=w=>{Z(w),E(!0)},X=async()=>{if(!T||!r)return;const w={personalData_users_id:r,payments_amount:T.payments_amount,payments_amount_net:T.payments_amount_net,payments_couponid:Number(H?.coupon_id??11)};try{const N=await ce(w);N?.status==="failure"?G.error(N?.message||a("payment.already_done_desc","المستخدم قد دفع بالفعل."),{description:a("payment.already_done_title","تنبيه")}):(E(!1),t(!1),G.success(a("payment.success_desc","تم تسجيل الدفعة المالية بنجاح."),{description:a("payment.success_title","نجاح")}),Z(null))}catch(N){const Q=N?.response?.data?.message||a("payment.error_desc","حدث خطأ أثناء تسجيل الدفع");G.error(Q)}};return e.jsxs(Ae,{children:[e.jsx(Fe,{children:e.jsxs(qe,{className:"flex flex-col gap-2",children:[e.jsx(l,{variant:"h2",children:a("admin.payment_form","تسجيل دفعة مالية")}),e.jsx(l,{variant:"p",children:s?.users_name})]})}),e.jsx(Te,{children:u?.offers_id===1?e.jsxs("div",{className:"space-y-3 p-4 rounded-md border border-primary-foreground bg-primary-foreground/5",children:[e.jsx(l,{variant:"h2",className:"text-primary-foreground",children:a("subscription.free_plan_title","الخطة المجانية")}),e.jsx(l,{variant:"p",className:"text-primary-foreground",children:a("subscription.free_plan_desc","مشترك في الخطة المجانية ولا يتطلب أي دفع.")})]}):C?e.jsxs("div",{className:"space-y-3 p-4 rounded-md border border-accent-foreground bg-accent-foreground/5",children:[e.jsx(l,{variant:"h2",className:"text-accent-foreground",children:a("subscription.active_title","اشتراك فعّال")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(l,{variant:"p",children:[a("subscription.expiry"),":"]}),e.jsx(l,{variant:"p",className:"font-medium",children:c(v,i,{year:"numeric",month:"long",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})})]})]}):e.jsxs(e.Fragment,{children:[M&&e.jsxs("div",{className:"mb-4 p-3 rounded-md border border-destructive bg-red-100",children:[e.jsx(l,{variant:"h2",className:"text-destructive",children:a("subscription.expired_title","الاشتراك غير ساري")}),e.jsx(l,{variant:"p",children:a("admin.payment_form_date")}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(l,{variant:"p",className:"font-medium",children:c(v,i,{year:"numeric",month:"long",day:"2-digit"})})})]}),e.jsxs("form",{onSubmit:ae.handleSubmit(D),className:"flex flex-col gap-4",children:[u&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-secondary",variant:"h2",children:i==="ar"?u.offers_titleAr:u.offers_titleEn}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(l,{variant:"p",children:[a("offer.price","السعر الأساسي"),":"]}),e.jsx(l,{className:"text-primary",variant:"p",children:Lt(u.offers_price)})]}),Number(u?.offers_discount)>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(l,{variant:"p",children:[a("offer.offer_discount","خصم الأوفر"),":"]}),e.jsxs(l,{className:"text-primary",variant:"p",children:[u.offers_discount,"%"]})]}),Y&&H&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(l,{variant:"p",children:[a("offer.coupon_discount","خصم الكوبون"),":"]}),e.jsxs(l,{className:"text-primary",variant:"p",children:[H.coupon_name," (",H.coupon_discount,"%)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{variant:"p",children:a("offer.final_price","السعر النهائي")}),e.jsx(l,{className:"text-accent-foreground font-bold",variant:"p",children:Lt(J)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(He,{htmlFor:"payments_amount",children:a("form.amount","المبلغ قبل الخصم")}),e.jsx(F,{id:"payments_amount",type:"number",step:"0.01",...ae.register("payments_amount",{valueAsNumber:!0})}),ae.formState.errors.payments_amount&&e.jsx("p",{className:"text-red-500 text-sm",children:ae.formState.errors.payments_amount.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(He,{htmlFor:"payments_amount_net",children:a("form.amount_net","المبلغ بعد الخصم")}),e.jsx(F,{id:"payments_amount_net",type:"number",step:"0.01",...ae.register("payments_amount_net",{valueAsNumber:!0})}),ae.formState.errors.payments_amount_net&&e.jsx("p",{className:"text-red-500 text-sm",children:ae.formState.errors.payments_amount_net.message})]}),e.jsx(k,{type:"button",className:"mt-4",disabled:!ae.formState.isValid||ae.formState.isSubmitting||ge,onClick:ae.handleSubmit(D),children:ge?a("form.saving","جاري الحفظ..."):a("form.save_payment","حفظ الدفعة")}),e.jsx(Fs,{open:Se,onOpenChange:E,children:e.jsxs(bs,{children:[e.jsxs(Ns,{children:[e.jsx(Es,{className:"text-start",children:a("confirm.title","تأكيد عملية الدفع")}),e.jsx(As,{className:"text-start",children:a("confirm.description","هل أنت متأكد من متابعة حفظ هذه الدفعة؟ لا يمكن التراجع بعد التأكيد.")})]}),e.jsxs("div",{className:"rounded-md bg-gray-50 shadow p-3 text-sm space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(l,{variant:"p",children:[a("form.amount","المبلغ قبل الخصم"),":"]}),e.jsx(l,{variant:"p",children:T?.payments_amount??ae.getValues("payments_amount")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(l,{variant:"p",children:[a("form.amount_net","المبلغ بعد الخصم"),":"]}),e.jsx(l,{className:"font-medium",children:T?.payments_amount_net??ae.getValues("payments_amount_net")})]})]}),e.jsxs(ws,{children:[e.jsx(Ss,{disabled:ge,children:a("confirm.cancel","إلغاء")}),e.jsx(Cs,{onClick:X,disabled:ge,children:ge?a("confirm.processing","جاري التنفيذ..."):a("confirm.confirm","تأكيد الدفع")})]})]})})]})]})})]})}function Pl({trainees:s=[]}){const{t}=re(),[a,n]=d.useState(!1),[i,r]=d.useState(null),{isArabic:c}=ts(),[x,p]=d.useState(!1),[o,j]=d.useState(null),y=[{key:"users_img"},{key:"users_id"},{key:"users_name"},{key:"users_phone"},{key:"users_approve"},{key:"created_at"},{key:"last_log"},{key:"pay"},{key:"actions"}];return e.jsxs("div",{className:"bg-white rounded-b-2xl shadow-sm p-4 w-full overflow-x-auto border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(cs,{className:"text-secondary"}),e.jsx("span",{className:"font-semibold text-lg",children:t("trainees_table.title")})]}),e.jsxs(Qs,{children:[e.jsx(Ys,{children:e.jsx(is,{children:y.map(g=>e.jsx(fe,{children:t(`trainees_table.${g.key}`)},g.key))})}),e.jsx(Zs,{children:s.map((g,f)=>e.jsxs(is,{className:"border-b border-gray-200 hover:bg-gray-50 transition-colors",children:[e.jsx(oe,{className:"text-center",children:e.jsx("div",{className:"flex items-center justify-center",children:g.users_img?e.jsx("img",{className:"w-14 h-14 rounded-full object-cover",src:`${ya}/${g.users_img}`,alt:"img"}):e.jsx("span",{className:"",children:"-"})})}),e.jsx(oe,{className:"text-center",children:g.users_id}),e.jsx(oe,{className:"text-center",children:g.users_name}),e.jsx(oe,{className:"text-center",children:g.users_phone}),e.jsx(oe,{className:"text-center",children:e.jsx("span",{className:"inline-block px-2 py-1 font-medium rounded-full text-xs "+(g.users_approve?"text-accent-foreground min-w-16 bg-accent-foreground/20 shadow ":"text-muted-foreground min-w-16 bg-muted-foreground/20 shadow"),children:g.users_approve?t("trainees_table.active"):t("trainees_table.not_active")})}),e.jsx(oe,{className:"text-center",children:g.created_at?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:ts(g.created_at,c)}),e.jsx("br",{}),e.jsx("span",{style:{fontSize:"0.85em",color:"#888"},children:new Date(g.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}):""}),e.jsx(oe,{className:"text-center",children:g.last_log?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:ts(g.last_log,c)}),e.jsx("br",{}),e.jsx("span",{style:{fontSize:"0.85em",color:"#888"},children:new Date(g.last_log).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}):""}),e.jsx(oe,{children:e.jsx(k,{variant:"outline",size:"icon","aria-label":"دفعة مالية",onClick:()=>{j(g),p(!0)},className:" border-accent-foreground border-2  hover:bg-accent-foreground/20  transition-all duration-200 mx-auto",children:e.jsx(Pe,{className:"w-5 h-5 text-accent-foreground"})})}),e.jsx(oe,{className:"text-center align-middle",children:e.jsxs("button",{className:"flex items-center cursor-pointer gap-2 text-sm px-3 py-1 rounded-full border border-gray-300 text-gray-500 hover:bg-secondary/90 hover:text-white transition-colors group mx-auto",onClick:()=>{r(g.users_id),n(!0)},children:[e.jsx(xt,{className:"w-3 h-3 transition-all duration-200 group-hover:text-white group-hover:scale-125 group-hover:drop-shadow"}),e.jsx("span",{className:"hidden sm:inline text-xs",children:t("trainees_table.view_profile")})]})})]},f))})]}),e.jsx(me,{open:a,onOpenChange:n,children:e.jsxs(ue,{className:"w-screen  min-h-screen max-h-screen overflow-y-auto p-0 border-none shadow-none rounded",children:[e.jsx(xe,{}),e.jsx(El,{users_id:i,trainees:s,onClose:()=>n(!1)})]})}),e.jsx(me,{open:x,onOpenChange:p,children:e.jsxs(ue,{className:"max-w-md w-full rounded-xl p-6",children:[e.jsx(xe,{}),e.jsx(Fl,{setPayOpen:p,trainee:o})]})})]})}function Ol(){const{t:s}=re(),{data:t,isLoading:a,isError:n,error:i}=ft(),r=t?.data||[],c=r.length,x=r.filter(b=>b.users_approve===1).length,p=new Date,o=r.filter(b=>{if(!b.created_at)return!1;const h=new Date(b.created_at);return h.getFullYear()===p.getFullYear()&&h.getMonth()===p.getMonth()}).length,[j,y]=d.useState("all"),[g,f]=d.useState(""),_=[{key:"all",label:s("filters.all"),filterFn:()=>!0},{key:"active",label:s("filters.active"),filterFn:b=>b.users_approve===1},{key:"not_active",label:s("filters.not_active"),filterFn:b=>b.users_approve!==1}],q=r.filter(_.find(b=>b.key===j)?.filterFn||(()=>!0)).filter(b=>g.trim()===""||b.users_name?.toLowerCase().includes(g.toLowerCase())||b.users_phone?.toLowerCase().includes(g.toLowerCase()));return e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-col text-center lg:text-start gap-5 lg:flex-row justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(l,{variant:"h2",children:s("trainees_management.title")}),e.jsx(l,{variant:"p",className:"text-sm text-muted-foreground",children:s("trainees_management.subtitle")})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"py-1 px-3 flex items-center gap-2 text-sm text-muted-foreground border-1 border-muted-foreground rounded-full w-fit",children:[e.jsxs(l,{variant:"p",children:[" ",c]}),e.jsx(l,{variant:"p",children:s("trainees_management.trainees_count")})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4",children:[e.jsx(je,{name:s("trainees_management.total_trainees"),number:c,icon:e.jsx(fs,{className:"bg-secondary rounded-xl p-2 text-white",size:40})}),e.jsx(je,{name:s("trainees_management.active_members"),number:x,icon:e.jsx(Us,{className:"bg-primary rounded-xl p-2 text-white",size:40})}),e.jsx(je,{name:s("trainees_management.this_month_trainees"),number:o,icon:e.jsx(zs,{className:"bg-accent-foreground/60 rounded-xl p-2 text-white",size:40})}),e.jsx(je,{name:s("trainees_management.avg_weight"),number:"12Kg",icon:e.jsx(sr,{className:"bg-primary rounded-xl p-2 text-white",size:40})})]}),e.jsxs("div",{className:"bg-white rounded-t-2xl p-6 shadow-sm w-full flex justify-between flex-col sm:flex-row items-stretch sm:items-center gap-4 sm:gap-6",children:[e.jsxs("div",{className:"relative w-full sm:max-w-xs flex-1",children:[e.jsx(F,{placeholder:s("trainings_management.search_placeholder"),className:"ltr:pl-8 rtl:pr-8 ",value:g,onChange:b=>f(b.target.value)}),e.jsx("span",{className:"absolute start-2 top-1/2 -translate-y-1/2 text-gray-400",children:e.jsx(Ms,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-between sm:justify-end",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-gray-100 text-gray-400",children:e.jsx(pa,{className:"w-5 h-5"})}),_.map(b=>e.jsx(k,{variant:j===b.key?"default":"outline",onClick:()=>y(b.key),children:b.label},b.key))]})]}),a?e.jsx($e,{text:s("loading")}):n?e.jsxs("div",{className:"text-center text-destructive py-10",children:[s("error_loading_users"),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-muted-foreground",children:i?.message||JSON.stringify(i)})]}):e.jsx(Pl,{trainees:q})]})}const Ll=()=>{const[s,t]=d.useState([]),[a,n]=d.useState(null),[i,r]=d.useState(!1),[c,x]=d.useState(null),{data:p}=Na(a,{enabled:!!a}),o=Me.language==="ar",j=new Date,y=j.getFullYear().toString();(j.getMonth()+1).toString().padStart(2,"0");const[g,f]=d.useState(y),[_,q]=d.useState("all"),b=_==="all"?g:`${g}-${_}`,{data:h,isLoading:m,isError:u,error:v,refetch:A}=Sa({date:b},{enabled:!!b}),{data:I}=vt(),S=I?.data||[],{data:C}=Ws(),M=C?.data||[],$=d.useMemo(()=>new Map(S.map(D=>[D.coupon_id,D])),[S]),H=d.useMemo(()=>new Map(M.map(D=>[D.offers_id,D])),[M]);d.useEffect(()=>{A()},[g,_,A]);const Y=d.useMemo(()=>{if(!h?.data?.payments)return null;const D=h.data.payments,{grossRevenue:X,netRevenue:w,usedCouponsCount:N,userIds:Q}=D.reduce((L,W)=>{const Re=Number(W.payments_amount||0),es=Number(W.payments_amount_net||0);return L.grossRevenue+=Re,L.netRevenue+=es,W.payments_couponid&&L.usedCouponsCount++,L.userIds.add(W.payments_userid),L},{grossRevenue:0,netRevenue:0,usedCouponsCount:0,userIds:new Set});return{grossRevenue:X,netRevenue:w,discountsGiven:X-w,usedCouponsCount:N,payingUsersCount:Q.size,payments:D}},[h]),ee=d.useMemo(()=>{const X=j.getFullYear()+1;return Array.from({length:X-2025+1},(w,N)=>(2025+N).toString())},[j]),J=D=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(D),ae=d.useMemo(()=>{if(!Y?.payments)return[];const D={};return Y.payments.forEach(X=>{const w=new Date(X.payments_date);let N;_==="all"?N=w.toLocaleString("en",{month:"short"}):N=w.getDate().toString().padStart(2,"0"),D[N]||(D[N]={label:N,gross:0,net:0}),D[N].gross+=Number(X.payments_amount||0),D[N].net+=Number(X.payments_amount_net||0)}),Object.values(D)},[Y,_]),Se=d.useMemo(()=>{if(!Y?.payments)return[];const D={};return Y.payments.forEach(X=>{D[X.payments_userid]||(D[X.payments_userid]={user:X.payments_userid,total:0}),D[X.payments_userid].total+=Number(X.payments_amount_net||0)}),Object.values(D)},[Y]),E=d.useMemo(()=>{if(!Y?.payments)return[];let D=0,X=0;return Y.payments.forEach(w=>{w.payments_couponid&&w.payments_couponid!==11?D++:X++}),[{name:"With Coupon",value:D},{name:"Without Coupon",value:X}]},[Y]),T=E.find(D=>D.name==="With Coupon")?.value||0,Z=d.useMemo(()=>{if(!Y?.payments)return[];const D=Y.payments.reduce((X,w)=>{const N=H.get(w.payments_offerid);if(N){const Q=N.offers_discount,L=`${N.offers_titleEn||N.offers_titleAr} (${N.offers_discount}%)`;X[Q]||(X[Q]={offer:L,totalRevenue:0}),X[Q].totalRevenue+=Number(w.payments_amount_net||0)}return X},{});return Object.values(D)},[Y,H]),ce=d.useMemo(()=>{if(!Y?.payments)return[];const D={};return Y.payments.forEach(X=>{const w=new Date(X.payments_date);let N;_==="all"?N=w.toLocaleString("en",{month:"short"}):N=w.getDate().toString().padStart(2,"0"),D[N]||(D[N]={label:N,count:0}),D[N].count++}),Object.values(D)},[Y,_]),ge=[{name:o?"الإيرادات الإجمالية":"Gross Revenue",number:Y?.grossRevenue||0,text:o?"قبل الخصومات":"Before Discounts",para:o?"إجمالي الإيرادات قبل تطبيق الخصومات/الكوبونات.":"Total revenue before applying coupons/discounts."},{name:o?"الإيرادات الصافية":"Net Revenue",number:Y?.netRevenue||0,text:o?"بعد الخصومات":"After Discounts",para:o?"الإيرادات الفعلية بعد تطبيق الخصومات/الكوبونات.":"Actual revenue after coupons/discounts applied."},{name:o?"الخصومات الممنوحة":"Discounts Given",number:Y?.discountsGiven||0,text:o?"خصومات العروض":"Offer Discounts",para:o?"إجمالي المبلغ المخصوم بسبب الكوبونات/العروض.":"Total amount reduced due to applied coupons."},{name:o?"الكوبونات المستخدمة":"Used Coupons",number:T||0,text:o?"الكوبونات":"Coupons",para:o?"عدد الدفعات التي تم استخدام كوبون فيها.":"Number of payments where a coupon was applied."},{name:o?"المستخدمون الدافعون":"Paying Users",number:Y?.payingUsersCount||0,text:o?"المستخدمون الفريدون":"Unique Users",para:o?"عدد المستخدمين المميزين الذين قاموا بالدفعات.":"Number of distinct users who made payments."}];return d.useEffect(()=>{p?.data?.length>0&&x(p.data[0])},[p]),e.jsxs("div",{className:"max-w-6xl mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(l,{variant:"h2",children:o?" الإدارة المالية":"Finance managment"}),e.jsx(l,{variant:"p",children:o?" قم بإدارة سجلاتك المالية وراقب أدائك المالي, الشهري والسنوي":"Finance managment"})]}),e.jsxs(k,{onClick:()=>Da(ge,kt),children:[e.jsx(oa,{size:15}),e.jsx("p",{children:kt("dashboard.export_report")})]})]}),Y&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-5",children:[e.jsxs(ze,{value:g,onValueChange:D=>f(D),children:[e.jsx(Oe,{children:e.jsx(Ue,{placeholder:"Select Year"})}),e.jsx(Le,{children:ee.map(D=>e.jsx(Ce,{value:D,children:D},D))})]}),e.jsxs(ze,{value:_,onValueChange:D=>q(D),children:[e.jsx(Oe,{children:e.jsx(Ue,{placeholder:"Select Month"})}),e.jsxs(Le,{children:[e.jsx(Ce,{value:"all",children:o?"كل السنة":"All year"}),Array.from({length:12},(D,X)=>{const w=(X+1).toString().padStart(2,"0");return e.jsxs(Ce,{value:w,children:[new Date(0,X).toLocaleString("en",{month:"long"})," ",g]},w)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(je,{name:o?"الإيرادات الإجمالية":"Gross Revenue",number:J(Y.grossRevenue),icon:e.jsx(Qe,{className:"h-10 w-10 text-white bg-primary p-2 rounded-lg"}),Text:o?"قبل الخصومات":"Before Discounts",ColorOfText:"text-green-700",bgText:"bg-accent-foreground/5",para:o?"إجمالي الإيرادات قبل تطبيق الخصومات/الكوبونات.":"Total revenue before applying coupons/discounts."}),e.jsx(je,{name:o?"الإيرادات الصافية":"Net Revenue",number:J(Y.netRevenue),icon:e.jsx(Qe,{className:"h-10 w-10 text-white p-2 bg-accent-foreground rounded-lg"}),Text:o?"بعد الخصومات":"After Discounts",ColorOfText:"text-primary-foreground",bgText:"bg-primary-foreground/10",para:o?"الإيرادات الفعلية بعد تطبيق الخصومات/الكوبونات.":"Actual revenue after coupons/discounts applied."}),e.jsx(je,{name:o?"الخصومات الممنوحة":"Discounts Given",number:J(Y.discountsGiven),icon:e.jsx(Qe,{className:"h-10 w-10 text-white bg-destructive p-2 rounded-lg"}),Text:o?"خصومات العروض":"Offer Discounts",ColorOfText:"text-destructive",bgText:"bg-destructive/10",para:o?"إجمالي المبلغ المخصوم بسبب الكوبونات/العروض.":"Total amount reduced due to applied coupons."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsx(je,{name:o?"الكوبونات المستخدمة":"Used Coupons",number:T,icon:e.jsx(ha,{className:"h-10 w-10 p-2 bg-primary rounded-lg text-white"}),Text:o?"الكوبونات":"Coupons",ColorOfText:"text-purple-700",bgText:"bg-primary/10",para:o?"عدد الدفعات التي تم استخدام كوبون فيها.":"Number of payments where a coupon was applied."}),e.jsx(je,{name:o?"المستخدمون الدافعون":"Paying Users",number:Y.payingUsersCount,icon:e.jsx(fs,{className:"h-10 w-10 text-white bg-custom-yellow-text rounded-lg p-2"}),Text:o?"المستخدمون الفريدون":"Unique Users",ColorOfText:"text-custom-yellow-text",bgText:"bg-custom-yellow-bg",para:o?"عدد المستخدمين المميزين الذين قاموا بالدفعات.":"Number of distinct users who made payments."})]})]}),Y?.payments?.length>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-2",children:[e.jsxs(Ae,{className:"shadow",children:[e.jsx(Fe,{children:e.jsx(qe,{children:e.jsx(l,{variant:"h2",children:o?"اتجاه الإيرادات (الإجمالي مقابل الصافي)":"Revenue Trend (Gross vs Net)"})})}),e.jsx(Te,{children:e.jsx(ns,{width:"100%",height:300,children:e.jsxs(tr,{data:ae,children:[e.jsx(us,{dataKey:"label",tick:{fontSize:12,fill:"#555",dx:o?4:0}}),e.jsx(xs,{tickMargin:12,tick:{fontSize:12,fill:"#555",dx:o?-22:-4},tickFormatter:D=>J(D)}),e.jsx(rs,{formatter:D=>J(D),labelFormatter:D=>o?`الفترة: ${D}`:`Period: ${D}`}),e.jsx(rt,{formatter:D=>o?D==="gross"?"الإيراد الإجمالي":"الإيراد الصافي":D==="gross"?"Gross Revenue":"Net Revenue"}),e.jsx(qt,{type:"monotone",dataKey:"gross",stroke:"var(--primary)",fill:"var(--primary)",fillOpacity:.2,name:o?"الإيراد الإجمالي":"Gross Revenue"}),e.jsx(qt,{type:"monotone",dataKey:"net",stroke:"var(--accent-foreground)",fill:"var(--accent-foreground)",fillOpacity:.2,name:o?"الإيراد الصافي":"Net Revenue"})]})})})]}),e.jsxs(Ae,{className:"shadow",children:[e.jsx(Fe,{children:e.jsx(qe,{children:o?"الإيرادات حسب المستخدمين":"Revenue by Users"})}),e.jsx(Te,{children:e.jsx(ns,{width:"100%",height:320,children:e.jsxs(Os,{data:[...Se].sort((D,X)=>X.total-D.total),margin:{top:10,right:20,left:0,bottom:30},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"usersGradient",x1:"0",y1:"0",x2:"1",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--secondary)",stopOpacity:.9}),e.jsx("stop",{offset:"95%",stopColor:"var(--secondary)",stopOpacity:.3})]})}),e.jsx(us,{dataKey:"user",tick:{fontSize:12,fill:"#555",dx:o?4:0}}),e.jsx(xs,{tickMargin:10,tick:{fontSize:12,fill:"#555",dx:o?-22:-4},tickFormatter:D=>J(D)}),e.jsx(rs,{formatter:D=>J(D),labelFormatter:D=>o?`المستخدم: ${D}`:`User: ${D}`}),e.jsx(Ls,{dataKey:"total",fill:"url(#usersGradient)",radius:[10,10,0,0],children:e.jsx(ar,{dataKey:"total",content:({x:D,y:X,width:w,height:N,value:Q})=>{const L=J(Q);return N>40?e.jsx("text",{x:D+w/2,y:X+20,fill:"#fff",textAnchor:"middle",fontSize:"0.7rem",children:L}):e.jsx("text",{x:D+w/2,y:X-5,fill:"var(--muted-foreground)",textAnchor:"middle",fontSize:"0.7rem",children:L})}})})]})})})]}),e.jsxs(Ae,{className:"shadow",children:[e.jsxs(Fe,{className:"flex flex-col items-start space-y-1",children:[e.jsx(qe,{children:o?"استخدام الكوبونات":"Coupons Usage"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o?"توزيع المدفوعات باستخدام وبدون كوبونات":"Distribution of payments with and without coupons"})]}),e.jsx(Te,{dir:o?"rtl":"ltr",children:e.jsx(ns,{width:"100%",height:320,children:e.jsxs(ta,{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"withCoupon",x1:"0",y1:"0",x2:"1",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--primary)",stopOpacity:.9}),e.jsx("stop",{offset:"95%",stopColor:"var(--primary)",stopOpacity:.4})]}),e.jsxs("linearGradient",{id:"withoutCoupon",x1:"0",y1:"0",x2:"1",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--accent-foreground)",stopOpacity:.9}),e.jsx("stop",{offset:"95%",stopColor:"var(--accent-foreground)",stopOpacity:.4})]})]}),e.jsxs(aa,{data:E.map(D=>({...D,name:o?D.name==="With Coupon"?"مع كوبون":"من دون كوبون":D.name})),cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:2,dataKey:"value",nameKey:"name",children:[e.jsx($s,{fill:"url(#withCoupon)"},"withCoupon"),e.jsx($s,{fill:"url(#withoutCoupon)"},"withoutCoupon")]}),e.jsx(rs,{formatter:(D,X)=>[o?`${D} دفعات`:`${D} Payments`,X]}),e.jsx(rt,{verticalAlign:"bottom",align:"center",iconType:"circle"})]})})})]}),e.jsxs(Ae,{className:"shadow",children:[e.jsxs(Fe,{children:[e.jsx(qe,{children:o?"أداء العروض":"Offers Performance"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o?"توزيع المدفوعات حسب العروض المطبقة":"Distribution of payments by applied offers"})]}),e.jsx(Te,{dir:o?"rtl":"ltr",children:e.jsx(ns,{width:"100%",height:300,children:e.jsxs(Os,{data:Z,children:[e.jsx(us,{dataKey:"offer"}),e.jsx(xs,{tick:{fontSize:12,fill:"#555",dx:o?-40:-4},tickFormatter:D=>J(D)}),e.jsx(rs,{formatter:D=>J(D),labelFormatter:D=>o?`العرض: ${D}`:`Offer: ${D}`}),e.jsx(rt,{}),e.jsx(Ls,{dataKey:"totalRevenue",fill:"var(--secondary)",radius:[6,6,0,0],name:o?"إجمالي الإيرادات":"Total Revenue"})]})})})]}),e.jsxs(Ae,{className:"shadow",children:[e.jsx(Fe,{children:e.jsx(qe,{children:_==="all"?o?"تكرار الدفعات (شهري)":"Payments Frequency (Monthly)":o?`تكرار الدفعات (يومي - ${new Date(`${g}-${_}-01`).toLocaleString("ar",{month:"long"})})`:`Payments Frequency (Daily - ${new Date(`${g}-${_}-01`).toLocaleString("en",{month:"long"})})`})}),e.jsx(Te,{dir:o?"rtl":"ltr",children:e.jsx(ns,{width:"100%",height:300,children:e.jsxs(Os,{data:ce,children:[e.jsx(us,{dataKey:"label"}),e.jsx(xs,{tick:{dx:o?-40:-4},tickFormatter:D=>J(D)}),e.jsx(rs,{formatter:D=>o?`${D} دفعة`:`${D} payments`,labelFormatter:D=>o?`اليوم/الشهر: ${D}`:`Day/Month: ${D}`}),e.jsx(Ls,{dataKey:"count",fill:"var(--primary)",radius:[6,6,0,0],name:o?"عدد الدفعات":"Payments Count"})]})})})]})]}),Y?.payments?.length>0?e.jsxs(Ae,{className:"shadow-md rounded-2xl border border-gray-200",children:[e.jsx(Fe,{className:"bg-gradient-to-r from-primary/10 to-accent/10 rounded-t-2xl",children:e.jsx(qe,{className:"text-lg font-semibold",children:o?"تفاصيل الدفعات":"Payments Details"})}),e.jsx(Te,{dir:o?"rtl":"ltr",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Qs,{children:[e.jsx(Ys,{children:e.jsxs(is,{className:"bg-gray-50",children:[e.jsx(fe,{className:"text-gray-600",children:o?"تفاصيل":"Ditails"}),e.jsx(fe,{className:"text-gray-600",children:o?"رقم الدفعة":"ID"}),e.jsx(fe,{className:"text-gray-600",children:o?"المستخدم":"User"}),e.jsx(fe,{className:"text-gray-600",children:o?"التاريخ":"Date"}),e.jsx(fe,{className:"text-gray-600 text-right",children:o?"المبلغ الإجمالي":"Gross Amount"}),e.jsx(fe,{className:"text-gray-600 text-right",children:o?"المبلغ الصافي":"Net Amount"}),e.jsx(fe,{className:"text-gray-600",children:o?"الكوبون":"Coupon"}),e.jsx(fe,{className:"text-gray-600",children:o?"العرض":"Offer"}),e.jsx(fe,{className:"text-gray-600 text-right",children:o?"الخصم":"Discount"})]})}),e.jsx(Zs,{children:Y.payments.map((D,X)=>{const w=$.get(D.payments_couponid),N=H.get(D.payments_offerid),Q=Number(D.payments_amount||0),L=Number(D.payments_amount_net||0),W=Q-L,Re=new Date(D.payments_date).toLocaleString(o?"ar-EG":"en-US",{year:"numeric",month:"short",day:"2-digit",hour12:!1});return e.jsxs(is,{className:X%2===0?"bg-white":"bg-secondary/10",children:[e.jsx(oe,{className:"font-medium text-gray-700",children:e.jsx("button",{onClick:()=>{const es={field:"users_id",value:D.payments_userid.toString()};n(es),r(!0)},className:"p-1 rounded hover:bg-gray-200",children:e.jsx(nr,{className:"w-5 h-5 transform cursor-pointer transition-transform duration-300 "})})}),e.jsx(oe,{className:"font-medium text-gray-700",children:D.payments_id}),e.jsx(oe,{className:"text-gray-700",children:D.payments_userid}),e.jsx(oe,{className:"text-gray-600",children:Re}),e.jsx(oe,{className:" text-gray-800 font-semibold",children:J(Q)}),e.jsx(oe,{className:" text-accent-foreground font-semibold",children:J(L)}),e.jsx(oe,{className:"text-gray-700",children:w?e.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-primary-foreground rounded-lg text-xs",children:[w.coupon_name," (-",w.coupon_discount,"%)"]}):"—"}),e.jsx(oe,{className:"text-gray-700",children:N?e.jsxs("span",{className:"px-2  py-1 bg-purple-100 text-primary rounded-lg text-xs",children:[o?N.offers_titleAr:N.offers_titleEn," ","(-",N.offers_discount,"%)"]}):"—"}),e.jsx(oe,{className:`text-right font-semibold ${W>0?"text-destructive":"text-gray-400"}`,children:W>0?`-${J(W)}`:"—"})]},D.payments_id)})})]})})}),e.jsx(me,{open:i,onOpenChange:r,children:e.jsxs(ue,{className:"sm:max-w-[400px]",children:[e.jsx(ye,{children:e.jsx(xe,{className:"text-start pt-4",children:o?"معلومات المستخدم":"User Information"})}),c?e.jsxs("div",{className:"space-y-2",dir:o?"rtl":"ltr",children:[e.jsxs(l,{variant:"p",children:[e.jsx("strong",{children:o?"الاسم:":"Name:"})," ",c.users_name]}),e.jsxs(l,{variant:"p",children:[e.jsx("strong",{children:o?"الهاتف:":"Phone:"})," ",c.users_phone]})]}):e.jsx(l,{variant:"p",className:"text-muted-foreground",children:o?"جاري التحميل...":"Loading..."}),e.jsx(be,{children:e.jsx(k,{onClick:()=>r(!1),children:o?"إغلاق":"Close"})})]})})]}):!m&&e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(l,{variant:"para",children:"No payments found for this period."})})]})},Xe=rr,Fa=d.createContext({}),P=({...s})=>e.jsx(Fa.Provider,{value:{name:s.name},children:e.jsx(ir,{...s})}),_t=()=>{const s=d.useContext(Fa),t=d.useContext(Pa),{getFieldState:a}=lr(),n=or({name:s.name}),i=a(s.name,n);if(!s)throw new Error("useFormField should be used within <FormField>");const{id:r}=t;return{id:r,name:s.name,formItemId:`${r}-form-item`,formDescriptionId:`${r}-form-item-description`,formMessageId:`${r}-form-item-message`,...i}},Pa=d.createContext({});function O({className:s,...t}){const a=d.useId();return e.jsx(Pa.Provider,{value:{id:a},children:e.jsx("div",{"data-slot":"form-item",className:se("grid gap-2",s),...t})})}function V({className:s,...t}){const{error:a,formItemId:n}=_t();return e.jsx(He,{"data-slot":"form-label","data-error":!!a,className:se("data-[error=true]:text-destructive text-sm font-normal text-muted-foreground",s),htmlFor:n,...t})}function U({...s}){const{error:t,formItemId:a,formDescriptionId:n,formMessageId:i}=_t();return e.jsx(Ut,{"data-slot":"form-control",id:a,"aria-describedby":t?`${n} ${i}`:`${n}`,"aria-invalid":!!t,...s})}function R({className:s,...t}){const{error:a,formMessageId:n}=_t(),i=a?String(a?.message??""):t.children;return i?e.jsx("p",{"data-slot":"form-message",id:n,className:se("text-destructive text-sm",s),...t,children:i}):null}const Rl=Ge({coupon_name:B().min(3,"Coupon name is required"),coupon_discount:Ke().min(1,"Discount value required").max(100,"Max 100"),coupon_count:B().min(1,"Usage limit is required"),coupon_start:B().min(1,"Start date required"),coupon_end:B().min(1,"End date required")});function $l(){const{i18n:s}=re(),[t,a]=d.useState(!1),n=ql(),i=Ve({resolver:Be(Rl),defaultValues:{coupon_name:"",coupon_discount:"",coupon_count:"",coupon_start:"",coupon_end:""}}),r=async c=>{try{a(!0);const x={...c,coupon_start:`${c.coupon_start} 00:00:00`,coupon_end:`${c.coupon_end} 00:00:00`};await n.mutateAsync(x),G.success(s.language==="ar"?"تم إنشاء الكوبون بنجاح!":"Coupon created successfully!"),i.reset()}catch(x){console.error("Error creating coupon:",x),G.error(s.language==="ar"?"فشل في إنشاء الكوبون. حاول مرة أخرى.":"Failed to create coupon. Please try again.")}finally{a(!1)}};return e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full shadow",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Rs,{className:"text-secondary",size:30}),e.jsx(l,{variant:"h2",children:"Create New Coupon"})]}),e.jsx(Xe,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(r),className:"flex flex-wrap gap-4 items-end",children:[e.jsx(P,{name:"coupon_name",control:i.control,render:({field:c})=>e.jsxs(O,{className:"flex-1 min-w-[180px]",children:[e.jsx(V,{children:"Coupon Name*"}),e.jsx(U,{children:e.jsx(F,{placeholder:"e.g., SUMMER50, NEWUSER10",...c})}),e.jsx(R,{})]})}),e.jsx(P,{name:"coupon_discount",control:i.control,render:({field:c})=>e.jsxs(O,{className:"min-w-[120px]",children:[e.jsx(V,{children:"Coupon Discount*"}),e.jsx(U,{children:e.jsx(F,{type:"number",placeholder:"5",...c})}),e.jsx(R,{})]})}),e.jsx(P,{name:"coupon_count",control:i.control,render:({field:c})=>e.jsxs(O,{className:"flex-1 min-w-[180px]",children:[e.jsx(V,{children:"Usage Limit*"}),e.jsx(U,{children:e.jsx(F,{placeholder:"e.g., 20",...c})}),e.jsx(R,{})]})}),e.jsx(P,{name:"coupon_end",control:i.control,render:({field:c})=>e.jsxs(O,{className:"min-w-[180px]",children:[e.jsx(V,{children:"End Date*"}),e.jsx(U,{children:e.jsx(F,{type:"date",placeholder:"Day/Month/Year",...c})}),e.jsx(R,{})]})}),e.jsx(P,{name:"coupon_start",control:i.control,render:({field:c})=>e.jsxs(O,{className:"min-w-[180px]",children:[e.jsx(V,{children:"Start Date*"}),e.jsx(U,{children:e.jsx(F,{type:"date",placeholder:"Day/Month/Year",...c})}),e.jsx(R,{})]})}),e.jsxs("div",{className:"flex gap-2 mt-4 w-full",children:[e.jsx(k,{type:"submit",disabled:t,children:t?"Creating...":"Create Coupon"}),e.jsx(k,{type:"button",variant:"outline",className:"rounded-full border-gray-300",onClick:()=>i.reset(),disabled:t,children:"Clear Fields"})]})]})})]})}function zl(){const{t:s,i18n:t}=re(),{data:a,isLoading:n,error:i,refetch:r}=vt(),c=Tl(),[x,p]=d.useState(!1),[o,j]=d.useState(null),[y,g]=d.useState({coupon_name:"",coupon_count:"",coupon_start:"",coupon_end:"",coupon_discount:""}),[f,_]=d.useState(!1),[q,b]=d.useState(!1),[h,m]=d.useState(null),u=($,H)=>{const Y=new Date,ee=new Date($),J=new Date(H);return Y<ee?{status:"upcoming",label:t.language==="ar"?"قادم":"Upcoming",className:"text-blue-600 bg-blue-100"}:Y>J?{status:"expired",label:t.language==="ar"?"منتهي":"Expired",className:"text-red-600 bg-red-100"}:{status:"active",label:t.language==="ar"?"نشط":"Active",className:"text-green-600 bg-green-100"}},v=$=>{const H=a?.data?.find(Y=>Y.coupon_id===$);H&&(j(H),g({coupon_name:H.coupon_name,coupon_count:H.coupon_count.toString(),coupon_start:H.coupon_start.split("T")[0],coupon_end:H.coupon_end.split("T")[0],coupon_discount:H.coupon_discount?.toString()||""}),p(!0))},A=$=>{const H=a?.data?.find(Y=>Y.coupon_id===$);H&&(m(H),b(!0))},I=async()=>{if(h)try{await c.mutateAsync(h.coupon_id),G.success(t.language==="ar"?"تم حذف الكوبون بنجاح":"Coupon deleted successfully"),b(!1),m(null)}catch($){console.error("Error deleting coupon:",$),G.error(t.language==="ar"?"فشل في حذف الكوبون":"Failed to delete coupon")}},S=async()=>{if(o){_(!0);try{const $={coupon_id:o.coupon_id,coupon_name:y.coupon_name,coupon_count:y.coupon_count,coupon_start:`${y.coupon_start} 00:00:00`,coupon_end:`${y.coupon_end} 00:00:00`,coupon_discount:y.coupon_discount};await Sl($),G.success(t.language==="ar"?"تم تحديث الكوبون بنجاح":"Coupon updated successfully"),p(!1),j(null),r()}catch($){console.error("Error updating coupon:",$),G.error(t.language==="ar"?"فشل في تحديث الكوبون":"Failed to update coupon")}finally{_(!1)}}},C=($,H)=>{g(Y=>({...Y,[$]:H}))},M=d.useMemo(()=>{if(!a?.data||!Array.isArray(a.data)||a.data.length===0)return{active:0,upcoming:0,expired:0,totalCount:0};const $=new Date,H={active:0,upcoming:0,expired:0,totalCount:0},Y=a.data.filter(ee=>ee.coupon_id!==11);return Y.forEach(ee=>{if(!ee.coupon_start||!ee.coupon_end)return;const J=new Date(ee.coupon_start),ae=new Date(ee.coupon_end);isNaN(J.getTime())||isNaN(ae.getTime())||($<J?H.upcoming++:$>ae?H.expired++:H.active++)}),H.totalCount=Y.length,H},[a?.data]);return n?e.jsx($e,{}):i?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(l,{variant:"h2",className:"text-destructive mb-2",children:"خطأ في تحميل البيانات"}),e.jsx(l,{variant:"para",children:i.message||"حدث خطأ أثناء جلب بيانات الكوبونات"})]})}):e.jsxs("div",{className:"flex flex-col gap-10",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(l,{variant:"h2",children:s("coupon_management.title","Coupon Management")}),e.jsx(l,{variant:"p",children:s("coupon_management.subtitle","Create and manage promotional discount coupons")})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4",children:[e.jsx(je,{name:s("coupon_management.active_coupons","Active Coupons"),number:M.active.toString(),icon:e.jsx(Us,{className:"bg-accent-foreground rounded-xl p-2 text-white",size:40})}),e.jsx(je,{name:s("coupon_management.upcoming_coupons","Upcoming"),number:M.upcoming.toString(),icon:e.jsx(ds,{className:"bg-primary-foreground rounded-xl p-2 text-white",size:40})}),e.jsx(je,{name:s("coupon_management.expired_coupons","Expired"),number:M.expired.toString(),icon:e.jsx(cr,{className:"bg-destructive rounded-xl p-2 text-white",size:40})}),e.jsx(je,{name:s("coupon_management.total_count","Total Coupons"),number:M.totalCount.toString(),icon:e.jsx(Rs,{className:"bg-primary rounded-xl p-2 text-white",size:40})})]}),e.jsx($l,{}),e.jsx("div",{className:"p-6",children:a?.data&&a.data.length>0?e.jsxs(Qs,{children:[e.jsx(Ys,{children:e.jsxs(is,{children:[e.jsx(fe,{className:t.language==="ar"?"text-right":"text-left",children:t.language==="ar"?"اسم الكوبون":"Coupon Name"}),e.jsx(fe,{className:"text-center",children:t.language==="ar"?"العدد المتاح":"Available Count"}),e.jsx(fe,{className:"text-center",children:t.language==="ar"?"تاريخ البداية":"Start Date"}),e.jsx(fe,{className:"text-center",children:t.language==="ar"?"تاريخ النهاية":"End Date"}),e.jsx(fe,{className:"text-center",children:t.language==="ar"?"قيمة الخصم":"Discount"}),e.jsx(fe,{className:"text-center",children:t.language==="ar"?"الحالة":"Status"}),e.jsx(fe,{className:"text-center",children:t.language==="ar"?"الإجراءات":"Actions"})]})}),e.jsx(Zs,{children:a.data.filter($=>$.coupon_id!==11).map($=>{const H=u($.coupon_start,$.coupon_end);return e.jsxs(is,{className:"hover:bg-secondary/5",children:[e.jsx(oe,{className:`font-medium ${t.language==="ar"?"text-right":"text-left"}`,children:$.coupon_name}),e.jsx(oe,{className:"text-center",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary/10 text-primary",children:$.coupon_count})}),e.jsx(oe,{className:"text-center text-muted-foreground",children:ts($.coupon_start,t.language)}),e.jsx(oe,{className:"text-center text-muted-foreground",children:ts($.coupon_end,t.language)}),e.jsx(oe,{className:"text-center",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-700",children:[$.coupon_discount,"%"]})}),e.jsx(oe,{className:"text-center",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${H.className}`,children:H.label})}),e.jsx(oe,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(k,{variant:"Edit",size:"sm",onClick:()=>v($.coupon_id),children:e.jsx(We,{size:16})}),e.jsx(k,{variant:"Delete",size:"sm",onClick:()=>A($.coupon_id),className:"h-8 w-8 p-0 hover:bg-destructive/10 hover:text-destructive",children:e.jsx(we,{size:16})})]})})]},$.coupon_id)})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Rs,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx(l,{variant:"h3",className:"text-muted-foreground mb-2",children:t.language==="ar"?"لا توجد كوبونات متاحة":"No Coupons Available"}),e.jsx(l,{variant:"p",className:"text-muted-foreground",children:t.language==="ar"?"قم بإنشاء أول كوبون لك":"Create your first coupon"})]})}),e.jsx(me,{open:x,onOpenChange:p,children:e.jsxs(ue,{className:"sm:max-w-[425px]",children:[e.jsxs(ye,{children:[e.jsx(xe,{className:t.language==="ar"?"text-right":"text-left",children:t.language==="ar"?"تعديل الكوبون":"Edit Coupon"}),e.jsx(Ie,{className:t.language==="ar"?"text-right":"text-left",children:t.language==="ar"?"قم بتعديل معلومات الكوبون أدناه":"Edit the coupon information below"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(He,{htmlFor:"coupon_name",className:`${t.language==="ar"?"text-right col-span-4":"text-right"}`,children:t.language==="ar"?"اسم الكوبون":"Coupon Name"}),e.jsx(F,{id:"coupon_name",value:y.coupon_name,onChange:$=>C("coupon_name",$.target.value),className:"col-span-4",placeholder:t.language==="ar"?"أدخل اسم الكوبون":"Enter coupon name"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(He,{htmlFor:"coupon_count",className:`${t.language==="ar"?"text-right col-span-4":"text-right"}`,children:t.language==="ar"?"العدد المتاح":"Available Count"}),e.jsx(F,{id:"coupon_count",type:"number",value:y.coupon_count,onChange:$=>C("coupon_count",$.target.value),className:"col-span-4",placeholder:t.language==="ar"?"أدخل العدد المتاح":"Enter available count"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(He,{htmlFor:"coupon_discount",className:`${t.language==="ar"?"text-right col-span-4":"text-right"}`,children:t.language==="ar"?"قيمة الخصم":"Discount Value"}),e.jsx(F,{id:"coupon_discount",type:"number",value:y.coupon_discount,onChange:$=>C("coupon_discount",$.target.value),className:"col-span-4",placeholder:t.language==="ar"?"أدخل قيمة الخصم":"Enter discount value"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(He,{htmlFor:"coupon_start",className:`${t.language==="ar"?"text-right col-span-4":"text-right"}`,children:t.language==="ar"?"تاريخ البداية":"Start Date"}),e.jsx(F,{id:"coupon_start",type:"date",value:y.coupon_start,onChange:$=>C("coupon_start",$.target.value),className:"col-span-4"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(He,{htmlFor:"coupon_end",className:`${t.language==="ar"?"text-right col-span-4":"text-right"}`,children:t.language==="ar"?"تاريخ النهاية":"End Date"}),e.jsx(F,{id:"coupon_end",type:"date",value:y.coupon_end,onChange:$=>C("coupon_end",$.target.value),className:"col-span-4"})]})]}),e.jsxs(be,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>p(!1),disabled:f,children:t.language==="ar"?"إلغاء":"Cancel"}),e.jsx(k,{type:"button",onClick:S,disabled:f,children:f?e.jsxs(e.Fragment,{children:[e.jsx($e,{size:"sm"}),t.language==="ar"?"جاري التحديث...":"Updating..."]}):t.language==="ar"?"حفظ التغييرات":"Save Changes"})]})]})}),e.jsx(me,{open:q,onOpenChange:b,children:e.jsxs(ue,{className:"max-w-md",children:[e.jsxs(ye,{children:[e.jsxs(xe,{className:"flex items-center pt-5 gap-2 text-destructive",children:[e.jsx(we,{className:"w-5 h-5"}),t.language==="ar"?"تأكيد الحذف":"Confirm Delete"]}),e.jsx(Ie,{children:t.language==="ar"?`هل أنت متأكد من حذف الكوبون "${h?.coupon_name}"؟ لا يمكن التراجع عن هذا الإجراء.`:`Are you sure you want to delete the coupon "${h?.coupon_name}"? This action cannot be undone.`})]}),e.jsxs(be,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>{b(!1),m(null)},disabled:c.isPending,children:t.language==="ar"?"إلغاء":"Cancel"}),e.jsx(k,{type:"button",variant:"destructive",onClick:I,disabled:c.isPending,children:c.isPending?e.jsxs(e.Fragment,{children:[e.jsx($e,{size:"sm"}),t.language==="ar"?"جاري الحذف...":"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),t.language==="ar"?"حذف":"Delete"]})})]})]})})]})}const Ul=async()=>{try{return(await K.post(`${z}/api84818datar/getDataActivities`)).data}catch(s){throw s}},Gl=async s=>{try{return(await K.post(`${z}/api84818datar/insertDataActivities`,s)).data}catch(t){throw t}},Vl=async s=>{try{return(await K.post(`${z}/api84818datar/updateDataActivities`,s)).data}catch(t){throw t}},Bl=async s=>{try{return(await K.post(`${z}/api84818datar/deleteDataActivities`,{activities_id:s})).data}catch(t){throw t}},Hl=()=>ie({queryKey:["activities"],queryFn:Ul}),Oa=()=>{const s=pe();return de({mutationFn:Gl,onSuccess:()=>{s.invalidateQueries({queryKey:["activities"]})}})},La=()=>{const s=pe();return de({mutationFn:Vl,onSuccess:()=>{s.invalidateQueries({queryKey:["activities"]})}})},Kl=()=>{const s=pe();return de({mutationFn:Bl,onSuccess:()=>{s.invalidateQueries({queryKey:["activities"]})}})};function Wl({variant:s="activity",height:t=450,showImage:a=!0,showIcon:n=!0,showTitle:i=!0,showSubtitle:r=!0,showButtons:c=!0}){const x=`
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200px 100%;
      animation: shimmer 1.5s infinite;
    }
    
    .card-loading {
      animation: cardPulse 2s ease-in-out infinite;
    }
    
    @keyframes shimmer {
      0% { background-position: -200px 0; }
      100% { background-position: calc(200px + 100%) 0; }
    }
    
    @keyframes cardPulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(0.98); }
    }
  `,p=()=>e.jsxs("div",{className:"bg-white flex flex-col rounded-xl shadow-lg overflow-hidden card-loading",style:{height:`${t}px`},children:[a&&e.jsxs("div",{className:"relative h-48 flex-shrink-0 skeleton",children:[n&&e.jsx("div",{className:"absolute top-4 left-4 bg-white/20 backdrop-blur-sm rounded-full p-2",children:e.jsx("div",{className:"w-6 h-6 bg-white/50 rounded"})}),n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"bg-white/20 backdrop-blur-sm rounded-full p-4 border-2 border-white/30",children:e.jsx("div",{className:"w-12 h-12 bg-white/50 rounded-full"})})})]}),e.jsxs("div",{className:"p-6 flex flex-col flex-1",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[i&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded skeleton"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 skeleton"})]}),r&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded skeleton"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6 skeleton"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3 skeleton"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-200 rounded skeleton"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20 skeleton"})]})]}),c&&e.jsxs("div",{className:"flex items-center gap-3 pt-4 mt-auto",children:[e.jsx("div",{className:"flex-1 h-10 bg-gray-200 rounded skeleton"}),e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded skeleton"})]})]})]}),o=()=>e.jsx("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden card-loading",style:{height:`${t}px`},children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded skeleton"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 skeleton"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2 skeleton"})]}),c&&e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("div",{className:"flex-1 h-10 bg-gray-200 rounded skeleton"}),e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded skeleton"})]})]})});return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:x}),s==="activity"?p():o()]})}const Ql=Ge({titleEn:B().min(1,"English title is required"),titleAr:B().min(1,"العنوان بالعربية مطلوب"),subtitleEn:B().optional(),subtitleAr:B().optional()});function Yl({open:s,onOpenChange:t,mutation:a}){const{t:n,i18n:i}=re(),r=i.language==="ar",[c,x]=d.useState(null),[p,o]=d.useState(null),j=a||Oa(),y=Ve({resolver:Be(Ql),defaultValues:{titleEn:"",titleAr:"",subtitleEn:"",subtitleAr:""}}),g=m=>{const u=m.target.files[0];u&&f(u)},f=m=>{if(m.size>5*1024*1024){G.error(r?n("add_activity.file_too_large","حجم الملف يجب أن يكون أقل من 5 ميجابايت"):n("add_activity.file_too_large_en","File size must be less than 5MB"),{description:r?n("add_activity.file_too_large_desc","ملفات SVG يجب أن تكون أصغر للأداء الأفضل"):n("add_activity.file_too_large_desc_en","SVG files should be smaller for better performance"),duration:4e3});return}if(m.type!=="image/svg+xml"){G.error(r?n("add_activity.invalid_file_type","يرجى اختيار ملف SVG صحيح"):n("add_activity.invalid_file_type_en","Please select a valid SVG file"),{description:r?n("add_activity.svg_only_desc","يُسمح فقط بملفات SVG للجودة الأفضل والقابلية للتكبير"):n("add_activity.svg_only_desc_en","Only SVG files are allowed for better quality and scalability"),duration:4e3});return}x(m);const u=new FileReader;u.onload=v=>{o(v.target.result)},u.readAsDataURL(m),G.success(r?n("add_activity.file_selected","تم اختيار ملف SVG بنجاح"):n("add_activity.file_selected_en","SVG file selected successfully"),{description:r?n("add_activity.file_selected_desc","ملف SVG جاهز للرفع"):n("add_activity.file_selected_desc_en","Your SVG file is ready for upload"),duration:2e3})},_=async m=>{try{const u=new FormData;u.append("activities_titleEn",m.titleEn.trim()),u.append("activities_titleAr",m.titleAr.trim()),u.append("activities_subtitleEn",m.subtitleEn?.trim()||""),u.append("activities_subtitleAr",m.subtitleAr?.trim()||""),c&&u.append("activities_img",c),await j.mutateAsync(u),q()}catch(u){console.error("Error adding activity:",u)}},q=()=>{y.reset(),x(null),o(null)},b=()=>{j.isPending||(q(),t(!1))},h=j.isPending;return e.jsx(me,{open:s,onOpenChange:b,children:e.jsxs(ue,{className:"sm:max-w-[600px] pt-10 max-h-[90vh] overflow-y-auto",children:[e.jsxs(ye,{children:[e.jsx(xe,{className:"text-xl font-bold text-start",children:r?n("add_activity.title","إضافة نشاط جديد"):n("add_activity.title_en","Add New Activity")}),e.jsx(Ie,{className:"text-start",children:r?n("add_activity.description","إنشاء فئة نشاط جديدة مع جميع المعلومات المطلوبة"):n("add_activity.description_en","Create a new activity category with all required information")})]}),e.jsx(Xe,{...y,children:e.jsxs("form",{onSubmit:y.handleSubmit(_),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{variant:"p",className:"text-sm font-medium",children:r?n("add_activity.activity_image","صورة النشاط"):n("add_activity.activity_image_en","Activity Image")}),e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors",children:[p?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:p,alt:"Preview",className:"w-full h-full object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>{x(null),o(null)},className:"absolute top-2 right-2 bg-destructive text-white rounded-full p-1 hover:bg-destructive/90 transition-colors",children:e.jsx(ve,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(ms,{className:"w-8 h-8 mb-2 text-gray-400"}),e.jsx(l,{variant:"para",className:"text-sm text-gray-500",children:r?n("add_activity.upload_text","انقر للرفع"):n("add_activity.upload_text_en","Click to upload")}),e.jsx(l,{variant:"para",className:"text-xs text-gray-400",children:r?n("add_activity.svg_only","ملفات SVG فقط"):n("add_activity.svg_only_en","SVG files only")})]}),e.jsx("input",{type:"file",className:"hidden",accept:".svg,image/svg+xml",onChange:g,disabled:h})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{control:y.control,name:"titleEn",render:({field:m})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?n("add_activity.title_en","العنوان (إنجليزي)"):n("add_activity.title_en_en","Title (English)")," ","*"]}),e.jsx(U,{children:e.jsx(F,{placeholder:r?n("add_activity.title_en_placeholder","أدخل العنوان بالإنجليزية"):n("add_activity.title_en_placeholder_en","Enter English title"),disabled:h,...m})}),e.jsx(R,{})]})}),e.jsx(P,{control:y.control,name:"titleAr",render:({field:m})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?n("add_activity.title_ar","العنوان (عربي)"):n("add_activity.title_ar_en","Title (Arabic)")," ","*"]}),e.jsx(U,{children:e.jsx(F,{placeholder:r?n("add_activity.title_ar_placeholder","أدخل العنوان بالعربية"):n("add_activity.title_ar_placeholder_en","Enter Arabic title"),disabled:h,dir:"rtl",...m})}),e.jsx(R,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{control:y.control,name:"subtitleEn",render:({field:m})=>e.jsxs(O,{children:[e.jsx(V,{children:r?n("add_activity.subtitle_en","العنوان الفرعي (إنجليزي)"):n("add_activity.subtitle_en_en","Subtitle (English)")}),e.jsx(U,{children:e.jsx(F,{placeholder:r?n("add_activity.subtitle_en_placeholder","أدخل العنوان الفرعي بالإنجليزية"):n("add_activity.subtitle_en_placeholder_en","Enter English subtitle"),disabled:h,...m})}),e.jsx(R,{})]})}),e.jsx(P,{control:y.control,name:"subtitleAr",render:({field:m})=>e.jsxs(O,{children:[e.jsx(V,{children:r?n("add_activity.subtitle_ar","العنوان الفرعي (عربي)"):n("add_activity.subtitle_ar_en","Subtitle (Arabic)")}),e.jsx(U,{children:e.jsx(F,{placeholder:r?n("add_activity.subtitle_ar_placeholder","أدخل العنوان الفرعي بالعربية"):n("add_activity.subtitle_ar_placeholder_en","Enter Arabic subtitle"),disabled:h,dir:"rtl",...m})}),e.jsx(R,{})]})})]}),e.jsxs(be,{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(k,{type:"button",variant:"outline",onClick:b,disabled:h,className:"w-full sm:w-auto",children:r?n("add_activity.cancel","إلغاء"):n("add_activity.cancel_en","Cancel")}),e.jsx(k,{type:"submit",disabled:h||!y.formState.isValid,className:"w-full sm:w-auto",children:h?e.jsxs(e.Fragment,{children:[e.jsx(vs,{className:"w-4 h-4 mr-2 animate-spin"}),r?n("add_activity.saving","جاري الحفظ..."):n("add_activity.saving_en","Saving...")]}):e.jsxs(e.Fragment,{children:[e.jsx(_s,{className:"w-4 h-4 mr-2"}),r?n("add_activity.save","حفظ النشاط"):n("add_activity.save_en","Save Activity")]})})]})]})})]})})}const Zl=Ge({titleEn:B().min(1,"English title is required"),titleAr:B().min(1,"العنوان بالعربية مطلوب"),subtitleEn:B().optional(),subtitleAr:B().optional()});function Jl({open:s,onOpenChange:t,mutation:a,activity:n}){const{t:i,i18n:r}=re(),c=r.language==="ar",[x,p]=d.useState(null),[o,j]=d.useState(null),y=a||La(),g=Ve({resolver:Be(Zl),defaultValues:{titleEn:"",titleAr:"",subtitleEn:"",subtitleAr:""}});d.useEffect(()=>{n&&(console.log("Loading activity data for editing:",n),g.reset({titleEn:n.activities_titleEn||"",titleAr:n.activities_titleAr||"",subtitleEn:n.activities_subtitleEn||"",subtitleAr:n.activities_subtitleAr||""}),p(null),j(null))},[n,g]);const f=v=>{const A=v.target.files[0];A&&_(A)},_=v=>{if(v.size>5*1024*1024){G.error(c?i("edit_activity.file_too_large","حجم الملف يجب أن يكون أقل من 5 ميجابايت"):i("edit_activity.file_too_large_en","File size must be less than 5MB"),{description:c?i("edit_activity.file_too_large_desc","ملفات SVG يجب أن تكون أصغر للأداء الأفضل"):i("edit_activity.file_too_large_desc_en","SVG files should be smaller for better performance"),duration:4e3});return}if(v.type!=="image/svg+xml"){G.error(c?i("edit_activity.invalid_file_type","يرجى اختيار ملف SVG صحيح"):i("edit_activity.invalid_file_type_en","Please select a valid SVG file"),{description:c?i("edit_activity.svg_only_desc","يُسمح فقط بملفات SVG للجودة الأفضل والقابلية للتكبير"):i("edit_activity.svg_only_desc_en","Only SVG files are allowed for better quality and scalability"),duration:4e3});return}p(v);const A=new FileReader;A.onload=I=>{j(I.target.result)},A.readAsDataURL(v)},q=async v=>{try{const A=new FormData;A.append("activities_id",n.activities_id),A.append("activities_titleEn",v.titleEn.trim()),A.append("activities_titleAr",v.titleAr.trim()),A.append("activities_subtitleEn",v.subtitleEn?.trim()||""),A.append("activities_subtitleAr",v.subtitleAr?.trim()||""),x&&A.append("activities_img",x),await y.mutateAsync(A),b()}catch(A){console.error("Error updating activity:",A)}},b=()=>{g.reset(),p(null),j(null)},h=()=>{y.isPending||(b(),t(!1))},m=y.isPending,u=n?.activities_img?`${ht}/${n.activities_img}`:null;return e.jsx(me,{open:s,onOpenChange:h,children:e.jsxs(ue,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ye,{children:[e.jsxs(xe,{className:"text-xl font-bold text-start flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5 text-blue-600"}),c?i("edit_activity.title","تعديل النشاط"):i("edit_activity.title_en","Edit Activity")]}),e.jsxs(Ie,{className:"text-start",children:[c?i("edit_activity.description","تعديل معلومات النشاط المحدد وتحديث بياناته"):i("edit_activity.description_en","Edit the selected activity information and update its data"),n&&e.jsx("div",{className:"mt-2 p-2 bg-blue-50 rounded-md border border-blue-200",children:e.jsx(l,{variant:"para",className:"text-sm text-blue-700 font-medium",children:c?`تعديل: ${n.activities_titleAr||n.activities_titleEn}`:`Editing: ${n.activities_titleEn||n.activities_titleAr}`})})]})]}),e.jsx(Xe,{...g,children:e.jsxs("form",{onSubmit:g.handleSubmit(q),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{variant:"p",className:"text-sm font-medium",children:c?i("edit_activity.activity_image","صورة النشاط"):i("edit_activity.activity_image_en","Activity Image")}),e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{className:"flex flex-col items-center justify-center w-[50%] sm:w-[25%]  sm:p-2 h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors",children:[o?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:o,alt:"Preview",className:"w-full h-full object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>{p(null),j(null)},className:"absolute top-2 right-2 bg-destructive text-white rounded-full p-1 hover:bg-destructive/90 transition-colors",children:e.jsx(ve,{className:"w-4 h-4"})})]}):u?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:u,alt:"Current",className:"w-full h-full object-cover rounded-lg"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:e.jsx(l,{variant:"para",className:"text-white text-sm",children:c?i("edit_activity.change_image","تغيير الصورة"):i("edit_activity.change_image_en","Change Image")})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(ms,{className:"w-8 h-8 mb-2 text-gray-400"}),e.jsx(l,{variant:"para",className:"text-sm text-gray-500",children:c?i("edit_activity.upload_text","انقر للرفع"):i("edit_activity.upload_text_en","Click to upload")}),e.jsx(l,{variant:"para",className:"text-xs text-gray-400",children:c?i("edit_activity.svg_only","ملفات SVG فقط"):i("edit_activity.svg_only_en","SVG files only")})]}),e.jsx("input",{type:"file",className:"hidden",accept:".svg,image/svg+xml",onChange:f,disabled:m})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{control:g.control,name:"titleEn",render:({field:v})=>e.jsxs(O,{children:[e.jsxs(V,{children:[c?i("edit_activity.title_en","العنوان (إنجليزي)"):i("edit_activity.title_en_en","Title (English)")," ","*"]}),e.jsx(U,{children:e.jsx(F,{placeholder:c?i("edit_activity.title_en_placeholder","أدخل العنوان بالإنجليزية"):i("edit_activity.title_en_placeholder_en","Enter English title"),disabled:m,...v})}),e.jsx(R,{})]})}),e.jsx(P,{control:g.control,name:"titleAr",render:({field:v})=>e.jsxs(O,{children:[e.jsxs(V,{children:[c?i("edit_activity.title_ar","العنوان (عربي)"):i("edit_activity.title_ar_en","Title (Arabic)")," ","*"]}),e.jsx(U,{children:e.jsx(F,{placeholder:c?i("edit_activity.title_ar_placeholder","أدخل العنوان بالعربية"):i("edit_activity.title_ar_placeholder_en","Enter Arabic title"),disabled:m,dir:"rtl",...v})}),e.jsx(R,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{control:g.control,name:"subtitleEn",render:({field:v})=>e.jsxs(O,{children:[e.jsx(V,{children:c?i("edit_activity.subtitle_en","العنوان الفرعي (إنجليزي)"):i("edit_activity.subtitle_en_en","Subtitle (English)")}),e.jsx(U,{children:e.jsx(F,{placeholder:c?i("edit_activity.subtitle_en_placeholder","أدخل العنوان الفرعي بالإنجليزية"):i("edit_activity.subtitle_en_placeholder_en","Enter English subtitle"),disabled:m,...v})}),e.jsx(R,{})]})}),e.jsx(P,{control:g.control,name:"subtitleAr",render:({field:v})=>e.jsxs(O,{children:[e.jsx(V,{children:c?i("edit_activity.subtitle_ar","العنوان الفرعي (عربي)"):i("edit_activity.subtitle_ar_en","Subtitle (Arabic)")}),e.jsx(U,{children:e.jsx(F,{placeholder:c?i("edit_activity.subtitle_ar_placeholder","أدخل العنوان الفرعي بالعربية"):i("edit_activity.subtitle_ar_placeholder_en","Enter Arabic subtitle"),disabled:m,dir:"rtl",...v})}),e.jsx(R,{})]})})]}),e.jsxs(be,{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(k,{type:"button",variant:"outline",onClick:h,disabled:m,className:"w-full sm:w-auto",children:c?i("edit_activity.cancel","إلغاء"):i("edit_activity.cancel_en","Cancel")}),e.jsx(k,{type:"submit",disabled:m||!g.formState.isValid,className:"w-full sm:w-auto bg-blue-600 hover:bg-blue-700",children:m?e.jsxs(e.Fragment,{children:[e.jsx(vs,{className:"w-4 h-4 mr-2 animate-spin"}),c?i("edit_activity.updating","جاري التحديث..."):i("edit_activity.updating_en","Updating...")]}):e.jsxs(e.Fragment,{children:[e.jsx(_s,{className:"w-4 h-4 mr-2"}),c?i("edit_activity.update","حفظ التعديلات"):i("edit_activity.update_en","Save Changes")]})})]})]})})]})})}const Ra={isAddDialogOpen:!1,isEditDialogOpen:!1,isDeleteDialogOpen:!1,selectedActivity:null,activityToDelete:null};function Xl(s,t){switch(console.log("Dialog reducer action:",t.type,t.payload),t.type){case DIALOG_ACTIONS.OPEN_ADD:return{...s,isAddDialogOpen:!0,isEditDialogOpen:!1,isDeleteDialogOpen:!1};case DIALOG_ACTIONS.OPEN_EDIT:return{...s,isEditDialogOpen:!0,isAddDialogOpen:!1,isDeleteDialogOpen:!1,selectedActivity:t.payload};case DIALOG_ACTIONS.OPEN_DELETE:return{...s,isDeleteDialogOpen:!0,isAddDialogOpen:!1,isEditDialogOpen:!1,activityToDelete:t.payload};case DIALOG_ACTIONS.CLOSE_ALL:return{...Ra};default:return s}}function eo(s,t,a){const{addActivityMutation:n,updateActivityMutation:i,deleteActivityMutation:r}=s;ke.useEffect(()=>{n.isSuccess&&(G.success(t?"تم إضافة النشاط بنجاح!":"Activity added successfully!",{description:t?"تم إضافة النشاط الجديد إلى قائمتك.":"The new activity has been added to your list.",duration:3e3}),a({type:DIALOG_ACTIONS.CLOSE_ALL}))},[n.isSuccess,t,a]),ke.useEffect(()=>{i.isSuccess&&(G.success(t?"تم تحديث النشاط بنجاح!":"Activity updated successfully!",{description:t?"تم تحديث النشاط بنجاح.":"The activity has been updated successfully.",duration:3e3}),a({type:DIALOG_ACTIONS.CLOSE_ALL}))},[i.isSuccess,t,a]),ke.useEffect(()=>{r.isSuccess&&(G.success(t?"تم حذف النشاط بنجاح!":"Activity deleted successfully!",{description:t?"تم حذف النشاط من النظام.":"The activity has been deleted from the system.",duration:3e3}),a({type:DIALOG_ACTIONS.CLOSE_ALL}))},[r.isSuccess,t,a]),ke.useEffect(()=>{n.isError&&G.error(t?"فشل في إضافة النشاط":"Failed to add activity",{description:t?"يرجى التحقق من بياناتك والمحاولة مرة أخرى.":"Please check your data and try again.",duration:5e3})},[n.isError,t]),ke.useEffect(()=>{i.isError&&G.error(t?"فشل في تحديث النشاط":"Failed to update activity",{description:t?"يرجى التحقق من بياناتك والمحاولة مرة أخرى.":"Please check your data and try again.",duration:5e3})},[i.isError,t]),ke.useEffect(()=>{r.isError&&G.error(t?"فشل في حذف النشاط":"Failed to delete activity",{description:t?"يرجى المحاولة مرة أخرى.":"Please try again.",duration:5e3})},[r.isError,t])}function so(){const{t:s,i18n:t}=re(),a=t.language==="ar",[n,i]=d.useState(""),[r,c]=d.useReducer(Xl,Ra),{data:x,isLoading:p,error:o}=Hl(),j=Oa(),y=La(),g=Kl();eo({addActivityMutation:j,updateActivityMutation:y,deleteActivityMutation:g},a,c);const _=d.useMemo(()=>x?.data||[],[x?.data]),q=d.useMemo(()=>{if(!n.trim())return _;const A=n.toLowerCase();return _.filter(I=>I.activities_titleEn?.toLowerCase().includes(A)||I.activities_titleAr?.toLowerCase().includes(A))},[_,n]),b=d.useCallback(()=>{c({type:DIALOG_ACTIONS.OPEN_ADD})},[]),h=d.useCallback(A=>{console.log("Opening edit dialog for activity:",A),c({type:DIALOG_ACTIONS.OPEN_EDIT,payload:A})},[]),m=d.useCallback(A=>{c({type:DIALOG_ACTIONS.OPEN_DELETE,payload:A})},[]),u=d.useCallback(()=>{c({type:DIALOG_ACTIONS.CLOSE_ALL})},[]),v=d.useCallback(A=>{i(A.target.value)},[]);return o?e.jsx("div",{className:"text-center text-destructive py-6",children:s("error_loading_activities")}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{variant:"h2",children:s("exercise_management.title","Exercise Management")}),e.jsx(l,{variant:"para",children:s("exercise_management.subtitle","Manage workout categories, training programs, and exercises")})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"py-1 px-3 flex items-center gap-2 text-sm text-muted-foreground border-1 border-muted-foreground rounded-full w-fit",children:[e.jsxs(l,{variant:"p",children:[" ",q.length]}),e.jsx(l,{variant:"p",children:s("exercise_management.categories","Categories")})]}),e.jsxs(k,{onClick:b,children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),s("exercise_management.add_category")]})]})]}),e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(F,{type:"text",placeholder:s("exercise_management.search_placeholder","Search categories..."),value:n,onChange:v,className:"pl-10"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:p?Array.from({length:8}).map((A,I)=>e.jsx(Wl,{variant:"activity",height:450},`skeleton-${I}`)):q.map(A=>e.jsx(to,{activity:A,isArabic:a,onEdit:()=>h(A),onDelete:()=>m(A)},A.activities_id))}),!p&&q.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(l,{variant:"para",children:n?s("exercise_management.no_search_results","No categories match your search"):s("exercise_management.no_categories","No categories found")}),e.jsx(l,{variant:"para",children:n?s("exercise_management.try_different_search","Try adjusting your search terms"):s("exercise_management.add_first_category","Add your first category to get started")})]}),e.jsx(Yl,{open:r.isAddDialogOpen,onOpenChange:u,mutation:j}),e.jsx(Jl,{open:r.isEditDialogOpen,onOpenChange:u,mutation:y,activity:r.selectedActivity}),e.jsx(ao,{open:r.isDeleteDialogOpen,onOpenChange:u,activity:r.activityToDelete,isArabic:a,mutation:g})]})}const to=ke.memo(function({activity:t,isArabic:a,onEdit:n,onDelete:i}){const{t:r}=re(),c=d.useMemo(()=>a?t.activities_titleAr:t.activities_titleEn,[t.activities_titleAr,t.activities_titleEn,a]),x=d.useMemo(()=>a?t.activities_subtitleAr:t.activities_subtitleEn,[t.activities_subtitleAr,t.activities_subtitleEn,a]),p=d.useCallback(o=>{o.target&&(o.target.style.display="none")},[]);return e.jsxs("div",{className:"bg-white flex flex-col rounded-lg shadow-lg  hover:shadow-xl transition-all duration-300 transform hover:scale-105 card-fade-in",children:[e.jsxs("div",{className:"relative border-1  border-secondary/50 bg-gradient-to-t  from-white/80 to-white/60 h-32 flex-shrink-0 rounded-t-lg ",children:[e.jsx("div",{className:"absolute top-3 left-3 z-10",children:e.jsx(k,{variant:"ghost",size:"icon",className:"w-8 h-8 bg-white/80 hover:bg-red-50 hover:text-destructive transition-colors backdrop-blur-sm",onClick:i,title:a?"حذف النشاط":"Delete Activity",children:e.jsx(we,{className:"w-4 h-4"})})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"bg-white backdrop-blur-sm rounded-lg p-2  shadow-lg",children:e.jsx("img",{src:`${ht}/${t.activities_img}`,alt:`${c} icon`,className:"w-8 h-8 object-contain",onError:p,loading:"lazy"})})})]}),e.jsxs("div",{className:"p-6 flex flex-col flex-1 ",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(l,{variant:"md",children:c}),e.jsx(l,{variant:"para",children:x}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(Ts,{className:"w-4 h-4 flex-shrink-0"}),e.jsxs(l,{variant:"para",children:[t.programs_count||0," ",r("exercise_management.programs","Programs")]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 ",children:[e.jsx(ea,{to:`/dashboard/training/${t.activities_id}`,state:{activityName:{ar:t.activities_titleAr,en:t.activities_titleEn},activityId:t.activities_id},children:e.jsxs(k,{variant:"secondary",children:[e.jsx(dr,{className:"text-white"}),e.jsxs(l,{variant:"whiteSmall",children:[" ",r("exercise_management.manage_programs","Manage Programs")]})]})}),e.jsx(k,{variant:"ghost",size:"icon",className:"w-8 h-8 text-primary  hover:text-accent-foreground transition-colors cursor-pointer",onClick:n,title:a?"تعديل النشاط":"Edit Activity",children:e.jsx(We,{className:"w-4 h-4"})})]})]})]})}),ao=ke.memo(function({open:t,onOpenChange:a,activity:n,isArabic:i,mutation:r}){const c=d.useCallback(async()=>{if(n)try{await r.mutateAsync(n.activities_id),a(!1)}catch(j){console.error("Error deleting activity:",j)}},[n,r,a]),x=d.useCallback(()=>{a(!1)},[a]),p=d.useMemo(()=>n?i?n.activities_titleAr:n.activities_titleEn:"",[n,i]),o=d.useMemo(()=>n?i?n.activities_subtitleAr:n.activities_subtitleEn:"",[n,i]);return n?e.jsx(me,{open:t,onOpenChange:a,children:e.jsxs(ue,{className:"sm:max-w-[500px]",children:[e.jsxs(ye,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-16 h-16 bg-gradient-to-br from-red-100 shadow to-red-200 rounded-full flex items-center justify-center",children:e.jsx(we,{className:"w-8 h-8 text-destructive"})}),e.jsx(xe,{className:"text-xl font-bold text-destructive text-center",children:i?"تأكيد حذف النشاط":"Confirm Activity Deletion"}),e.jsx(Ie,{className:"text-center text-gray-600",children:i?"هل أنت متأكد من حذف هذا النشاط؟ هذا الإجراء لا يمكن التراجع عنه.":"Are you sure you want to delete this activity? This action cannot be undone."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-primary/20 to-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx("img",{src:`${ht}/${n.activities_img}`,alt:"Activity",className:"w-6 h-6 object-contain"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{variant:"h3",children:p}),e.jsx(l,{variant:"para",children:o})]})]})}),e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-red-200 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-destructive text-xs font-bold",children:"!"})}),e.jsx(l,{variant:"para",className:"text-sm text-destructive",children:i?"سيتم حذف هذا النشاط نهائياً من النظام. لا يمكن استرداد البيانات المحذوفة.":"This activity will be permanently deleted from the system. Deleted data cannot be recovered."})]})})]}),e.jsxs(be,{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[e.jsx(k,{type:"button",variant:"outline",onClick:x,className:"w-full sm:w-auto order-2 sm:order-1",children:i?"إلغاء":"Cancel"}),e.jsx(k,{type:"button",variant:"destructive",onClick:c,disabled:r.isPending,className:"w-full sm:w-auto order-1 sm:order-2",children:r.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 mr-2 animate-spin rounded-full border-2 border-white border-t-transparent"}),i?"جاري الحذف...":"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),i?"حذف النشاط":"Delete Activity"]})})]})]})}):null}),no=5*1024*1024,ro=["image/jpeg","image/jpg","image/png"],io=s=>Ge({trainings_nameEn:B({required_error:s("training.name_en_placeholder")}).min(3,s("training.validation.name_en_min")),trainings_nameAr:B({required_error:s("training.name_ar_placeholder")}).min(3,s("training.validation.name_ar_min")),trainings_img:Je().refine(t=>t?.length>=1,s("training.validation.image_required")).refine(t=>t?.[0]?.size<=no,s("training.validation.image_size")).refine(t=>ro.includes(t?.[0]?.type),s("training.validation.image_type"))});function lo({open:s,onOpenChange:t,activityData:a}){const{t:n,i18n:i}=re(),r=i.language==="ar",{id:c}=Vs(),[x,p]=d.useState(null),[o,j]=d.useState(!1),y=tl(c),g=d.useMemo(()=>io(n),[n]),f=Ve({resolver:Be(g),defaultValues:{trainings_nameEn:"",trainings_nameAr:"",trainings_img:null}}),_=(m,u)=>{const v=m.target.files?.[0];if(v){u.onChange([v]);const A=new FileReader;A.onloadend=()=>{p(A.result)},A.readAsDataURL(v)}},q=m=>{m.onChange(null),p(null);const u=document.getElementById("training-image");u&&(u.value="")},b=async m=>{try{j(!0);const u=new FormData;u.append("trainings_nameEn",m.trainings_nameEn),u.append("trainings_nameAr",m.trainings_nameAr),u.append("training_activities_id",c),m.trainings_img&&m.trainings_img[0]&&u.append("trainings_img",m.trainings_img[0]),await y.mutateAsync(u),G.success(n("training.toasts.success")),f.reset(),p(null),t(!1)}catch(u){console.error("Error adding training:",u),G.error(n("training.toasts.error"))}finally{j(!1)}},h=()=>{o||(f.reset(),p(null),t(!1))};return e.jsx(me,{open:s,onOpenChange:h,children:e.jsxs(ue,{className:"max-w-md w-full rounded-xl p-6 pt-12",children:[e.jsxs(ye,{children:[e.jsxs(xe,{className:"flex items-center gap-2 text-xl text-start",children:[e.jsx(Ye,{className:"h-6 w-6 text-primary"}),n("training.add_title")]}),e.jsx(Ie,{children:a?e.jsxs("div",{className:"space-y-2 text-start",children:[e.jsx(l,{variant:"p",children:n("training.add_description")}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-primary/5 rounded-lg border border-primary/10",children:[e.jsx(Ye,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-primary",children:r?a.activities_titleAr:a.activities_titleEn})]})]}):e.jsx("div",{className:"text-start",children:e.jsx(l,{children:n("training.add_description")})})})]}),e.jsx(Xe,{...f,children:e.jsxs("form",{onSubmit:f.handleSubmit(b),className:"space-y-4",children:[e.jsx(P,{control:f.control,name:"trainings_nameEn",render:({field:m})=>e.jsxs(O,{children:[e.jsx(V,{children:n("training.name_en_label")}),e.jsx(U,{children:e.jsx(F,{...m,placeholder:n("training.name_en_placeholder"),disabled:o})}),e.jsx(R,{})]})}),e.jsx(P,{control:f.control,name:"trainings_nameAr",render:({field:m})=>e.jsxs(O,{children:[e.jsx(V,{children:n("training.name_ar_label")}),e.jsx(U,{children:e.jsx(F,{...m,placeholder:n("training.name_ar_placeholder"),disabled:o})}),e.jsx(R,{})]})}),e.jsx(P,{control:f.control,name:"trainings_img",render:({field:m})=>e.jsxs(O,{children:[e.jsx(V,{children:n("training.image_label")}),e.jsx(U,{children:e.jsx("div",{className:"space-y-2",children:x?e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:x,alt:n("training.image_preview_alt"),className:"w-full h-32 object-cover rounded-lg border"}),e.jsx("button",{type:"button",onClick:()=>q(m),disabled:o,className:"absolute -top-2 -right-2 bg-destructive text-white rounded-full p-1 hover:bg-destructive/90 transition-colors",children:e.jsx(ve,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary transition-colors",children:[e.jsx("input",{id:"training-image",type:"file",accept:"image/jpeg,image/jpg,image/png",onChange:u=>_(u,m),disabled:o,className:"hidden"}),e.jsxs("label",{htmlFor:"training-image",className:"cursor-pointer flex flex-col items-center gap-2",children:[e.jsx(ms,{className:"h-8 w-8 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:n("training.upload_image")}),e.jsx("span",{className:"text-xs text-gray-400",children:n("training.image_upload_hint")})]})]})})}),e.jsx(R,{})]})}),e.jsxs(be,{className:"gap-2 pt-4",children:[e.jsx(k,{type:"button",variant:"outline",onClick:h,disabled:o,children:n("common.cancel")}),e.jsx(k,{type:"submit",disabled:o,className:"min-w-[100px]",children:o?e.jsxs(e.Fragment,{children:[e.jsx(vs,{className:"h-4 w-4 animate-spin mr-2"}),n("common.saving")]}):e.jsxs(e.Fragment,{children:[e.jsx(_s,{className:"h-4 w-4 mr-2"}),n("common.save")]})})]})]})})]})})}const oo=Ge({trainings_nameEn:B().min(1,"English training name is required").min(3,"Minimum 3 characters required"),trainings_nameAr:B().min(1,"اسم التمرين بالعربية مطلوب").min(3,"الحد الأدنى 3 أحرف"),trainings_img:Je().optional().refine(s=>!s||s.length===0||s[0]?.size<=5e6,"File size should be less than 5MB").refine(s=>!s||s.length===0||["image/jpeg","image/png","image/jpg"].includes(s[0]?.type),"Only JPEG, JPG and PNG files are accepted")}),co=ke.memo(function({open:t,onOpenChange:a,training:n,activityData:i}){const{t:r,i18n:c}=re(),x=c.language==="ar",{id:p}=Vs(),[o,j]=d.useState(null),[y,g]=d.useState(!1),[f,_]=d.useState(!1),q=nl(),b=d.useMemo(()=>r("training.edit_title","تعديل التمرين"),[r]),h=d.useMemo(()=>{if(!n)return"";const C=x?n.trainings_nameAr:n.trainings_nameEn;return r("training.edit_description",`تعديل تفاصيل التمرين: ${C}`)},[r,n,x]),m=d.useMemo(()=>n?.trainings_img?`${gt}/${n.trainings_img}`:null,[n?.trainings_img]),u=Ve({resolver:Be(oo),defaultValues:{trainings_nameEn:"",trainings_nameAr:"",trainings_img:null}});d.useEffect(()=>{n&&t&&(u.reset({trainings_nameEn:n.trainings_nameEn||"",trainings_nameAr:n.trainings_nameAr||"",trainings_img:null}),j(null),_(!1))},[n,t,u]);const v=d.useCallback((C,M)=>{const $=C.target.files?.[0];if($){M.onChange([$]),_(!0);const H=new FileReader;H.onloadend=()=>{j(H.result)},H.readAsDataURL($)}},[]),A=d.useCallback(C=>{C.onChange(null),j(null),_(!0);const M=document.getElementById("edit-training-image");M&&(M.value="")},[]),I=d.useCallback(async C=>{if(n)try{g(!0);const M=new FormData;M.append("trainings_id",n.trainings_id),M.append("trainings_nameEn",C.trainings_nameEn),M.append("trainings_nameAr",C.trainings_nameAr),p&&M.append("training_activities_id",p),f&&C.trainings_img&&C.trainings_img[0]&&M.append("trainings_img",C.trainings_img[0]);try{await q.mutateAsync(M)}catch{const H={trainings_id:n.trainings_id,trainings_nameEn:C.trainings_nameEn,trainings_nameAr:C.trainings_nameAr};p&&(H.training_activities_id=p),await q.mutateAsync(H)}G.success(x?"تم تحديث التمرين بنجاح!":"Training updated successfully!",{description:x?"تم حفظ التغييرات بنجاح.":"Changes have been saved successfully.",duration:3e3}),u.reset(),j(null),_(!1),a(!1)}catch(M){let $=x?"فشل في تحديث التمرين":"Failed to update training",H=x?"يرجى التحقق من بياناتك والمحاولة مرة أخرى.":"Please check your data and try again.";M.response?M.response.status===500?H=x?"خطأ في الخادم. يرجى المحاولة مرة أخرى لاحقاً.":"Server error. Please try again later.":M.response.status===400&&(H=x?"بيانات غير صحيحة. يرجى التحقق من المعلومات المدخلة.":"Invalid data. Please check your input."):M.request&&(H=x?"مشكلة في الاتصال. يرجى التحقق من الإنترنت.":"Network error. Please check your connection."),G.error($,{description:H,duration:5e3})}finally{g(!1)}},[n,f,q,x,u,a,p]),S=d.useCallback(()=>{y||(u.reset(),j(null),_(!1),a(!1))},[y,u,a]);return n?e.jsx(me,{open:t,onOpenChange:S,children:e.jsxs(ue,{className:"max-w-md w-full rounded-xl p-6 pt-12",children:[e.jsxs(ye,{children:[e.jsxs(xe,{className:"flex items-center gap-2 text-xl",children:[e.jsx(We,{className:"h-6 w-6 text-primary"}),b]}),e.jsx(Ie,{className:"text-sm text-gray-600",children:h}),i&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-primary/5 rounded-lg border border-primary/10 mt-2",children:[e.jsx(Ye,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-primary",children:x?i.activities_titleAr:i.activities_titleEn})]})]}),e.jsx(Xe,{...u,children:e.jsxs("form",{onSubmit:u.handleSubmit(I),className:"space-y-4",children:[e.jsx(P,{control:u.control,name:"trainings_nameEn",render:({field:C})=>e.jsxs(O,{children:[e.jsx(V,{children:r("training.name_en","Training Name (English)")}),e.jsx(U,{children:e.jsx(F,{...C,placeholder:r("training.name_en_placeholder","Enter training name in English"),disabled:y})}),e.jsx(R,{})]})}),e.jsx(P,{control:u.control,name:"trainings_nameAr",render:({field:C})=>e.jsxs(O,{children:[e.jsx(V,{children:r("training.name_ar","اسم التمرين (عربي)")}),e.jsx(U,{children:e.jsx(F,{...C,placeholder:r("training.name_ar_placeholder","أدخل اسم التمرين بالعربية"),disabled:y})}),e.jsx(R,{})]})}),e.jsx(P,{control:u.control,name:"trainings_img",render:({field:C})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r("training.image","Training Image"),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",r("common.optional","اختياري"),")"]})]}),e.jsx(U,{children:e.jsxs("div",{className:"space-y-2",children:[(o||m)&&e.jsxs("div",{className:"relative w-full",children:[e.jsx("img",{src:o||m,alt:"صورة التمرين",className:"w-full h-32 object-cover rounded-lg border"}),o&&e.jsx("button",{type:"button",onClick:()=>A(C),className:"absolute top-2 right-2 bg-destructive text-white rounded-full p-1",children:e.jsx(ve,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary transition-colors",children:[e.jsx("input",{id:"edit-training-image",type:"file",accept:"image/jpeg,image/jpg,image/png",onChange:M=>v(M,C),disabled:y,className:"hidden"}),e.jsxs("label",{htmlFor:"edit-training-image",className:"cursor-pointer flex flex-col items-center gap-2",children:[e.jsx(ms,{className:"h-8 w-8 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:o||m?r("training.change_image","انقر لتغيير الصورة"):r("training.upload_image","انقر لرفع صورة التمرين")}),e.jsx("span",{className:"text-xs text-gray-400",children:"JPG, PNG (Max 5MB)"})]})]})]})}),e.jsx(R,{})]})}),e.jsxs(be,{className:"gap-2 pt-4",children:[e.jsx(k,{type:"button",variant:"outline",onClick:S,disabled:y,children:r("common.cancel","إلغاء")}),e.jsx(k,{type:"submit",disabled:y,className:"min-w-[100px]",children:y?e.jsxs(e.Fragment,{children:[e.jsx(vs,{className:"h-4 w-4 animate-spin mr-2"}),r("common.updating","جاري التحديث...")]}):e.jsxs(e.Fragment,{children:[e.jsx(_s,{className:"h-4 w-4 mr-2"}),r("common.update","تحديث")]})})]})]})})]})}):null});function mo({training:s,isArabic:t,t:a,onDelete:n,onEdit:i}){const[r,c]=d.useState(!1),x=async()=>{await n(s.trainings_id),c(!1)};console.log("training from training card :",s.trainings_id);const p=$t();return e.jsxs("div",{className:"group bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 overflow-hidden border border-gray-100/50 backdrop-blur-sm",children:[e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("img",{className:"w-full h-44 object-cover group-hover:scale-105 transition-transform duration-500 ease-out",src:`${gt}/${s.trainings_img}`,alt:t?s.trainings_nameAr:s.trainings_nameEn}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/30 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx("div",{className:"absolute top-2 right-3 text-xs  ",children:e.jsx("button",{onClick:()=>p(`/dashboard/exercises/${s.trainings_id}`),className:"text-xs  bg-white/80 px-3 py-2 bg-blend-saturation rounded-full cursor-pointer hover:bg-white/90 transition-colors",children:a("training.exercise")})})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-900 group-hover:text-primary transition-colors duration-200 leading-tight",children:t?s.trainings_nameAr:s.trainings_nameEn}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-accent-foreground rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs text-accent-foreground/50 font-medium",children:a("training.available","متاح")})]}),e.jsxs("div",{className:"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("button",{onClick:()=>i(s),className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center hover:bg-primary/20 transition-colors",title:t?"تعديل التمرين":"Edit Training",children:e.jsx(We,{className:"text-primary cursor-pointer hover:text-primary/80",size:16})}),e.jsx("button",{onClick:()=>c(!0),className:"w-8 h-8 bg-destructive/10 rounded-full flex items-center justify-center hover:bg-destructive/20 transition-colors",title:t?"حذف التمرين":"Delete Training",children:e.jsx(we,{className:"text-destructive cursor-pointer hover:text-destructive/80",size:16})})]})]})]}),e.jsx("div",{className:"h-1 bg-gradient-to-r from-primary/20 via-primary to-primary/20 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-center"}),e.jsx(me,{open:r,onOpenChange:c,children:e.jsxs(ue,{className:"max-w-md w-full rounded-xl p-6 border-none pt-12",children:[e.jsx(xe,{className:"text-destructive",children:a("trainee.delete_title","حذف التمرين")}),e.jsx(Ie,{className:"mb-4",children:a("trainee.delete_desc","هل أنت متأكد أنك تريد حذف هذا التمرين؟ لا يمكن التراجع عن هذا الإجراء.")}),e.jsxs(be,{children:[e.jsx(ka,{asChild:!0,children:e.jsx(k,{variant:"outline",children:a("trainee.delete_cancel","إلغاء")})}),e.jsx("button",{className:"px-4 py-2 rounded-full bg-destructive text-white hover:bg-destructive/90",onClick:x,children:a("trainee.delete_confirm","حذف")})]})]})})]})}function uo(){const{id:s}=Vs(),t=Gs(),{t:a,i18n:n}=re(),i=n.language==="ar",r=d.useMemo(()=>t.state?.activityName?i?t.state.activityName.ar:t.state.activityName.en:i?"النشاط":"Activity",[t.state?.activityName,i]),{data:c,isLoading:x,error:p}=Ta(s),o=al(),[j,y]=d.useState([]),[g,f]=d.useState(!1),[_,q]=d.useState(!1),[b,h]=d.useState(null);d.useEffect(()=>{c?.data&&y(c.data)},[c]);const m=async A=>{try{y(I=>I.filter(S=>S.trainings_id!==A)),await o.mutateAsync(A),G.success(i?"تم حذف التمرين بنجاح!":"Training deleted successfully!")}catch{G.error(i?"فشل في حذف التمرين":"Failed to delete training"),c?.data&&y(c.data)}},u=A=>{h(A),q(!0)},v=()=>{q(!1),h(null)};return x?e.jsx($e,{}):p?e.jsx("div",{className:"text-destructive text-xs",children:a("error_loading_trainings","Error loading trainings.")}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(l,{variant:"h2",children:i?`تمارين ${r}`:`${r} Trainings`}),e.jsx(l,{variant:"para",children:a("trainings_management.subtitle")})]}),e.jsxs(k,{onClick:()=>f(!0),children:[i?"إضافة تمرين":"Add Training",e.jsx(Pe,{})]})]}),j.length===0?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("span",{className:"text-secondary flex flex-col items-center gap-2.5 font-medium",children:[a("trainings_management.no_data","No trainings found"),e.jsx(mr,{size:44})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 mt-8",children:j.map(A=>e.jsx(mo,{training:A,isArabic:i,t:a,onDelete:m,onEdit:u},A.trainings_id))}),e.jsx(lo,{open:g,onOpenChange:f}),e.jsx(co,{open:_,onOpenChange:v,training:b})]})}async function xo(s){try{return(await K.post(`${z}/api84818dataexercise/getDataExercise`,{exercise_idTraining:s})).data}catch(t){throw console.error("Error fetching exercise by training ID:",t),console.error("Error details:",t.response?.data),t}}async function po(s){try{console.log("Sending exercise data to API:",s);const t=await K.post(`${z}/api84818dataexercise/insertDataExercise`,s);return console.log("API response:",t.data),t.data}catch(t){throw console.error("Error inserting exercise:",t),console.error("Error details:",t.response?.data),t}}async function ho(s){try{console.log("Sending exercise update data to API:",s);const t=await K.post(`${z}/api84818dataexercise/updateDataExercise`,s);return console.log("API update response:",t.data),t.data}catch(t){throw console.error("Error updating exercise:",t),console.error("Error details:",t.response?.data),t}}async function go(s){try{return(await K.post(`${z}/api84818dataexercise/deleteDataExercise`,{exercise_id:s})).data}catch(t){throw console.error("Error deleting exercise:",t),t}}const fo=s=>ie({queryKey:["exercises","training",s],queryFn:()=>xo(s),enabled:!!s,staleTime:5*60*1e3,cacheTime:10*60*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1,retry:3,retryDelay:t=>Math.min(1e3*2**t,3e4)}),jo=()=>{const s=pe();return de({mutationFn:ho,onSuccess:t=>{s.invalidateQueries({queryKey:["exercises","training",t.exercise_idTraining]})},onError:t=>{console.error("Error updating exercise:",t)}})},yo=()=>{const s=pe();return de({mutationFn:go,onSuccess:(t,a)=>{s.invalidateQueries({queryKey:["exercises"]})},onError:t=>{console.error("Error deleting exercise:",t)}})};async function Js(){try{return(await K.post(`${z}/api84818dataequipment/getAllEquipments`)).data}catch(s){throw console.error("Error fetching all equipments:",s),s}}async function vo(s){try{return(await K.post(`${z}/api84818dataequipment/insertEquipmentData`,s)).data}catch(t){throw console.error("Error inserting equipment:",t),t}}async function _o(s){try{console.log("Sending delete request for equipment ID:",s);const t=await K.post(`${z}/api84818dataequipment/deleteEquipment`,{equipments_id:s});return console.log("Delete response:",t.data),t.data}catch(t){throw console.error("Error deleting equipment:",t),t}}async function bo(s){try{return(await K.post(`${z}/api84818dataequipment/updateEquipmentData`,s)).data}catch(t){throw console.error("Error updating equipment:",t),t}}const _e=d.forwardRef(({className:s,...t},a)=>e.jsx("textarea",{className:se("flex min-h-[80px] w-full  rounded-md border border-secondary bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none   disabled:cursor-not-allowed disabled:opacity-50",s),ref:a,...t}));_e.displayName="Textarea";const No=Ge({exercise_idTraining:B().min(1,"Training selection is required"),exercise_nameEn:B().min(1,"English name is required"),exercise_nameAr:B().min(1,"Arabic name is required"),exercise_duration:B().min(1,"Duration is required"),exercise_Kcal:B().min(1,"Calories is required"),exercise_equipment:ga(B()).min(1,"At least one equipment is required"),exercise_musclesTargeted:B().min(1,"Target muscles is required"),exercise_stepHowDoingEn:B().min(1,"English steps is required"),exercise_stepHowDoingAr:B().min(1,"Arabic steps is required"),exercise_commonMistakesEn:B().min(1,"English common mistakes is required"),exercise_commonMistakesAr:B().min(1,"Arabic common mistakes is required"),exercise_tipsEn:B().min(1,"English tips is required"),exercise_tipsAr:B().min(1,"Arabic tips is required"),exercise_img:Je().refine(s=>s?.length>0,"Exercise image is required"),exercise_video:Je().refine(s=>s?.length>0,"Exercise video is required")}),wo=({open:s,setOpen:t,trainingId:a})=>{const{t:n,i18n:i}=re(),r=i.language==="ar",c=pe(),[x,p]=d.useState(null),[o,j]=d.useState(null),y=d.useRef(null),g=d.useRef(null),[f,_]=d.useState([]),[q,b]=d.useState([""]),[h,m]=d.useState([""]),[u,v]=d.useState([""]),A=Ve({resolver:Be(No),defaultValues:{exercise_idTraining:a||"",exercise_nameEn:"",exercise_nameAr:"",exercise_duration:"",exercise_Kcal:"",exercise_equipment:[],exercise_musclesTargeted:"",exercise_stepHowDoingEn:"",exercise_stepHowDoingAr:"",exercise_commonMistakesEn:"",exercise_commonMistakesAr:"",exercise_tipsEn:"",exercise_tipsAr:"",exercise_img:null,exercise_video:null}});d.useEffect(()=>{(async()=>{try{const T=await Js();_(T.data||[])}catch(T){console.error("Error loading equipment data:",T),G.error(r?"خطأ في تحميل بيانات الأدوات":"Error loading equipment data")}})()},[r]),d.useEffect(()=>{const E=u.filter(T=>T.trim());A.setValue("exercise_musclesTargeted",E.join(","))},[u,A]);const I=()=>{A.reset(),p(null),j(null),b([""]),m([""]),v([""])},S=E=>{E==="en"?b([...q,""]):m([...h,""])},C=(E,T)=>{if(E==="en"){const Z=q.filter((ce,ge)=>ge!==T);b(Z.length>0?Z:[""])}else{const Z=h.filter((ce,ge)=>ge!==T);m(Z.length>0?Z:[""])}},M=(E,T,Z)=>{if(E==="en"){const ce=[...q];ce[T]=Z,b(ce)}else{const ce=[...h];ce[T]=Z,m(ce)}},$=()=>{v([...u,""])},H=E=>{if(u.length>1){const T=u.filter((Z,ce)=>ce!==E);v(T)}},Y=(E,T)=>{const Z=[...u];Z[E]=T,v(Z)};d.useEffect(()=>{const E=q.filter(Z=>Z.trim()),T=h.filter(Z=>Z.trim());A.setValue("exercise_stepHowDoingEn",E.join(",")),A.setValue("exercise_stepHowDoingAr",T.join(","))},[q,h,A]);const ee=E=>{if(E&&E.length>0){const T=E[0];A.setValue("exercise_img",E);const Z=new FileReader;Z.onload=ce=>{p(ce.target.result)},Z.readAsDataURL(T)}else p(null)},J=E=>{if(E&&E.length>0){const T=E[0];A.setValue("exercise_video",E);const Z=new FileReader;Z.onload=ce=>{j(ce.target.result)},Z.readAsDataURL(T)}else j(null)},ae=de({mutationFn:po,onSuccess:()=>{G.success(r?"تمت إضافة التمرين بنجاح":"Exercise added successfully"),c.invalidateQueries({queryKey:["exercises"]}),t(!1),I()},onError:E=>{G.error(r?"حدث خطأ أثناء إضافة التمرين":"Error adding exercise"),console.error("Error adding exercise:",E)}}),Se=async E=>{try{const T=new FormData;T.append("exercise_idTraining",parseInt(E.exercise_idTraining)),T.append("exercise_nameEn",E.exercise_nameEn),T.append("exercise_nameAr",E.exercise_nameAr),T.append("exercise_duration",parseInt(E.exercise_duration)),T.append("exercise_Kcal",parseInt(E.exercise_Kcal)),T.append("exercise_equipment",JSON.stringify(E.exercise_equipment.map(Z=>parseInt(Z)))),T.append("exercise_musclesTargeted",E.exercise_musclesTargeted),T.append("exercise_stepHowDoingEn",E.exercise_stepHowDoingEn),T.append("exercise_stepHowDoingAr",E.exercise_stepHowDoingAr),T.append("exercise_commonMistakesEn",E.exercise_commonMistakesEn),T.append("exercise_commonMistakesAr",E.exercise_commonMistakesAr),T.append("exercise_tipsEn",E.exercise_tipsEn),T.append("exercise_tipsAr",E.exercise_tipsAr),E.exercise_img&&E.exercise_img.length>0&&T.append("exercise_img",E.exercise_img[0]),E.exercise_video&&E.exercise_video.length>0&&T.append("exercise_video",E.exercise_video[0]),console.log("Submitting form data:",Object.fromEntries(T)),await ae.mutateAsync(T)}catch(T){console.error("Error submitting form:",T)}};return e.jsx(me,{open:s,onOpenChange:t,children:e.jsxs(ue,{className:"max-w-4xl max-h-[90vh]  overflow-y-auto pt-10",children:[e.jsxs(ye,{children:[e.jsx(xe,{className:"text-start",children:e.jsx(l,{variant:"md ",children:r?"إضافة تمرين جديد":"Add New Exercise"})}),e.jsx(Ie,{className:"rtl:text-start",children:e.jsx(l,{variant:"p",children:r?"املأ جميع الحقول المطلوبة":"Fill in all required fields"})})]}),e.jsx(Xe,{...A,children:e.jsxs("form",{onSubmit:A.handleSubmit(Se),className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{control:A.control,name:"exercise_nameEn",render:({field:E})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?"الاسم بالإنجليزية":"English Name"," *"]}),e.jsx(U,{children:e.jsx(F,{placeholder:"Enter English name",...E})}),e.jsx(R,{})]})}),e.jsx(P,{control:A.control,name:"exercise_nameAr",render:({field:E})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?"الاسم بالعربية":"Arabic Name"," *"]}),e.jsx(U,{children:e.jsx(F,{placeholder:"أدخل الاسم بالعربية",...E})}),e.jsx(R,{})]})}),e.jsx(P,{control:A.control,name:"exercise_idTraining",render:({field:E})=>e.jsx(O,{className:"hidden",children:e.jsx(U,{children:e.jsx(F,{type:"hidden",...E,value:a||""})})})}),e.jsx(P,{control:A.control,name:"exercise_duration",render:({field:E})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?"المدة (بالدقائق)":"Duration (minutes)"," *"]}),e.jsx(U,{children:e.jsx(F,{type:"number",placeholder:"30",...E})}),e.jsx(R,{})]})}),e.jsx(P,{control:A.control,name:"exercise_Kcal",render:({field:E})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?"السعرات الحرارية":"Calories"," *"]}),e.jsx(U,{children:e.jsx(F,{type:"number",placeholder:"100",...E})}),e.jsx(R,{})]})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{variant:"md",children:r?"المعدات المطلوبة":"Required Equipment"}),e.jsx(P,{control:A.control,name:"exercise_equipment",render:({field:E})=>e.jsxs(O,{children:[E.value&&E.value.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 p-3 bg-gray-50 rounded-lg items-center",children:[e.jsx(l,{variant:"para",children:r?"المعدات المختارة:":"Selected Equipment:"}),E.value.map(T=>{const Z=f.find(ce=>ce.equipments_id.toString()===T);return Z?e.jsxs("div",{className:"flex items-center gap-1 bg-white text-secondary border-1 border-secondary px-3 py-1 rounded-full text-xs font-medium",children:[r?Z.equipments_nameAr:Z.equipments_nameEn,e.jsx(k,{type:"button",variant:"ghost",size:"sm",className:"h-4 w-4 p-0 ml-1 shadow  hover:bg-secondary/10 text-muted-foreground",onClick:()=>{const ce=E.value.filter(ge=>ge!==T);E.onChange(ce)},children:e.jsx(ve,{className:"h-1 w-1 hover:!text-destructive"})})]},T):null})]}),e.jsx(U,{children:e.jsxs(ze,{value:"",onValueChange:T=>{const Z=E.value||[];T&&!Z.includes(T)&&E.onChange([...Z,T])},children:[e.jsx(Oe,{className:"",children:e.jsx(Ue,{placeholder:E.value&&E.value.length>0?r?"...إضافة معدات أخرى":"Add more equipment...":r?"اختر المعدات...":"Select equipment..."})}),e.jsxs(Le,{children:[f.filter(T=>!E.value?.includes(T.equipments_id.toString())).map(T=>e.jsx(Ce,{value:T.equipments_id.toString(),className:"cursor-pointer flex items-center  justify-end hover:bg-gray-100",children:e.jsxs("div",{className:"flex items-center  gap-2",children:[r?T.equipments_nameAr:T.equipments_nameEn,e.jsx("div",{className:"w-1.5 h-1.5 bg-secondary shadow-xl rounded-full"})]})},T.equipments_id)),f.filter(T=>!E.value?.includes(T.equipments_id.toString())).length===0&&e.jsx("div",{className:"px-2 py-1 text-sm text-gray-500",children:r?"تم اختيار جميع المعدات":"All equipment selected"})]})]})}),e.jsx(R,{})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{variant:"md",children:r?"العضلات المستهدفة":"Target Muscles"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(l,{variant:"para",className:"font-medium",children:[r?"العضلات المستهدفة":"Target Muscles"," *"]}),u.map((E,T)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{placeholder:r?`العضلة ${T+1} (مثال: صدر)`:`Muscle ${T+1} (e.g: chest)`,value:E,onChange:Z=>Y(T,Z.target.value),className:"flex-1"}),u.length>1&&e.jsx(k,{type:"button",variant:"outline",size:"sm",onClick:()=>H(T),className:"px-3 hover:bg-destructive hover:text-destructive-foreground",children:e.jsx(ve,{className:"w-4 h-4"})})]},T)),e.jsxs(k,{type:"button",variant:"outline",size:"sm",onClick:$,className:"w-full",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),r?"إضافة عضلة":"Add Muscle"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{variant:"md",children:r?"خطوات التمرين":"Exercise Steps"}),e.jsxs("div",{className:"grid grid-cols-1  gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-medium text-gray-700",children:[r?"الخطوات بالإنجليزية":"English Steps"," *"]}),e.jsxs(k,{type:"button",variant:"outline",size:"sm",onClick:()=>S("en"),className:"text-xs",children:[e.jsx(Pe,{className:"h-3 w-3 mr-1"}),r?"إضافة خطوة":"Add Step"]})]}),e.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:q.map((E,T)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center text-primary text-xs font-medium",children:T+1}),e.jsx(F,{placeholder:`Step ${T+1}`,value:E,onChange:Z=>M("en",T,Z.target.value),className:"flex-1"}),q.length>1&&e.jsx(k,{type:"button",variant:"outline",size:"sm",className:"h-8 w-8 p-0 hover:bg-red-50 hover:text-destructive",onClick:()=>C("en",T),children:e.jsx(ve,{className:"h-3 w-3"})})]},T))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-medium text-gray-700",children:[r?"الخطوات بالعربية":"Arabic Steps"," *"]}),e.jsxs(k,{type:"button",variant:"outline",size:"sm",onClick:()=>S("ar"),className:"text-xs",children:[e.jsx(Pe,{className:"h-3 w-3 mr-1"}),r?"إضافة خطوة":"Add Step"]})]}),e.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:h.map((E,T)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center text-primary text-xs font-medium",children:T+1}),e.jsx(F,{placeholder:`الخطوة ${T+1}`,value:E,onChange:Z=>M("ar",T,Z.target.value),className:"flex-1"}),h.length>1&&e.jsx(k,{type:"button",variant:"outline",size:"sm",className:"h-8 w-8 p-0 hover:bg-red-50 hover:text-destructive",onClick:()=>C("ar",T),children:e.jsx(ve,{className:"h-3 w-3"})})]},T))})]})]}),e.jsx(P,{control:A.control,name:"exercise_stepHowDoingEn",render:({field:E})=>e.jsxs(O,{className:"hidden",children:[e.jsx(U,{children:e.jsx(F,{type:"hidden",...E})}),e.jsx(R,{})]})}),e.jsx(P,{control:A.control,name:"exercise_stepHowDoingAr",render:({field:E})=>e.jsxs(O,{className:"hidden",children:[e.jsx(U,{children:e.jsx(F,{type:"hidden",...E})}),e.jsx(R,{})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{variant:"md",children:r?"الأخطاء الشائعة والنصائح":"Common Mistakes & Tips"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{control:A.control,name:"exercise_commonMistakesEn",render:({field:E})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?"الأخطاء الشائعة (إنجليزي)":"Common Mistakes (English)"," ","*"]}),e.jsx(U,{children:e.jsx(_e,{placeholder:"Describe common mistakes...",className:"min-h-[120px] resize-none",...E})}),e.jsx(R,{})]})}),e.jsx(P,{control:A.control,name:"exercise_commonMistakesAr",render:({field:E})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?"الأخطاء الشائعة (عربي)":"Common Mistakes (Arabic)"," ","*"]}),e.jsx(U,{children:e.jsx(_e,{placeholder:"اكتب الأخطاء الشائعة...",className:"min-h-[120px] resize-none",...E})}),e.jsx(R,{})]})}),e.jsx(P,{control:A.control,name:"exercise_tipsEn",render:({field:E})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?"النصائح (إنجليزي)":"Tips (English)"," *"]}),e.jsx(U,{children:e.jsx(_e,{placeholder:"Provide helpful tips...",className:"min-h-[120px] resize-none",...E})}),e.jsx(R,{})]})}),e.jsx(P,{control:A.control,name:"exercise_tipsAr",render:({field:E})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?"النصائح (عربي)":"Tips (Arabic)"," *"]}),e.jsx(U,{children:e.jsx(_e,{placeholder:"اكتب النصائح المفيدة...",className:"min-h-[120px] resize-none",...E})}),e.jsx(R,{})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{variant:"md",children:r?"ملفات الوسائط":"Media Files"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{control:A.control,name:"exercise_img",render:({field:E})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?"صورة التمرين":"Exercise Image"," *"]}),e.jsxs("div",{className:"space-y-2",children:[x?e.jsxs("div",{className:"relative border rounded-lg overflow-hidden",children:[e.jsx("img",{src:x,alt:"Exercise preview",className:"w-full h-48 object-cover"}),e.jsx(k,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:()=>{p(null),E.onChange(null),y.current&&(y.current.value="")},children:e.jsx(ve,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-secondary rounded-lg p-8 text-center cursor-pointer hover:bg-gray-50",onClick:()=>y.current?.click(),children:[e.jsx(ct,{className:"h-12 w-12 mx-auto text-gray-400 mb-2"}),e.jsx(l,{variant:"p",children:r?"انقر لتحميل صورة":"Click to upload image"})]}),e.jsx(F,{ref:y,type:"file",accept:"image/*",className:"hidden",onChange:T=>ee(T.target.files)})]}),e.jsx(R,{})]})}),e.jsx(P,{control:A.control,name:"exercise_video",render:({field:E})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?"فيديو التمرين":"Exercise Video"," *"]}),e.jsxs("div",{className:"space-y-2",children:[o?e.jsxs("div",{className:"relative border rounded-lg overflow-hidden",children:[e.jsx("video",{src:o,controls:!0,className:"w-full h-48 object-cover"}),e.jsx(k,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:()=>{j(null),E.onChange(null),g.current&&(g.current.value="")},children:e.jsx(ve,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"border-2 border-secondary  border-dashed rounded-lg p-8 text-center cursor-pointer hover:bg-gray-50",onClick:()=>g.current?.click(),children:[e.jsx(dt,{className:"h-12 w-12 mx-auto text-gray-400 mb-2"}),e.jsx(l,{variant:"p",children:r?"انقر لتحميل فيديو":"Click to upload video"})]}),e.jsx(F,{ref:g,type:"file",accept:"video/*",className:"hidden",onChange:T=>J(T.target.files)})]}),e.jsx(R,{})]})})]})]}),e.jsxs(be,{className:"mt-6",children:[e.jsx(k,{variant:"outline",onClick:()=>t(!1),children:r?"إلغاء":"Cancel"}),e.jsx(k,{type:"submit",disabled:ae.isPending,children:ae.isPending?r?"جاري الإضافة...":"Adding...":r?"إضافة التمرين":"Add Exercise"})]})]})})]})})},Eo=Ge({exercise_nameEn:B().min(1,"English name is required"),exercise_nameAr:B().min(1,"Arabic name is required"),exercise_duration:B().min(1,"Duration is required"),exercise_Kcal:B().min(1,"Calories is required"),exercise_equipment:ga(B()).optional().default([]),exercise_musclesTargeted:B().optional().default(""),exercise_stepHowDoingEn:B().optional().default(""),exercise_stepHowDoingAr:B().optional().default(""),exercise_commonMistakesEn:B().optional().default(""),exercise_commonMistakesAr:B().optional().default(""),exercise_tipsEn:B().optional().default(""),exercise_tipsAr:B().optional().default(""),exercise_img:Je().optional(),exercise_video:Je().optional()}),Ao=({open:s,setOpen:t,exercise:a})=>{const{t:n,i18n:i}=re(),r=i.language==="ar",[c,x]=d.useState(null),[p,o]=d.useState(null),[j,y]=d.useState(!1),[g,f]=d.useState(!1),_=d.useRef(null),q=d.useRef(null),[b,h]=d.useState([]),[m,u]=d.useState([""]),[v,A]=d.useState([""]),[I,S]=d.useState([""]),C=Ve({resolver:Be(Eo),defaultValues:{exercise_nameEn:"",exercise_nameAr:"",exercise_duration:"",exercise_Kcal:"",exercise_equipment:[],exercise_musclesTargeted:"",exercise_stepHowDoingEn:"",exercise_stepHowDoingAr:"",exercise_commonMistakesEn:"",exercise_commonMistakesAr:"",exercise_tipsEn:"",exercise_tipsAr:"",exercise_img:null,exercise_video:null}});d.useEffect(()=>{(async()=>{try{const N=await Js();h(N.data||[])}catch(N){console.error("Error loading equipment data:",N),G.error(r?"خطأ في تحميل بيانات الأدوات":"Error loading equipment data")}})()},[r]);const M=d.useMemo(()=>a?.exercise_img?`${va}/${a.exercise_img}`:null,[a?.exercise_img]),$=d.useMemo(()=>a?.exercise_video?`${_a}/${a.exercise_video}`:null,[a?.exercise_video]);d.useEffect(()=>{if(a&&s){const w=a.exercise_stepHowDoingEn?a.exercise_stepHowDoingEn.includes(",")?a.exercise_stepHowDoingEn.split(",").filter(W=>W.trim()):a.exercise_stepHowDoingEn.split(`
`).filter(W=>W.trim()):[""],N=a.exercise_stepHowDoingAr?a.exercise_stepHowDoingAr.includes(",")?a.exercise_stepHowDoingAr.split(",").filter(W=>W.trim()):a.exercise_stepHowDoingAr.split(`
`).filter(W=>W.trim()):[""];u(w.length>0?w:[""]),A(N.length>0?N:[""]);const Q=a.exercise_musclesTargeted?a.exercise_musclesTargeted.split(",").map(W=>W.trim()).filter(W=>W):[""];S(Q.length>0?Q:[""]);let L=[];if(a.exercise_equipment)try{L=JSON.parse(a.exercise_equipment),L=L.map(W=>W.toString())}catch{L=a.exercise_equipment.split(",").map(Re=>Re.trim()).filter(Re=>Re)}C.reset({exercise_nameEn:a.exercise_nameEn||"",exercise_nameAr:a.exercise_nameAr||"",exercise_duration:a.exercise_duration?.toString()||"",exercise_Kcal:a.exercise_Kcal?.toString()||"",exercise_equipment:L,exercise_musclesTargeted:a.exercise_musclesTargeted||"",exercise_stepHowDoingEn:a.exercise_stepHowDoingEn||"",exercise_stepHowDoingAr:a.exercise_stepHowDoingAr||"",exercise_commonMistakesEn:a.exercise_commonMistakesEn||"",exercise_commonMistakesAr:a.exercise_commonMistakesAr||"",exercise_tipsEn:a.exercise_tipsEn||"",exercise_tipsAr:a.exercise_tipsAr||"",exercise_img:null,exercise_video:null}),x(null),o(null),y(!1),f(!1)}},[a,s,C]),d.useEffect(()=>{const w=m.filter(N=>N.trim());C.setValue("exercise_stepHowDoingEn",w.join(","))},[m,C]),d.useEffect(()=>{const w=v.filter(N=>N.trim());C.setValue("exercise_stepHowDoingAr",w.join(","))},[v,C]),d.useEffect(()=>{const w=I.filter(N=>N.trim());C.setValue("exercise_musclesTargeted",w.join(","))},[I,C]);const H=w=>{w==="en"?u([...m,""]):A([...v,""])},Y=(w,N)=>{if(w==="en"&&m.length>1){const Q=m.filter((L,W)=>W!==N);u(Q)}else if(w==="ar"&&v.length>1){const Q=v.filter((L,W)=>W!==N);A(Q)}},ee=(w,N,Q)=>{if(w==="en"){const L=[...m];L[N]=Q,u(L)}else{const L=[...v];L[N]=Q,A(L)}},J=()=>{S([...I,""])},ae=w=>{if(I.length>1){const N=I.filter((Q,L)=>L!==w);S(N)}},Se=(w,N)=>{const Q=[...I];Q[w]=N,S(Q)},E=w=>{const N=w.target.files[0];if(N){C.setValue("exercise_img",[N]),y(!0);const Q=new FileReader;Q.onload=L=>{x(L.target.result)},Q.readAsDataURL(N)}},T=w=>{const N=w.target.files[0];if(N){C.setValue("exercise_video",[N]),f(!0);const Q=new FileReader;Q.onload=L=>{o(L.target.result)},Q.readAsDataURL(N)}},Z=()=>{C.setValue("exercise_img",null),x(null),y(!1),_.current&&(_.current.value="")},ce=()=>{C.setValue("exercise_video",null),o(null),f(!1),q.current&&(q.current.value="")},ge=jo(),D=async w=>{try{const N=new FormData;N.append("exercise_id",a.exercise_id),N.append("exercise_idTraining",a.exercise_idTraining),N.append("exercise_nameEn",w.exercise_nameEn),N.append("exercise_nameAr",w.exercise_nameAr),N.append("exercise_duration",parseInt(w.exercise_duration)),N.append("exercise_Kcal",parseInt(w.exercise_Kcal));const Q=Array.isArray(w.exercise_equipment)?w.exercise_equipment:[];N.append("exercise_equipment",JSON.stringify(Q.map(L=>parseInt(L)))),N.append("exercise_musclesTargeted",w.exercise_musclesTargeted||""),N.append("exercise_stepHowDoingEn",w.exercise_stepHowDoingEn||""),N.append("exercise_stepHowDoingAr",w.exercise_stepHowDoingAr||""),N.append("exercise_commonMistakesEn",w.exercise_commonMistakesEn||""),N.append("exercise_commonMistakesAr",w.exercise_commonMistakesAr||""),N.append("exercise_tipsEn",w.exercise_tipsEn||""),N.append("exercise_tipsAr",w.exercise_tipsAr||""),j&&w.exercise_img&&w.exercise_img.length>0&&N.append("exercise_img",w.exercise_img[0]),g&&w.exercise_video&&w.exercise_video.length>0&&N.append("exercise_video",w.exercise_video[0]),await ge.mutateAsync(N),G.success(r?"تم تحديث التمرين بنجاح":"Exercise updated successfully"),X()}catch(N){console.error("Error updating exercise:",N),G.error(r?"فشل في تحديث التمرين":"Failed to update exercise")}},X=()=>{ge.isPending||(t(!1),setTimeout(()=>{C.reset(),x(null),o(null),u([""]),A([""]),S([""]),y(!1),f(!1)},300))};return e.jsx(me,{open:s,onOpenChange:X,children:e.jsxs(ue,{className:"max-w-5xl max-h-[90vh] overflow-y-auto pt-10",children:[e.jsxs(ye,{className:"pb-4 ",children:[e.jsxs(xe,{className:"flex items-center gap-3 text-start",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(We,{className:"w-5 h-5 text-primary"})}),e.jsx(l,{variant:"md",children:r?"تعديل التمرين":"Edit Exercise"})]}),e.jsx(Ie,{className:"rtl:text-start",children:r?"تعديل معلومات التمرين وتحديث بياناته":"Edit exercise information and update its data"}),a&&e.jsx("div",{className:"mt-2 p-2 bg-blue-50 rounded-md text-start",children:e.jsx(l,{variant:"para",children:r?`تعديل: ${a.exercise_nameAr||a.exercise_nameEn}`:`Editing: ${a.exercise_nameEn||a.exercise_nameAr}`})})]}),e.jsx(Xe,{...C,children:e.jsxs("form",{onSubmit:C.handleSubmit(D),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs(l,{variant:"md",className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5"}),r?"معلومات التمرين الأساسية":"Basic Exercise Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{control:C.control,name:"exercise_nameEn",render:({field:w})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?"اسم التمرين (إنجليزي)":"Exercise Name (English)"," ","*"]}),e.jsx(U,{children:e.jsx(F,{placeholder:"Enter exercise name...",...w})}),e.jsx(R,{})]})}),e.jsx(P,{control:C.control,name:"exercise_nameAr",render:({field:w})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?"اسم التمرين (عربي)":"Exercise Name (Arabic)"," ","*"]}),e.jsx(U,{children:e.jsx(F,{placeholder:"أدخل اسم التمرين...",...w})}),e.jsx(R,{})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{variant:"md",children:r?"تفاصيل التمرين":"Exercise Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{control:C.control,name:"exercise_duration",render:({field:w})=>e.jsxs(O,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"w-4 h-4"}),r?"المدة (بالدقائق)":"Duration (minutes)"," *"]}),e.jsx(U,{children:e.jsx(F,{type:"number",placeholder:"30",...w})}),e.jsx(R,{})]})}),e.jsx(P,{control:C.control,name:"exercise_Kcal",render:({field:w})=>e.jsxs(O,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(Bs,{className:"w-4 h-4"}),r?"السعرات الحرارية":"Calories (Kcal)"," *"]}),e.jsx(U,{children:e.jsx(F,{type:"number",placeholder:"150",...w})}),e.jsx(R,{})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(l,{variant:"md",className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-5 h-5"}),r?"المعدات المطلوبة":"Required Equipment"]}),e.jsx(P,{control:C.control,name:"exercise_equipment",render:({field:w})=>e.jsxs(O,{children:[w.value&&w.value.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 p-3 bg-gray-50 rounded-lg items-center",children:[e.jsx(l,{variant:"para",children:r?"المعدات المختارة:":"Selected Equipment:"}),w.value.map(N=>{const Q=b.find(L=>L?.equipments_id?.toString()===N?.toString());return Q?e.jsxs("div",{className:"flex items-center gap-1 bg-white text-secondary border-1 border-secondary px-3 py-1 rounded-full text-xs font-medium",children:[r?Q.equipments_nameAr:Q.equipments_nameEn,e.jsx(k,{type:"button",variant:"ghost",size:"sm",className:"h-4 w-4 p-0 ml-1 shadow  hover:bg-secondary/10 text-muted-foreground",onClick:()=>{const L=w.value.filter(W=>W!==N);w.onChange(L)},children:e.jsx(ve,{className:"h-1 w-1 hover:!text-destructive"})})]},N):null})]}),e.jsx(U,{children:e.jsxs(ze,{value:"",onValueChange:N=>{const Q=w.value||[];N&&!Q.includes(N)&&w.onChange([...Q,N])},children:[e.jsx(Oe,{className:"",children:e.jsx(Ue,{placeholder:w.value&&w.value.length>0?r?"...إضافة معدات أخرى":"Add more equipment...":r?"اختر المعدات...":"Select equipment..."})}),e.jsxs(Le,{children:[b.filter(N=>N?.equipments_id&&!w.value?.includes(N.equipments_id.toString())).map(N=>e.jsx(Ce,{value:N.equipments_id.toString(),className:"cursor-pointer flex items-center  justify-end hover:bg-gray-100",children:e.jsxs("div",{className:"flex items-center  gap-2",children:[r?N.equipments_nameAr:N.equipments_nameEn,e.jsx("div",{className:"w-1.5 h-1.5 bg-secondary shadow-xl rounded-full"})]})},N.equipments_id)),b.filter(N=>N?.equipments_id&&!w.value?.includes(N.equipments_id.toString())).length===0&&e.jsx("div",{className:"px-2 py-1 text-sm text-gray-500",children:r?"تم اختيار جميع المعدات":"All equipment selected"})]})]})}),e.jsx(R,{})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(l,{variant:"md",className:"flex items-center gap-2",children:[e.jsx(js,{className:"w-5 h-5"}),r?"العضلات المستهدفة":"Target Muscles"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(l,{variant:"para",className:"font-medium",children:[r?"العضلات المستهدفة":"Target Muscles"," *"]}),I.map((w,N)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{placeholder:r?`العضلة ${N+1} (مثال: صدر)`:`Muscle ${N+1} (e.g: chest)`,value:w,onChange:Q=>Se(N,Q.target.value),className:"flex-1"}),I.length>1&&e.jsx(k,{type:"button",variant:"outline",size:"sm",onClick:()=>ae(N),className:"px-3 hover:bg-destructive hover:text-destructive-foreground",children:e.jsx(ve,{className:"w-4 h-4"})})]},N)),e.jsxs(k,{type:"button",variant:"outline",size:"sm",onClick:J,className:"w-full",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),r?"إضافة عضلة":"Add Muscle"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{variant:"md",children:r?"خطوات التمرين":"Exercise Steps"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(l,{variant:"para",className:"font-medium",children:[r?"الخطوات (إنجليزي)":"Steps (English)"," *"]}),e.jsxs("div",{className:"space-y-2",children:[m.map((w,N)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("span",{className:"text-sm text-muted-foreground min-w-[20px]",children:[N+1,"."]}),e.jsx(F,{placeholder:`Describe step ${N+1}...`,value:w,onChange:Q=>ee("en",N,Q.target.value),className:"flex-1"}),m.length>1&&e.jsx(k,{type:"button",variant:"ghost",size:"sm",onClick:()=>Y("en",N),className:"text-destructive hover:text-destructive",children:e.jsx(ve,{className:"w-4 h-4"})})]},N)),e.jsxs(k,{type:"button",variant:"outline",size:"sm",onClick:()=>H("en"),className:"w-full",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),r?"إضافة خطوة":"Add Step"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(l,{variant:"para",className:"font-medium",children:[r?"الخطوات (عربي)":"Steps (Arabic)"," *"]}),e.jsxs("div",{className:"space-y-2",children:[v.map((w,N)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("span",{className:"text-sm text-muted-foreground min-w-[20px]",children:[N+1,"."]}),e.jsx(F,{placeholder:`اكتب الخطوة ${N+1}...`,value:w,onChange:Q=>ee("ar",N,Q.target.value),className:"flex-1"}),v.length>1&&e.jsx(k,{type:"button",variant:"ghost",size:"sm",onClick:()=>Y("ar",N),className:"text-destructive hover:text-destructive",children:e.jsx(ve,{className:"w-4 h-4"})})]},N)),e.jsxs(k,{type:"button",variant:"outline",size:"sm",onClick:()=>H("ar"),className:"w-full",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),r?"إضافة خطوة":"Add Step"]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{variant:"md",children:r?"الأخطاء الشائعة والنصائح":"Common Mistakes & Tips"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{control:C.control,name:"exercise_commonMistakesEn",render:({field:w})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?"الأخطاء الشائعة (إنجليزي)":"Common Mistakes (English)"," ","*"]}),e.jsx(U,{children:e.jsx(_e,{placeholder:"Describe common mistakes...",className:"min-h-[120px] resize-none",...w})}),e.jsx(R,{})]})}),e.jsx(P,{control:C.control,name:"exercise_commonMistakesAr",render:({field:w})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?"الأخطاء الشائعة (عربي)":"Common Mistakes (Arabic)"," ","*"]}),e.jsx(U,{children:e.jsx(_e,{placeholder:"اكتب الأخطاء الشائعة...",className:"min-h-[120px] resize-none",...w})}),e.jsx(R,{})]})}),e.jsx(P,{control:C.control,name:"exercise_tipsEn",render:({field:w})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?"النصائح (إنجليزي)":"Tips (English)"," *"]}),e.jsx(U,{children:e.jsx(_e,{placeholder:"Provide helpful tips...",className:"min-h-[120px] resize-none",...w})}),e.jsx(R,{})]})}),e.jsx(P,{control:C.control,name:"exercise_tipsAr",render:({field:w})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?"النصائح (عربي)":"Tips (Arabic)"," *"]}),e.jsx(U,{children:e.jsx(_e,{placeholder:"اكتب النصائح المفيدة...",className:"min-h-[120px] resize-none",...w})}),e.jsx(R,{})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{variant:"md",children:r?"ملفات الوسائط":"Media Files"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{control:C.control,name:"exercise_img",render:({field:w})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?"صورة التمرين":"Exercise Image"," *"]}),e.jsxs("div",{className:"space-y-2",children:[c?e.jsxs("div",{className:"relative border rounded-lg overflow-hidden",children:[e.jsx("img",{src:c,alt:"Exercise preview",className:"w-full h-48 object-cover"}),e.jsx(k,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:Z,children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx("div",{className:"absolute bottom-2 left-2 bg-accent-foreground text-white px-2 py-1 rounded text-xs",children:r?"صورة جديدة":"New Image"})]}):M?e.jsxs("div",{className:"relative border rounded-lg overflow-hidden",children:[e.jsx("img",{src:M,alt:"Current exercise",className:"w-full h-48 object-cover"}),e.jsx("div",{className:"absolute bottom-2 left-2 bg-secondary text-white px-2 py-1 rounded text-xs",children:r?"الصورة الحالية":"Current Image"})]}):e.jsxs("div",{className:"border-2 border-dashed border-secondary rounded-lg p-8 text-center cursor-pointer hover:bg-gray-50",onClick:()=>_.current?.click(),children:[e.jsx(ct,{className:"h-12 w-12 mx-auto text-gray-400 mb-2"}),e.jsx(l,{variant:"p",children:r?"انقر لتحميل صورة":"Click to upload image"})]}),e.jsx(F,{ref:_,type:"file",accept:"image/*",className:"hidden",onChange:E}),e.jsxs(k,{type:"button",variant:"outline",onClick:()=>_.current?.click(),className:"w-full",children:[e.jsx(ct,{className:"w-4 h-4 mr-2"}),j||!M?r?"اختر صورة":"Select Image":r?"تغيير الصورة":"Change Image"]})]}),e.jsx(R,{})]})}),e.jsx(P,{control:C.control,name:"exercise_video",render:({field:w})=>e.jsxs(O,{children:[e.jsxs(V,{children:[r?"فيديو التمرين":"Exercise Video"," *"]}),e.jsxs("div",{className:"space-y-2",children:[p?e.jsxs("div",{className:"relative border rounded-lg overflow-hidden",children:[e.jsx("video",{src:p,controls:!0,className:"w-full h-48 object-cover"}),e.jsx(k,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:ce,children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx("div",{className:"absolute bottom-2 left-2 bg-accent-foreground text-white px-2 py-1 rounded text-xs",children:r?"فيديو جديد":"New Video"})]}):$?e.jsxs("div",{className:"relative border rounded-lg overflow-hidden",children:[e.jsx("video",{src:$,controls:!0,className:"w-full h-48 object-cover"}),e.jsx("div",{className:"absolute bottom-2 left-2 bg-secondary text-white px-2 py-1 rounded text-xs",children:r?"الفيديو الحالي":"Current Video"})]}):e.jsxs("div",{className:"border-2 border-secondary  border-dashed rounded-lg p-8 text-center cursor-pointer hover:bg-gray-50",onClick:()=>q.current?.click(),children:[e.jsx(dt,{className:"h-12 w-12 mx-auto text-gray-400 mb-2"}),e.jsx(l,{variant:"p",children:r?"انقر لتحميل فيديو":"Click to upload video"})]}),e.jsx(F,{ref:q,type:"file",accept:"video/*",className:"hidden",onChange:T}),e.jsxs(k,{type:"button",variant:"outline",onClick:()=>q.current?.click(),className:"w-full",children:[e.jsx(dt,{className:"w-4 h-4 mr-2"}),g||!$?r?"اختر فيديو":"Select Video":r?"تغيير الفيديو":"Change Video"]})]}),e.jsx(R,{})]})})]})]}),e.jsxs(be,{className:"flex flex-col sm:flex-row gap-3 pt-6 ",children:[e.jsxs(k,{type:"button",variant:"outline",onClick:X,disabled:ge.isPending,className:"w-full sm:w-auto order-2 sm:order-1",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),r?"إلغاء":"Cancel"]}),e.jsx(k,{type:"submit",disabled:ge.isPending,className:"w-full sm:w-auto order-1 sm:order-2",children:ge.isPending?e.jsxs(e.Fragment,{children:[e.jsx(vs,{className:"w-4 h-4 mr-2 animate-spin"}),r?"جاري التحديث...":"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_s,{className:"w-4 h-4 mr-2"}),r?"حفظ التعديلات":"Save Changes"]})})]})]})})]})})};function Rt(){const{trainingId:s}=Vs(),t=Gs(),{t:a,i18n:n}=re(),i=n.language==="ar",[r,c]=d.useState(!1),[x,p]=d.useState(!1),[o,j]=d.useState(!1),[y,g]=d.useState(null),[f,_]=d.useState(null),[q,b]=d.useState([]),{data:h,isLoading:m,error:u}=fo(s?parseInt(s):null),v=yo(),A=d.useMemo(()=>t.state?.trainingName?i?t.state.trainingName.ar:t.state.trainingName.en:i?"التدريب":"Training",[t.state?.trainingName,i]),I=d.useMemo(()=>h?.data||[],[h?.data]),S=d.useMemo(()=>{const ee=new Set,J={};return I.forEach(ae=>{ae.exercise_musclesTargeted&&ae.exercise_musclesTargeted.split(",").map(E=>E.trim()).forEach(E=>{E&&(ee.add(E),J[E]=(J[E]||0)+1)})}),{totalUniqueMuscles:ee.size,muscleDistribution:J,topMuscles:Object.entries(J).sort(([,ae],[,Se])=>Se-ae).slice(0,5)}},[I]),C=d.useMemo(()=>{if(!I.length)return null;const ee=I.reduce((E,T)=>E+(T.exercise_duration||0),0),J=I.reduce((E,T)=>E+(T.exercise_Kcal||0),0),ae=Math.round(ee/I.length),Se=Math.round(J/I.length);return{totalExercises:I.length,totalDuration:ee,totalCalories:J,avgDuration:ae,avgCalories:Se}},[I]),M=d.useCallback(()=>{c(!0)},[]),$=d.useCallback(ee=>{g(ee),p(!0)},[]),H=d.useCallback(ee=>{_(ee),j(!0)},[]),Y=d.useCallback(async()=>{if(f)try{await v.mutateAsync(f.exercise_id),G.success(i?"تم حذف التمرين بنجاح":"Exercise deleted successfully"),j(!1),_(null)}catch(ee){console.error("Error deleting exercise:",ee),G.error(i?"فشل في حذف التمرين":"Failed to delete exercise")}},[f,v,i]);return d.useCallback(()=>{c(!1),p(!1),j(!1),g(null),_(null)},[]),d.useEffect(()=>{(async()=>{try{const J=await Js();b(J.data||[])}catch(J){console.error("Error loading equipment data:",J)}})()},[]),u?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Ze,{className:"w-16 h-16 text-destructive mb-4"}),e.jsx(l,{variant:"h3",className:"text-destructive mb-2",children:i?"خطأ في تحميل التمارين":"Error Loading Exercises"}),e.jsx(l,{variant:"para",className:"text-muted-foreground",children:i?"حدث خطأ أثناء تحميل التمارين. يرجى المحاولة مرة أخرى.":"An error occurred while loading exercises. Please try again."})]}):e.jsxs("div",{className:"p- space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(l,{variant:"h2",children:A}),e.jsx(l,{variant:"para",children:i?"إدارة التمارين المرتبطة بهذا التدريب":"Manage exercises associated with this training"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("div",{className:"py-2 px-4 flex items-center gap-2 text-sm bg-gradient-to-r from-primary/10 to-primary/5  rounded-full w-fit",children:e.jsxs(l,{variant:"p",children:[I.length," ",i?"تمرين":"Exercises"]})}),e.jsxs(k,{onClick:M,children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),i?"إضافة تمرين":"Add Exercise"]})]})]}),C&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsx(je,{name:i?"إجمالي التمارين":"Total Exercises",number:C.totalExercises,icon:e.jsx(Ye,{className:"w-6 h-6 text-primary"}),Text:i?"نشط":"Active",ColorOfText:"text-primary",bgText:"bg-primary/10",para:i?"تمرين":"exercises"}),e.jsx(je,{name:i?"إجمالي المدة":"Total Duration",number:`${C.totalDuration} ${i?"د":"min"}`,icon:e.jsx(ds,{className:"w-6 h-6 text-primary-foreground"}),Text:i?"الوقت":"Time",ColorOfText:"text-primary-foreground",bgText:"bg-primary-foreground/10",para:i?"إجمالي":"total"}),e.jsx(je,{name:i?"إجمالي السعرات":"Total Calories",number:`${C.totalCalories} ${i?"سعرة":"kcal"}`,icon:e.jsx(Bs,{className:"w-6 h-6 text-custom-yellow-text"}),Text:i?"حرق":"Burn",ColorOfText:"text-custom-yellow-text",bgText:"bg-custom-yellow-text/10",para:i?"سعرات حرارية":"calories"}),e.jsx(je,{name:i?"العضلات المستهدفة":"Target Muscles",number:S.totalUniqueMuscles,icon:e.jsx(js,{className:"w-6 h-6 text-accent-foreground"}),Text:i?"عضلة":"muscles",ColorOfText:"text-green-500",bgText:"bg-green-100"})]}),S.topMuscles.length>0&&e.jsxs(Ae,{className:"mb-8 shadow border-none bg-background",children:[e.jsx(Fe,{className:"pb-4",children:e.jsxs(qe,{className:"flex items-center gap-3 text-lg",children:[e.jsx(js,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-foreground font-semibold",children:i?"توزيع العضلات المستهدفة":"Muscle Distribution"})]})}),e.jsx(Te,{children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3",children:S.topMuscles.map(([ee,J],ae)=>e.jsx("div",{className:"p-3 bg-muted/10 rounded-lg  hover:shadow-sm transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{variant:"small",children:ee}),e.jsx(il,{variant:"secondary",children:J})]})},ee))})})]}),e.jsx("div",{className:"space-y-6",children:m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-muted/40 rounded-lg animate-pulse"}),e.jsx("div",{className:"h-6 w-32 bg-muted/40 rounded animate-pulse"})]}),e.jsx("div",{className:"flex flex-col gap-6",children:[...Array(6)].map((ee,J)=>e.jsx(So,{},J))})]}):I.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-accent-foreground rounded-lg flex items-center justify-center",children:e.jsx(Ye,{className:"w-4 h-4 text-white"})}),e.jsx(l,{variant:"h2",className:"font-bold text-foreground",children:i?"التمارين المتاحة":"Available Exercises"})]}),e.jsx("div",{className:"flex flex-col gap-6",children:I.map(ee=>e.jsx(Co,{exercise:ee,isArabic:i,equipments:q,onEdit:()=>$(ee),onDelete:()=>H(ee)},ee.exercise_id))})]}):e.jsx(Ae,{className:"",children:e.jsx(Te,{className:"p-16 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6",children:[e.jsx("div",{className:"w-24 h-24 bg-muted/30 rounded-full flex items-center justify-center",children:e.jsx(Ye,{className:"w-12 h-12 text-muted-foreground"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{variant:"h2",className:"text-foreground font-bold",children:i?"لا توجد تمارين":"No Exercises Found"}),e.jsx(l,{variant:"para",className:"text-muted-foreground max-w-md",children:i?"لم يتم العثور على أي تمارين لهذا التدريب. ابدأ بإضافة تمرين جديد لبناء برنامج تدريبي متكامل.":"No exercises found for this training. Start by adding a new exercise to build a comprehensive workout program."})]})]})})})}),e.jsx(wo,{open:r,setOpen:c,trainingId:s}),e.jsx(Ao,{open:x,setOpen:p,exercise:y}),e.jsx(Do,{open:o,onOpenChange:j,exercise:f,isArabic:i,onConfirm:Y,isLoading:v.isPending})]})}const Co=ke.memo(function({exercise:t,isArabic:a,equipments:n,onEdit:i,onDelete:r}){const[c,x]=d.useState(!1),[p,o]=d.useState(!1),j=a?t?.exercise_nameAr:t?.exercise_nameEn;d.useMemo(()=>{const h=a?t?.exercise_stepHowDoingAr:t?.exercise_stepHowDoingEn;return h?h.split(",").slice(0,2):[]},[t,a]);const y=d.useMemo(()=>t?.exercise_musclesTargeted?t.exercise_musclesTargeted.split(",").slice(0,3):[],[t?.exercise_musclesTargeted]),g=d.useMemo(()=>{if(!t?.exercise_equipment||!n.length)return[];try{return JSON.parse(t.exercise_equipment).map(m=>n.find(u=>u.equipments_id===parseInt(m))).filter(Boolean).slice(0,4)}catch(h){return console.error("Error parsing equipment data:",h),[]}},[t?.exercise_equipment,n]),f=a?t?.exercise_tipsAr:t?.exercise_tipsEn,_=d.useMemo(()=>{const h=a?t?.exercise_stepHowDoingAr:t?.exercise_stepHowDoingEn;return h?h.split(",").map(m=>m.trim().replace(/"/g,"").replace(/\n/g,"")).filter(m=>m.length>0):[]},[t,a]),q=d.useMemo(()=>{const h=a?t?.exercise_commonMistakesAr:t?.exercise_commonMistakesEn;return h?h.split(",").map(m=>m.trim()).filter(Boolean):[]},[t,a]),b=h=>{if(!h)return null;const m=h.split(/,|،/);return m.map((u,v)=>e.jsxs(ke.Fragment,{children:[u.trim(),v<m.length-1&&e.jsx("br",{})]},v))};return e.jsx(Ae,{className:"group relative overflow-hidden border-none  bg-background shadow-md hover:shadow-xl transition-all duration-300 rounded-xl",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(qe,{className:"text-xl font-bold text-foreground mb-1",children:j}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 mb-4 text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ds,{className:"w-4 h-4"}),e.jsxs(l,{variant:"small",children:[t?.exercise_duration," ",a?"دقيقة":"min"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Bs,{className:"w-4 h-4"}),e.jsxs(l,{variant:"small",children:[t?.exercise_Kcal," ",a?"سعرة":"kcal"]})]})]})]}),y.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-secondary/10 flex items-center justify-center",children:e.jsx(js,{className:"w-3 h-3 text-secondary"})}),e.jsx(l,{variant:"small",children:a?"العضلات المستهدفة":"Target Muscles"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:y.map((h,m)=>e.jsx("div",{className:"px-3 py-1.5 rounded-full  text-secondary bg-muted-foreground/5   font-medium capitalize shadow-sm hover:shadow-md transition-all duration-300 flex items-center gap-1.5",children:h.trim()},m))})]}),g.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(ur,{className:"w-5 h-5 text-primary-foreground"})}),e.jsx(l,{variant:"small",children:a?"المعدات المطلوبة":"Required Equipment"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:g.map((h,m)=>e.jsxs("div",{className:"px-3 py-1.5 rounded-full text-primary-foreground bg-blue-50   transition-all duration-300 flex items-center gap-1.5",children:[e.jsx(xr,{className:"w-3 h-3"}),a?h.equipments_nameAr:h.equipments_nameEn]},m))})]}),_.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pr,{className:"w-5 h-5 text-secondary"}),e.jsx(l,{variant:"small",children:a?"خطوات التمرين":"Exercise Steps"})]}),e.jsx("div",{className:"p-4 bg-primary-foreground/5 to-transparent rounded-lg space-y-3",children:_.map((h,m)=>e.jsx("div",{className:"flex items-start gap-3 group",children:e.jsx(l,{variant:"para",children:b(h)})},m))})]}),q.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lt,{className:"w-4 h-4 text-destructive"}),e.jsx(l,{variant:"small",children:a?"أخطاء شائعة":"Common Mistakes"})]}),e.jsx("div",{className:"p-3 bg-destructive/5 rounded-lg ",children:e.jsx("ul",{className:"space-y-2",children:q.map((h,m)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-destructive mt-1",children:"•"}),e.jsx(l,{variant:"small",className:"text-destructive leading-relaxed",children:h})]},m))})})]}),f&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hr,{className:"w-4 h-4 text-custom-yellow-text"}),e.jsx(l,{variant:"small",children:a?"نصائح مهمة":"Important Tips"})]}),e.jsx("div",{className:"p-3 bg-accent-foreground/15 rounded-lg ",children:e.jsx(l,{variant:"small",className:"text-accent-foreground text-sm leading-relaxed",children:f})})]})]}),e.jsxs("div",{className:"mt-6 ",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-blue-100 to-indigo-100 flex items-center justify-center",children:e.jsx(Tt,{className:"w-4 h-4 text-primary-foreground"})}),e.jsx(l,{variant:"h4",className:"font-semibold text-foreground",children:a?"وسائط التمرين":"Exercise Media"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"Edit",onClick:i,children:e.jsx(We,{className:"w-4 h-4 mr-1"})}),e.jsx(k,{variant:"Delete",onClick:r,children:e.jsx(we,{className:"w-4 h-4 mr-1"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-4",children:[e.jsx("div",{className:"group relative h-72 rounded-xl overflow-hidden shadow-sm",children:!c&&t?.exercise_img?e.jsx("img",{src:`${va}/${t.exercise_img}`,alt:j,className:"w-full h-full object-cover group-hover:scale-105 transition-all duration-700 ease-in-out",onError:()=>x(!0),loading:"lazy"}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-slate-50",children:[e.jsx(Ye,{className:"w-12 h-12 mb-2 text-slate-300"}),e.jsx(l,{variant:"small",className:"font-medium text-slate-400",children:a?"لا توجد صورة":"No Image"})]})}),e.jsx("div",{className:"group relative h-72 rounded-xl overflow-hidden shadow-sm",children:!p&&t?.exercise_video?e.jsxs("video",{controls:!0,className:"w-full h-full object-cover",onError:()=>o(!0),children:[e.jsx("source",{src:`${_a}/${t.exercise_video}`,type:"video/mp4"}),a?"متصفحك لا يدعم تشغيل الفيديو":"Your browser does not support video playback"]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-slate-50",children:[e.jsx(Tt,{className:"w-12 h-12 mb-2 text-slate-300"}),e.jsx(l,{variant:"small",children:a?"لا يوجد فيديو":"No Video"})]})})]})]})]})})}),So=ke.memo(function(){return e.jsx(Ae,{className:"overflow-hidden bg-background shadow-md rounded-xl",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"h-8 bg-muted/40 rounded-xl animate-pulse"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{className:"h-16 bg-muted/20 rounded-xl animate-pulse"}),e.jsx("div",{className:"h-16 bg-muted/20 rounded-xl animate-pulse"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-muted/40 rounded-xl animate-pulse"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-6 w-16 bg-muted/40 rounded-xl animate-pulse"}),e.jsx("div",{className:"h-6 w-20 bg-muted/40 rounded-xl animate-pulse"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-muted/40 rounded-xl animate-pulse"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-7 h-7 bg-primary/10 rounded-full animate-pulse"}),e.jsx("div",{className:"flex-1 h-10 bg-muted/20 rounded-xl animate-pulse"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-7 h-7 bg-primary/10 rounded-full animate-pulse"}),e.jsx("div",{className:"flex-1 h-10 bg-muted/20 rounded-xl animate-pulse"})]})]})]})]}),e.jsxs("div",{className:"mt-6 ",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-muted/30 animate-pulse"}),e.jsx("div",{className:"h-5 w-32 bg-muted/40 rounded animate-pulse"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-16 h-8 bg-muted/20 rounded-md animate-pulse"}),e.jsx("div",{className:"w-16 h-8 bg-muted/20 rounded-md animate-pulse"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-4",children:[e.jsx("div",{className:"h-72 bg-slate-50 rounded-xl shadow-sm animate-pulse",children:e.jsx("div",{className:"h-6 w-20 bg-white/90 rounded-full m-3 animate-pulse"})}),e.jsx("div",{className:"h-72 bg-slate-50 rounded-xl shadow-sm animate-pulse",children:e.jsx("div",{className:"h-6 w-20 bg-white/90 rounded-full m-3 animate-pulse"})})]})]})]})})}),Do=ke.memo(function({open:t,onOpenChange:a,exercise:n,isArabic:i,onConfirm:r,isLoading:c}){if(!n)return null;const x=i?n.exercise_nameAr:n.exercise_nameEn;return e.jsx(me,{open:t,onOpenChange:a,children:e.jsxs(ue,{className:"sm:max-w-[500px]",children:[e.jsxs(ye,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-16 h-16 bg-gradient-to-br from-red-100 to-red-200 rounded-full flex items-center justify-center",children:e.jsx(we,{className:"w-8 h-8 text-destructive"})}),e.jsx(xe,{className:"text-xl font-bold text-destructive text-start",children:i?"تأكيد حذف التمرين":"Confirm Exercise Deletion"}),e.jsx(Ie,{className:"text-center text-muted-foreground",children:i?"هل أنت متأكد من حذف هذا التمرين؟ هذا الإجراء لا يمكن التراجع عنه.":"Are you sure you want to delete this exercise? This action cannot be undone."})]}),e.jsx("div",{className:"p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg ",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-primary/20 to-secondary/20 rounded-lg flex items-center justify-center",children:e.jsx(Ye,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{variant:"h4",className:"font-semibold",children:x}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ds,{className:"w-3 h-3"}),n.exercise_duration," ",i?"دقيقة":"min"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Bs,{className:"w-3 h-3"}),n.exercise_Kcal," ",i?"سعرة":"kcal"]})]})]})]})}),e.jsx("div",{className:"p-3 bg-red-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ze,{className:"w-5 h-5 text-destructive flex-shrink-0 mt-0.5"}),e.jsx(l,{variant:"small",className:"text-destructive",children:i?"سيتم حذف هذا التمرين نهائياً من النظام مع جميع بياناته وملفاته.":"This exercise will be permanently deleted from the system along with all its data and files."})]})}),e.jsxs(be,{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>a(!1),className:"w-full sm:w-auto",children:i?"إلغاء":"Cancel"}),e.jsx(k,{type:"button",variant:"destructive",onClick:r,disabled:c,className:"w-full sm:w-auto",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 mr-2 animate-spin rounded-full "}),i?"جاري الحذف...":"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),i?"حذف التمرين":"Delete Exercise"]})})]})]})})});async function ko(){return(await K.post(`${z}/api84818datachallenges/getDataChallenges`)).data}function qo(){return ie({queryKey:["challenges"],queryFn:ko,staleTime:5*60*1e3,cacheTime:10*60*1e3,refetchOnWindowFocus:!1,refetchOnMount:!0})}function To(){const{t:s,i18n:t}=re(),a=t.language==="ar",[n,i]=d.useState(""),[r,c]=d.useState(null),[x,p]=d.useState(!1),[o,j]=d.useState(!1),[y,g]=d.useState(!1),{data:f,isLoading:_,error:q}=qo(),b=d.useMemo(()=>{if(!f?.data)return[];if(!n.trim())return f.data;const S=n.toLowerCase();return f.data.filter(C=>C.challenges_nameEn.toLowerCase().includes(S)||C.challenges_nameAr.toLowerCase().includes(S))},[f?.data,n]),h=S=>S?S.split(`
`).filter(Boolean).map(M=>{const[$,...H]=M.split(",");return{title:$.replace(/;/g,""),steps:H.filter(Boolean)}}):[],m=S=>S?S.split(",").map(C=>C.trim()).filter(Boolean):[],u=S=>{c(S),p(!0)},v=S=>{S.stopPropagation(),j(!0)},A=S=>{S.stopPropagation(),p(!1),g(!0)},I=()=>{G.success(a?"تم حذف التحدي بنجاح":"Challenge deleted successfully"),j(!1),p(!1)};return q?(G.error(a?"حدث خطأ أثناء تحميل التحديات":"Error loading challenges"),e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(l,{variant:"h2",className:"text-destructive",children:a?"خطأ في تحميل التحديات":"Error Loading Challenges"}),e.jsx(l,{variant:"para",className:"mt-2",children:a?"يرجى المحاولة مرة أخرى لاحقًا":"Please try again later"})]})):e.jsxs("div",{className:"container mx-auto p-4 md:p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(l,{variant:"h2",className:"text-2xl md:text-3xl font-bold",children:a?"التحديات":"Challenges"}),e.jsx(l,{variant:"para",className:"mt-2",children:a?"ٌقم بإدارة التحديات الخاصة للمسخدمين  ":"manage your Challenges"})]}),e.jsxs("div",{className:"relative mb-6 sm:w-1/4",children:[e.jsx(Ms,{className:"absolute end-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:18}),e.jsx(F,{type:"text",placeholder:a?"ابحث عن التحديات...":"Search challenges...",value:n,onChange:S=>i(S.target.value)})]}),b.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx(l,{variant:"h2",children:a?"لا توجد تحديات متطابقة":"No matching challenges found"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:b.map(S=>e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 hover:shadow-lg transition-all duration-300 group",children:[e.jsxs("div",{className:"relative h-48 overflow-hidden bg-gray-100",children:[e.jsx(ps.LazyLoadImage,{src:`${it}/${S.challenges_img}`,alt:a?S.challenges_nameAr:S.challenges_nameEn,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500",effect:"blur",placeholderSrc:"",wrapperClassName:"w-full h-full"}),e.jsxs("div",{className:"absolute top-3 right-3 bg-primary/50 text-white px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(Qe,{size:14,className:"ml-1"}),S.challenges_price]}),e.jsxs("div",{className:"absolute top-3 left-3 bg-white/90 backdrop-blur-sm text-primary px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(zs,{size:14,className:"ml-2"}),S.challenges_num_days," ",a?"يوم":"days"]})]}),e.jsxs("div",{className:"p-5",children:[e.jsx(l,{variant:"md",children:a?S.challenges_nameAr:S.challenges_nameEn}),e.jsx(l,{className:"line-clamp-2",variant:"p",children:a?S.challenges_aboutAr:S.challenges_aboutEn}),e.jsxs("div",{className:"flex items-center gap-2 text-sm pt-2 text-gray-500 mb-4",children:[e.jsx(fs,{size:16,className:"mr-1"}),e.jsxs("span",{children:[S.challenges_num_joined.toLocaleString()," ",a?"مشترك":"joined"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(It,{size:16,className:"text-custom-yellow-text"}),e.jsx(l,{variant:"p",children:a?"النتائج المتوقعة":"Expected Results"})]}),e.jsxs("ul",{className:"text-xs text-primary space-y-1",children:[m(a?S.challenges_resultAr:S.challenges_resultEn).slice(0,2).map((C,M)=>e.jsxs("li",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-primary rounded-full mr-2"}),C]},M)),m(a?S.challenges_resultAr:S.challenges_resultEn).length>2&&e.jsx("li",{className:"text-primary text-xs",children:a?"والمزيد...":"And more..."})]})]}),e.jsxs(k,{className:"w-full group",onClick:()=>u(S),children:[a?"عرض التفاصيل":"View Details",e.jsx(gr,{size:16,className:"ml-2 group-hover:translate-x-1 transition-transform"})]})]})]},S.challenges_id))}),r&&e.jsx(me,{open:x,onOpenChange:p,children:e.jsxs(ue,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",dir:a?"rtl":"ltr",children:[e.jsx(ye,{className:" pb-4",children:e.jsxs(xe,{className:"text-2xl font-bold flex items-center justify-between",children:[e.jsx(l,{variant:"md",children:a?r.challenges_nameAr:r.challenges_nameEn}),e.jsxs("div",{className:"flex items-center gap-2 pt-5",children:[e.jsx(k,{variant:"outline",size:"icon",className:"h-8 w-8 text-primary-foreground hover:text-primary-foreground/90 hover:bg-blue-50",onClick:A,children:e.jsx(We,{size:16})}),e.jsx(k,{variant:"outline",size:"icon",className:"h-8 w-8 text-destructive/90 hover:text-destructive hover:bg-red-50",onClick:v,children:e.jsx(we,{size:16})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1  gap-6 py-6",children:[e.jsx("div",{className:"rounded-lg overflow-hidden bg-gray-100 h-64 md:h-auto",children:e.jsx(ps.LazyLoadImage,{src:`${it}/${r.challenges_img}`,alt:a?r.challenges_nameAr:r.challenges_nameEn,className:"w-[18rem] h-full object-cover",effect:"blur",placeholderSrc:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2Y3ZjdmNyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjE4IiBmaWxsPSIjY2NjIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+TG9hZGluZy4uLjwvdGV4dD48L3N2Zz4=",wrapperClassName:"w-full h-full"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(l,{variant:"md",children:a?"نبذة عن التحدي":"About Challenge"}),e.jsx(l,{variant:"para",children:a?r.challenges_aboutAr:r.challenges_aboutEn})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 flex items-center gap-3 flex-1 min-w-[140px]",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(zs,{className:"w-5 h-5 text-primary-foreground"})}),e.jsxs("div",{children:[e.jsx(l,{variant:"para",children:a?"المدة":"Duration"}),e.jsxs(l,{variant:"para",children:[r.challenges_num_days," ",a?"يوم":"days"]})]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 flex items-center gap-3 flex-1 min-w-[140px]",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx(Qe,{className:"w-5 h-5 text-accent-foreground"})}),e.jsxs("div",{children:[e.jsx(l,{variant:"para",children:a?"السعر":"Price"}),e.jsxs(l,{variant:"para",children:["$",r.challenges_price]})]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3 flex items-center gap-3 flex-1 min-w-[140px]",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center",children:e.jsx(fs,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx(l,{variant:"para",children:a?"المشتركين":"Participants"}),e.jsx(l,{variant:"para",children:r.challenges_num_joined.toLocaleString()})]})]})]})]})]}),e.jsxs(qa,{defaultValue:"results",className:"mt-6",children:[e.jsxs(jt,{className:"grid w-full grid-cols-2",children:[e.jsx(hs,{value:"results",children:a?"النتائج المتوقعة":"Expected Results"}),e.jsx(hs,{value:"steps",children:a?"خطوات التحدي":"Challenge Steps"})]}),e.jsxs(gs,{value:"results",className:`p-4 shadow rounded-lg mt-2 ${a?"text-right":"text-left"}`,dir:a?"rtl":"ltr",children:[e.jsxs(l,{className:"flex items-center gap-2",variant:"h2",children:[a?"النتائج المتوقعة":"Expected Results",e.jsx(It,{className:"w-5 h-5 text-custom-yellow-text"})]}),e.jsx("ul",{className:"space-y-3 mt-4",children:m(a?r.challenges_resultAr:r.challenges_resultEn).map((S,C)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Us,{className:"w-5 h-5 text-accent-foreground flex-shrink-0 mt-0.5"}),e.jsx("span",{children:S})]},C))})]}),e.jsxs(gs,{value:"steps",className:`p-4 shadow  rounded-lg mt-2 ${a?"text-right":"text-left"}`,dir:a?"rtl":"ltr",children:[e.jsxs(l,{className:"flex items-center gap-1",variant:"md",children:[e.jsx(Us,{className:"w-5 h-5 text-primary-foreground"}),a?"خطوات التحدي":"Challenge Steps"]}),e.jsx("div",{className:"space-y-6",children:h(a?r.challenges_stepsAr:r.challenges_stepsEn).map((S,C)=>e.jsxs("div",{className:"border-b pb-4 last:border-0",children:[e.jsx("h4",{className:"font-medium text-primary mb-2",children:S.title}),e.jsx("ul",{className:"space-y-2 pl-6 list-disc",children:S.steps.map((M,$)=>e.jsx("li",{className:"text-gray-700",children:M},$))})]},C))})]})]}),e.jsx(be,{className:"mt-6 pt-4 ",children:e.jsx(k,{variant:"outline",onClick:()=>p(!1),children:a?"إغلاق":"Close"})})]})}),r&&e.jsx(me,{open:o,onOpenChange:j,children:e.jsxs(ue,{className:"max-w-md",dir:a?"rtl":"ltr",children:[e.jsx(ye,{children:e.jsxs(xe,{className:"flex items-center gap-3 text-destructive",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(Ze,{className:"w-5 h-5 text-destructive"})}),a?"تأكيد الحذف":"Confirm Deletion"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-lg overflow-hidden flex-shrink-0",children:e.jsx(ps.LazyLoadImage,{src:`${it}/${r.challenges_img}`,alt:a?r.challenges_nameAr:r.challenges_nameEn,className:"w-full h-full object-cover",effect:"blur",placeholderSrc:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMTAiIGZpbGw9IiNjY2MiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5JbWFnZTwvdGV4dD48L3N2Zz4=",wrapperClassName:"w-full h-full"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{variant:"h2",children:a?r.challenges_nameAr:r.challenges_nameEn}),e.jsx("p",{className:"text-sm text-gray-500",children:a?r.challenges_nameEn:r.challenges_nameAr}),e.jsxs("p",{className:"text-sm text-accent-foreground font-medium",children:["$",r.challenges_price]})]})]}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ze,{className:"w-5 h-5 text-destructive flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-destructive mb-1",children:a?"تحذير":"Warning"}),e.jsx("p",{className:"text-sm text-destructive",children:a?"سيؤدي حذف هذا التحدي إلى إزالته نهائيًا من النظام. هذا الإجراء لا يمكن التراجع عنه.":"Deleting this challenge will permanently remove it from the system. This action cannot be undone."})]})]})}),e.jsx("div",{className:"text-center",children:e.jsx(l,{variant:"md",children:a?"هل أنت متأكد من رغبتك في حذف هذا التحدي؟":"Are you sure you want to delete this challenge?"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(k,{variant:"destructive",onClick:I,className:"flex-1 flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),a?"حذف":"Delete"]}),e.jsx(k,{variant:"outline",onClick:()=>j(!1),className:"flex-1",children:a?"إلغاء":"Cancel"})]})]})]})}),r&&e.jsx(me,{open:y,onOpenChange:g,children:e.jsxs(ue,{className:"max-w-4xl",dir:a?"rtl":"ltr",children:[e.jsx(ye,{children:e.jsx(xe,{children:a?"تعديل التحدي":"Edit Challenge"})}),e.jsx("div",{className:"py-4",children:e.jsx(l,{variant:"para",className:"text-center py-8",children:a?"نموذج تعديل التحدي سيتم إضافته هنا":"Challenge edit form will be added here"})}),e.jsxs(be,{children:[e.jsx(k,{variant:"outline",onClick:()=>g(!1),children:a?"إلغاء":"Cancel"}),e.jsx(k,{children:a?"حفظ التغييرات":"Save Changes"})]})]})})]})}async function Io(){return(await K.post(`${z}/api84818datachapter/getDataChapters`)).data}async function Mo(s){return(await K.put(`${z}/api84818datachapter/updateChapter`,s)).data}function Fo(){return ie({queryKey:["chapter-data"],queryFn:Io})}function Po(){const s=pe();return de({mutationFn:Mo,onSuccess:()=>{s.invalidateQueries({queryKey:["chapter-data"]})}})}const Oo=5*1024*1024,$a=["image/jpeg","image/jpg","image/png","image/webp"],Lo=Ge({chapter_textEn:B().min(1,"English text is required"),chapter_textAr:B().min(1,"Arabic text is required"),chapter_img:Je().optional().refine(s=>!s||s.size<=Oo,"Max image size is 5MB.").refine(s=>!s||$a.includes(s.type),"Only .jpg, .jpeg, .png and .webp formats are supported.")});function Ro({isOpen:s,onClose:t,chapter:a}){const{t:n}=re(),i=Po(),[r,c]=d.useState(null),x=d.useRef(null),p=Ve({resolver:Be(Lo),defaultValues:{chapter_textEn:"",chapter_textAr:"",chapter_img:void 0}});d.useEffect(()=>{a?(p.reset({chapter_textEn:a.chapter_textEn||"",chapter_textAr:a.chapter_textAr||"",chapter_img:void 0}),a.chapter_img?c(`${z}/query/chapter/chapterImages/images/${a.chapter_img}`):c(null)):(p.reset(),c(null))},[a,p,s]);const o=y=>{const g=y.target.files?.[0];if(g){p.setValue("chapter_img",g,{shouldValidate:!0});const f=new FileReader;f.onloadend=()=>{c(f.result)},f.readAsDataURL(g)}else p.setValue("chapter_img",void 0,{shouldValidate:!0}),c(null)},j=async y=>{try{const g=new FormData;g.append("chapter_id",a.chapter_id),g.append("chapter_textEn",y.chapter_textEn),g.append("chapter_textAr",y.chapter_textAr),y.chapter_img&&g.append("chapter_img",y.chapter_img),await i.mutateAsync(g),G.success(n("start_brain.chapterUpdatedSuccess")),t()}catch{G.error(n("start_brain.chapterUpdatedError"))}};return e.jsx(me,{open:s,onOpenChange:t,children:e.jsxs(ue,{className:"max-w-3xl max-h-[40rem] overflow-y-scroll",children:[e.jsx(ye,{children:e.jsx(xe,{className:"text-start pt-10",children:e.jsxs(l,{variant:"md",children:[" ",n("start_brain.editChapter")]})})}),e.jsx(Xe,{...p,children:e.jsxs("form",{onSubmit:p.handleSubmit(j),className:"space-y-6 p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-1 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(P,{control:p.control,name:"chapter_textEn",render:({field:y})=>e.jsxs(O,{children:[e.jsx(V,{className:"text-gray-700 font-medium",children:n("start_brain.englishText")}),e.jsx(U,{children:e.jsx("textarea",{...y,className:"w-full min-h-[150px] p-4 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition",placeholder:n("start_brain.enterEnglishText")})}),e.jsx(R,{})]})}),e.jsx(P,{control:p.control,name:"chapter_textAr",render:({field:y})=>e.jsxs(O,{children:[e.jsx(V,{className:"text-gray-700 font-medium",children:n("start_brain.arabicText")}),e.jsx(U,{children:e.jsx("textarea",{...y,className:"w-full min-h-[150px] p-4 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 transition text-right",placeholder:n("start_brain.enterArabicText"),dir:"rtl"})}),e.jsx(R,{})]})})]}),e.jsxs("div",{className:"space-y-2 flex flex-col",children:[e.jsx(V,{className:"text-gray-700 font-medium",children:n("start_brain.chapterImage")}),e.jsx("div",{className:"flex-grow w-full aspect-video rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center relative overflow-hidden group bg-gray-50",children:r?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:r,alt:"Preview",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gray-50/20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(k,{type:"button",variant:"destructive",size:"icon",onClick:()=>{c(null),p.setValue("chapter_img",void 0),x.current&&(x.current.value="")},children:e.jsx(we,{className:"h-5 w-5"})})})]}):e.jsxs("div",{className:"text-center text-gray-500 cursor-pointer",onClick:()=>x.current?.click(),children:[e.jsx(fr,{className:"mx-auto h-12 w-12"}),e.jsx("p",{className:"mt-2",children:n("common.uploadImage")})]})}),e.jsx(P,{control:p.control,name:"chapter_img",render:({field:y})=>e.jsxs(O,{children:[e.jsx(U,{children:e.jsx(F,{type:"file",ref:x,onChange:o,className:"hidden",accept:$a.join(",")})}),e.jsxs(k,{type:"button",variant:"outline",onClick:()=>x.current?.click(),className:"w-full",children:[e.jsx(ms,{className:"mr-2 h-4 w-4"}),n("common.selectImage")]}),e.jsx(R,{})]})})]})]}),e.jsxs(be,{className:"gap-3 pt-6",children:[e.jsxs(k,{type:"button",variant:"outline",onClick:t,children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),n("common.cancel")]}),e.jsx(k,{type:"submit",disabled:i.isPending,children:i.isPending?e.jsxs(e.Fragment,{children:[e.jsx(vs,{className:"mr-2 h-4 w-4 animate-spin"}),n("common.saving")]}):e.jsxs(e.Fragment,{children:[e.jsx(_s,{className:"mr-2 h-4 w-4"}),n("common.saveChanges")]})})]})]})})]})})}function $o(){const{t:s,i18n:t}=re(),[a,n]=d.useState(null),[i,r]=d.useState(!1),c=t.language==="ar",{data:x,isLoading:p,isError:o,error:j}=Fo(),y=_=>{n(_),r(!0)},g=()=>{r(!1),n(null)};if(p)return e.jsx("div",{className:"min-h-screen  flex items-center justify-center",children:e.jsx($e,{})});if(o)return e.jsx("div",{className:"min-h-screen  flex items-center justify-center",children:e.jsx("div",{className:"bg-white p-8 rounded-lg shadow-sm  max-w-md text-center",children:e.jsx(l,{variant:"p",className:"text-gray-600",children:j.message})})});const f=Array.isArray(x)?x:x?.data||[];return f.length===0?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"bg-white p-8 rounded-lg shadow-sm border max-w-md text-center",children:e.jsx(l,{variant:"h2",children:s("start_brain.noChaptersFound")})})}):e.jsxs("div",{className:"min-h-screen ",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(l,{variant:"h2",children:s("start_brain.startWithYourBrain")}),e.jsx(l,{variant:"p",children:s("start_brain.educationalChaptersManagement")})]})})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-8",children:e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:f.map(_=>e.jsxs("div",{className:"group bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow duration-200 overflow-hidden",children:[_.chapter_img&&e.jsx("div",{className:"aspect-video overflow-hidden",children:e.jsx("img",{className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",src:`${z}/query/chapter/chapterImages/images/${_.chapter_img}`,alt:`Chapter ${_.chapter_id}`})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"bg-gray-100 px-3 py-1 rounded-full",children:e.jsxs(l,{variant:"p",children:[s("start_brain.chapter")," #",_.chapter_id]})}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>y(_),children:e.jsx(fa,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-3",children:e.jsx(l,{variant:"p",className:"text-gray-800 leading-relaxed line-clamp-4",children:c?_.chapter_textAr:_.chapter_textEn})})]})]},_.chapter_id))})}),a&&e.jsx(Ro,{isOpen:i,onClose:g,chapter:a})]})}function bt({value:s,onChange:t,defaultImage:a=null,labelText:n={ar:"انقر لتغيير الصورة",en:"Click to change image"}}){const{i18n:i}=re(),r=i.language==="ar",[c,x]=d.useState(null);d.useEffect(()=>{if(!s){x(a||null);return}if(s instanceof File){const j=URL.createObjectURL(s);return x(j),()=>URL.revokeObjectURL(j)}typeof s=="string"&&x(s)},[s,a]);const p=j=>{const y=j.target.files?.[0];if(y){if(!["image/png","image/jpeg","image/webp"].includes(y.type)){alert("فقط PNG, JPG, WebP مدعومة");return}if(y.size>2*1024*1024){alert("الحجم الأقصى 2MB");return}t(y)}},o=()=>{t(void 0),x(null)};return e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{tabIndex:0,onKeyDown:j=>{(j.key==="Enter"||j.key===" ")&&j.currentTarget.querySelector("input")?.click()},className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors",children:[c?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:c,alt:"preview",className:"w-full h-full object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:o,className:"absolute z-50 cursor-pointer top-2 right-2 bg-destructive text-white rounded-full p-1 hover:bg-destructive/90 transition-colors",children:e.jsx(ve,{className:"w-4 h-4 "})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(ms,{className:"w-8 h-8 mb-2 text-gray-400"}),e.jsx(l,{variant:"para",className:"text-sm text-gray-500",children:r?n.ar:n.en}),e.jsx(l,{variant:"para",className:"text-xs text-gray-400",children:"PNG / JPG / WebP"})]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:p})]})})}const zo=Ge({food_nameAr:B().min(1,{message:"Required"}),food_nameEn:B().min(1,{message:"Required"}),food_kcal:Ke().positive({message:"Must be > 0"}),food_protein:Ke().min(0,{message:"Must be >= 0"}),food_fat:Ke().min(0,{message:"Must be >= 0"}),food_carbs:Ke().min(0,{message:"Must be >= 0"}),food_cookingtime:Ke().min(0,{message:"Must be >= 0"}),food_noteEn:B().min(1,{message:"Required"}),food_noteAr:B().min(1,{message:"Required"}),food_ingredientsEn:B().min(1,{message:"Required"}),food_ingredientsAr:B().min(1,{message:"Required"}),food_preparationEn:B().min(1,{message:"Required"}),food_preparationAr:B().min(1,{message:"Required"}),food_diettype_id:B().min(1,{message:"Required"}),food_img:Je().optional()}),Uo=({meal:s,open:t,onOpenChange:a,t:n,i18n:i})=>{const r=Ve({resolver:Be(zo),defaultValues:{food_nameAr:"",food_nameEn:"",food_kcal:"",food_protein:"",food_fat:"",food_carbs:"",food_cookingtime:"",food_noteEn:"",food_noteAr:"",food_ingredientsEn:"",food_ingredientsAr:"",food_preparationEn:"",food_preparationAr:"",food_diettype_id:"",food_img:void 0}}),{data:c,isLoading:x}=Ds(),[p,o]=d.useState(null),[j,y]=d.useState(!1),[g,f]=d.useState(null),_=pe(),{mutateAsync:q,isPending:b}=_l();d.useEffect(()=>{y(b)},[b]),d.useEffect(()=>{s&&t&&(r.reset({food_nameAr:s.food_nameAr||"",food_nameEn:s.food_nameEn||"",food_kcal:s.food_kcal||"",food_protein:s.food_protein||"",food_fat:s.food_fat||"",food_carbs:s.food_carbs||"",food_cookingtime:s.food_cookingtime||"",food_noteEn:s.food_noteEn||"",food_noteAr:s.food_noteAr||"",food_ingredientsEn:s.food_ingredientsEn||"",food_ingredientsAr:s.food_ingredientsAr||"",food_preparationEn:s.food_preparationEn||"",food_preparationAr:s.food_preparationAr||"",food_diettype_id:s.food_diettype_id?.toString()||"",food_img:void 0}),s.food_img&&o(`${Is}/${s.food_img}`))},[s,t,r]);const h=async u=>{try{y(!0);const v=new FormData;v.append("food_id",String(s.food_id)),v.append("food_nameAr",u.food_nameAr),v.append("food_nameEn",u.food_nameEn),v.append("food_kcal",String(u.food_kcal)),v.append("food_protein",String(u.food_protein)),v.append("food_fat",String(u.food_fat)),v.append("food_carbs",String(u.food_carbs)),v.append("food_cookingtime",String(u.food_cookingtime)),v.append("food_noteEn",u.food_noteEn),v.append("food_noteAr",u.food_noteAr),v.append("food_ingredientsEn",u.food_ingredientsEn),v.append("food_ingredientsAr",u.food_ingredientsAr),v.append("food_preparationEn",u.food_preparationEn),v.append("food_preparationAr",u.food_preparationAr),v.append("food_diettype_id",u.food_diettype_id),u.food_img instanceof File&&v.append("food_img",u.food_img,u.food_img.name),await q(v),_.invalidateQueries({queryKey:["meals"]}),G.success(i?.language==="ar"?"تم تحديث الوجبة بنجاح":"Meal updated successfully"),a(!1),r.reset(),o(null)}catch(v){console.error(v),G.error(i?.language==="ar"?"فشل تحديث الوجبة":"Failed to update meal")}finally{y(!1)}},m=(u,v)=>i?.language==="ar"?u:v;return e.jsx(me,{open:t,onOpenChange:u=>{a(u),u||(r.reset(),o(null))},children:e.jsxs(ue,{className:"sm:max-w-[600px] pt-10 max-h-[90vh] overflow-y-auto",children:[e.jsxs(ye,{children:[e.jsx(xe,{children:m("تعديل الوجبة","Edit Meal")}),e.jsx(Ie,{children:m("قم بتعديل معلومات الوجبة حسب الحاجة","Update the meal information as needed")})]}),e.jsx(Xe,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(h),className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{control:r.control,name:"food_nameAr",render:({field:u})=>e.jsxs(O,{children:[e.jsx(V,{children:m("اسم الوجبة (ع)","Meal name (Ar)")}),e.jsx(U,{children:e.jsx(F,{placeholder:m("مثال: سلطة","e.g., سلطة"),...u})}),e.jsx(R,{})]})}),e.jsx(P,{control:r.control,name:"food_nameEn",render:({field:u})=>e.jsxs(O,{children:[e.jsx(V,{children:m("اسم الوجبة (En)","Meal name (En)")}),e.jsx(U,{children:e.jsx(F,{placeholder:"e.g., Salad",...u})}),e.jsx(R,{})]})}),e.jsx(P,{control:r.control,name:"food_kcal",render:({field:u})=>e.jsxs(O,{children:[e.jsx(V,{children:m("السعرات الحرارية","Calories (kcal)")}),e.jsx(U,{children:e.jsx(F,{type:"number",step:"0.1",...u})}),e.jsx(R,{})]})}),e.jsx(P,{control:r.control,name:"food_protein",render:({field:u})=>e.jsxs(O,{children:[e.jsx(V,{children:m("البروتين (غم)","Protein (g)")}),e.jsx(U,{children:e.jsx(F,{type:"number",step:"0.1",...u})}),e.jsx(R,{})]})}),e.jsx(P,{control:r.control,name:"food_fat",render:({field:u})=>e.jsxs(O,{children:[e.jsx(V,{children:m("الدهون (غم)","Fat (g)")}),e.jsx(U,{children:e.jsx(F,{type:"number",step:"0.1",...u})}),e.jsx(R,{})]})}),e.jsx(P,{control:r.control,name:"food_carbs",render:({field:u})=>e.jsxs(O,{children:[e.jsx(V,{children:m("الكربوهيدرات (غم)","Carbs (g)")}),e.jsx(U,{children:e.jsx(F,{type:"number",step:"0.1",...u})}),e.jsx(R,{})]})}),e.jsx(P,{control:r.control,name:"food_cookingtime",render:({field:u})=>e.jsxs(O,{children:[e.jsx(V,{children:m("وقت الطبخ (دقيقة)","Cooking time (min)")}),e.jsx(U,{children:e.jsx(F,{type:"number",step:"1",...u})}),e.jsx(R,{})]})}),e.jsx(P,{control:r.control,name:"food_diettype_id",render:({field:u})=>e.jsxs(O,{children:[e.jsx(V,{children:m("نوع الحمية","Diet type")}),e.jsx(U,{children:e.jsxs(ze,{onValueChange:u.onChange,value:u.value,children:[e.jsx(Oe,{className:"w-full",children:e.jsx(Ue,{placeholder:m("اختر نوع الحمية","Select diet type")})}),e.jsx(Le,{children:!x&&c?.data?.map(v=>e.jsx(Ce,{value:v.diettype_id.toString(),children:i?.language==="ar"?v.diettype_titleAr:v.diettype_titleEn},v.diettype_id))})]})}),e.jsx(R,{})]})}),e.jsx(P,{control:r.control,name:"food_noteAr",render:({field:u})=>e.jsxs(O,{className:"md:col-span-2",children:[e.jsx(V,{children:m("ملاحظات (ع)","Notes (Ar)")}),e.jsx(U,{children:e.jsx(_e,{rows:2,...u})}),e.jsx(R,{})]})}),e.jsx(P,{control:r.control,name:"food_noteEn",render:({field:u})=>e.jsxs(O,{className:"md:col-span-2",children:[e.jsx(V,{children:m("ملاحظات (En)","Notes (En)")}),e.jsx(U,{children:e.jsx(_e,{rows:2,...u})}),e.jsx(R,{})]})}),e.jsx(P,{control:r.control,name:"food_ingredientsAr",render:({field:u})=>e.jsxs(O,{className:"md:col-span-2",children:[e.jsx(V,{children:m("المكونات (ع)","Ingredients (Ar)")}),e.jsx(U,{children:e.jsx(_e,{rows:3,...u})}),e.jsx(R,{})]})}),e.jsx(P,{control:r.control,name:"food_ingredientsEn",render:({field:u})=>e.jsxs(O,{className:"md:col-span-2",children:[e.jsx(V,{children:m("المكونات (En)","Ingredients (En)")}),e.jsx(U,{children:e.jsx(_e,{rows:3,...u})}),e.jsx(R,{})]})}),e.jsx(P,{control:r.control,name:"food_preparationAr",render:({field:u})=>e.jsxs(O,{className:"md:col-span-2",children:[e.jsx(V,{children:m("طريقة التحضير (Ar)","Preparation (Ar)")}),e.jsx(U,{children:e.jsx(_e,{rows:3,...u})}),e.jsx(R,{})]})}),e.jsx(P,{control:r.control,name:"food_preparationEn",render:({field:u})=>e.jsxs(O,{className:"md:col-span-2",children:[e.jsx(V,{children:m("طريقة التحضير (En)","Preparation (En)")}),e.jsx(U,{children:e.jsx(_e,{rows:3,...u})}),e.jsx(R,{})]})}),e.jsx(P,{control:r.control,name:"food_img",render:({field:u})=>e.jsxs(O,{className:"md:col-span-2",children:[e.jsxs(l,{variant:"p",className:"text-sm font-medium",children:[m("صورة الوجبة","Meal image"),e.jsx(l,{variant:"p",children:m("(اختياري - اتركه فارغاً للاحتفاظ بالصورة الحالية)","(optional - leave empty to keep current image)")})]}),e.jsx(bt,{value:u.value,onChange:u.onChange,defaultImage:s?.food_img?`${Is}/${s.food_img}`:null,labelText:{ar:"انقر لتغيير الصورة",en:"Click to change image"}})]})}),e.jsx(be,{className:"md:col-span-2",children:e.jsx(k,{type:"submit",disabled:j,children:j?"جاري الحفظ...":m("حفظ","Save")})})]})})]})})},Go=({meal:s,onSelectMeal:t,t:a,i18n:n})=>{const{mutate:i,isLoading:r}=bl(),[c,x]=d.useState(!1),[p,o]=d.useState(!1),j=n.language==="ar"?s.food_nameAr:s.food_nameEn,y=()=>{i(s.food_id,{onSuccess:()=>{G.success(n.language==="ar"?"تم حذف الوجبة":"Meal deleted")},onError:()=>{G.error(n.language==="ar"?"فشل حذف الوجبة":"Failed to delete meal")}})};return e.jsxs(e.Fragment,{children:[e.jsxs(Ae,{className:"group flex shadow rounded-2xl flex-col overflow-hidden transition-all duration-300 hover:shadow-lg relative",children:[e.jsxs("div",{className:"absolute top-3 right-3 z-10 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[e.jsx(k,{size:"sm",variant:"Edit",className:"h-8 w-8 p-0 bg-white/90 hover:bg-white shadow-md",onClick:()=>x(!0),children:e.jsx(fa,{className:"h-4 w-4 text-primary-foreground"})}),e.jsxs(Fs,{children:[e.jsx(Ks,{asChild:!0,children:e.jsx(k,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0 bg-white/90 hover:bg-white shadow-md",disabled:r,children:e.jsx(we,{className:"h-4 w-4 text-destructive"})})}),e.jsxs(bs,{children:[e.jsxs(Ns,{children:[e.jsx(Es,{children:n.language==="ar"?"تأكيد الحذف":"Confirm Delete"}),e.jsx(As,{children:n.language==="ar"?`هل أنت متأكد من حذف وجبة "${j}"؟ لا يمكن التراجع عن هذا الإجراء.`:`Are you sure you want to delete "${j}"? This action cannot be undone.`})]}),e.jsxs(ws,{children:[e.jsx(Ss,{children:n.language==="ar"?"إلغاء":"Cancel"}),e.jsx(Cs,{onClick:y,className:"bg-red-600 hover:bg-red-700",children:n.language==="ar"?"حذف":"Delete"})]})]})]})]}),e.jsxs(Fe,{className:"p-0 relative",children:[e.jsx(ps.LazyLoadImage,{src:`${Is}/${s.food_img}`,alt:j,effect:"blur",className:"w-full h-48 object-cover"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"absolute bottom-2 left-2 bg-black/30 bg-blend-color-burn text-white px-2 py-1 rounded-full text-xs",children:`${s.food_kcal} ${a("meals_management.calories")}`}),e.jsx("div",{className:"absolute bottom-2 right-2 bg-black/30 bg-blend-color-burn text-white px-2 py-1 rounded-full text-xs",children:`${s.food_cookingtime} ${a("meals_management.minutes")}`})]})]}),e.jsxs(Te,{className:"p-4 flex-grow",children:[e.jsx(qe,{children:e.jsx(l,{className:"text-foreground text-lg font-medium",children:j})}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mt-2",children:[e.jsx(l,{variant:"para",children:`${a("meals_management.protein")}: ${s.food_protein}g`}),e.jsx(l,{variant:"para",children:`${a("meals_management.carbs")}: ${s.food_carbs}g`}),e.jsx(l,{variant:"para",children:`${a("meals_management.fat")}: ${s.food_fat}g`})]})]}),e.jsx(Ia,{className:"p-4 pt-0",children:e.jsxs(k,{onClick:()=>t(s),className:"w-full",children:[e.jsx(xt,{className:"mr-2 h-4 w-4"}),a("meals_management.view_details_button")]})})]}),e.jsx(Uo,{meal:s,open:c,onOpenChange:x,t:a,i18n:n})]})},Vo=({meal:s,open:t,onOpenChange:a,t:n,i18n:i})=>{if(!s)return null;const r=i.language==="ar"?s.food_nameAr:s.food_nameEn,c=i.language==="ar"?s.food_preparationAr:s.food_preparationEn,x=i.language==="ar"?s.food_ingredientsAr:s.food_ingredientsEn,p=i.language==="ar"?s.food_noteAr:s.food_noteEn;return console.log("meal",s),e.jsx(me,{open:t,onOpenChange:a,children:e.jsxs(ue,{className:"max-w-2xl",children:[e.jsxs(ye,{children:[e.jsx(xe,{className:"text-start pt-5",children:e.jsx(l,{variant:"md",children:r})}),e.jsx(Ie,{children:e.jsxs(l,{variant:"p",children:[" ",c]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsx("img",{src:`${Is}/${s.food_img}`,alt:r,className:"rounded-lg object-cover w-full h-64"}),e.jsxs("div",{children:[e.jsx(l,{variant:"h2",className:"mb-2",children:n("details.nutrition_facts")}),e.jsxs("ul",{className:"flex flex-col gap-4",children:[e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsxs(l,{variant:"smallblack",children:[n("meals_management.calories"),":"]}),e.jsx(l,{variant:"para",children:s.food_kcal})]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsxs(l,{variant:"smallblack",children:[n("meals_management.protein"),":"]}),e.jsxs(l,{variant:"para",children:[s.food_protein,"g"]})]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsxs(l,{variant:"smallblack",children:[n("meals_management.carbs"),":"]}),e.jsxs(l,{variant:"para",children:[s.food_carbs,"g"]})]}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsxs(l,{variant:"smallblack",children:[n("meals_management.fat"),":"]}),e.jsxs(l,{variant:"para",children:[s.food_fat,"g"]})]}),e.jsxs("li",{className:"flex flex-col gap-1",children:[e.jsxs(l,{variant:"smallblack",children:[n("meals_management.note"),":"]}),e.jsx(l,{variant:"para",children:p})]})]}),e.jsx(l,{variant:"smallblack",className:"mt-4 mb-2",children:n("details.ingredients")}),e.jsx(l,{variant:"p",children:x})]})]}),e.jsx(be,{children:e.jsx(k,{onClick:()=>a(!1),variant:"outline",children:n("close")})})]})})},Bo=Ge({food_nameAr:B().min(1,{message:"Required"}),food_nameEn:B().min(1,{message:"Required"}),food_kcal:Ke().positive({message:"Must be > 0"}),food_protein:Ke().min(0,{message:"Must be >= 0"}),food_fat:Ke().min(0,{message:"Must be >= 0"}),food_carbs:Ke().min(0,{message:"Must be >= 0"}),food_cookingtime:Ke().min(0,{message:"Must be >= 0"}),food_noteEn:B().min(1,{message:"Required"}),food_noteAr:B().min(1,{message:"Required"}),food_ingredientsEn:B().min(1,{message:"Required"}),food_ingredientsAr:B().min(1,{message:"Required"}),food_preparationEn:B().min(1,{message:"Required"}),food_preparationAr:B().min(1,{message:"Required"}),food_diettype_id:B().min(1,{message:"Required"}),food_img:Je().refine(s=>s instanceof File,{message:"Image is required"}).refine(s=>["image/png","image/jpeg","image/jpg"].includes(s.type),{message:"Only PNG, JPEG, and JPG images are allowed. WebP and SVG are not supported."}).refine(s=>s.size<=5*1024*1024,{message:"Image size must be less than 5MB"})}),Ho=({open:s,onOpenChange:t,t:a,i18n:n})=>{const{data:i,isLoading:r}=Ds(),{mutate:c,isPending:x}=vl(),[p,o]=d.useState(null),j=Ve({resolver:Be(Bo),defaultValues:{food_nameAr:"",food_nameEn:"",food_kcal:"",food_protein:"",food_fat:"",food_carbs:"",food_cookingtime:"",food_noteEn:"",food_noteAr:"",food_ingredientsEn:"",food_ingredientsAr:"",food_preparationEn:"",food_preparationAr:"",food_diettype_id:"",food_img:void 0}}),y=f=>{const _=new FormData;_.append("food_nameAr",f.food_nameAr),_.append("food_nameEn",f.food_nameEn),_.append("food_kcal",String(f.food_kcal)),_.append("food_protein",String(f.food_protein)),_.append("food_fat",String(f.food_fat)),_.append("food_carbs",String(f.food_carbs)),_.append("food_cookingtime",String(f.food_cookingtime)),_.append("food_noteEn",f.food_noteEn),_.append("food_noteAr",f.food_noteAr),_.append("food_ingredientsEn",f.food_ingredientsEn),_.append("food_ingredientsAr",f.food_ingredientsAr),_.append("food_preparationEn",f.food_preparationEn),_.append("food_preparationAr",f.food_preparationAr),_.append("food_diettype_id",f.food_diettype_id),_.append("food_img",f.food_img,f.food_img.name),c(_,{onSuccess:()=>{G.success(n?.language==="ar"?"تمت إضافة الوجبة بنجاح":"Meal added successfully"),t(!1),j.reset(),o(null)},onError:q=>{G.error(n?.language==="ar"?"فشل في إضافة الوجبة":"Failed to add meal"),console.error(q)}})},g=(f,_)=>n?.language==="ar"?f:_;return e.jsx(me,{className:"overflow-y-scroll h-64",open:s,onOpenChange:f=>{t(f),f||(j.reset(),o(null))},children:e.jsxs(ue,{className:"sm:max-w-[600px] pt-10 max-h-[90vh] overflow-y-auto ",children:[e.jsxs(ye,{children:[e.jsx(xe,{className:"text-start",children:g("إضافة وجبة","Add Meal")}),e.jsx(Ie,{className:"text-start",children:g("املأ جميع الحقول التالية لإضافة وجبة جديدة","Fill all fields to add a new meal")})]}),e.jsx(Xe,{...j,children:e.jsxs("form",{onSubmit:j.handleSubmit(y),className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{control:j.control,name:"food_nameAr",render:({field:f})=>e.jsxs(O,{children:[e.jsx(V,{children:g("اسم الوجبة (ع)","Meal name (Ar)")}),e.jsx(U,{children:e.jsx(F,{placeholder:g("مثال: سلطة","e.g., سلطة"),...f})}),e.jsx(R,{})]})}),e.jsx(P,{control:j.control,name:"food_nameEn",render:({field:f})=>e.jsxs(O,{children:[e.jsx(V,{children:g("اسم الوجبة (En)","Meal name (En)")}),e.jsx(U,{children:e.jsx(F,{placeholder:"e.g., Salad",...f})}),e.jsx(R,{})]})}),e.jsx(P,{control:j.control,name:"food_kcal",render:({field:f})=>e.jsxs(O,{children:[e.jsx(V,{children:g("السعرات الحرارية","Calories (kcal)")}),e.jsx(U,{children:e.jsx(F,{type:"number",step:"0.1",...f})}),e.jsx(R,{})]})}),e.jsx(P,{control:j.control,name:"food_protein",render:({field:f})=>e.jsxs(O,{children:[e.jsx(V,{children:g("البروتين (غم)","Protein (g)")}),e.jsx(U,{children:e.jsx(F,{type:"number",step:"0.1",...f})}),e.jsx(R,{})]})}),e.jsx(P,{control:j.control,name:"food_fat",render:({field:f})=>e.jsxs(O,{children:[e.jsx(V,{children:g("الدهون (غم)","Fat (g)")}),e.jsx(U,{children:e.jsx(F,{type:"number",step:"0.1",...f})}),e.jsx(R,{})]})}),e.jsx(P,{control:j.control,name:"food_carbs",render:({field:f})=>e.jsxs(O,{children:[e.jsx(V,{children:g("الكربوهيدرات (غم)","Carbs (g)")}),e.jsx(U,{children:e.jsx(F,{type:"number",step:"0.1",...f})}),e.jsx(R,{})]})}),e.jsx(P,{control:j.control,name:"food_cookingtime",render:({field:f})=>e.jsxs(O,{children:[e.jsx(V,{children:g("وقت الطبخ (دقيقة)","Cooking time (min)")}),e.jsx(U,{children:e.jsx(F,{type:"number",step:"1",...f})}),e.jsx(R,{})]})}),e.jsx(P,{control:j.control,name:"food_diettype_id",render:({field:f})=>e.jsxs(O,{children:[e.jsx(V,{children:g("نوع الحمية","Diet type")}),e.jsx(U,{children:e.jsxs(ze,{onValueChange:f.onChange,value:f.value,children:[e.jsx(Oe,{className:"w-full",children:e.jsx(Ue,{placeholder:g("اختر نوع الحمية","Select diet type")})}),e.jsx(Le,{children:!r&&i?.data?.map(_=>e.jsx(Ce,{value:_.diettype_id.toString(),children:n?.language==="ar"?_.diettype_titleAr:_.diettype_titleEn},_.diettype_id))})]})}),e.jsx(R,{})]})}),e.jsx(P,{control:j.control,name:"food_noteAr",render:({field:f})=>e.jsxs(O,{className:"md:col-span-2",children:[e.jsx(V,{children:g("ملاحظات (ع)","Notes (Ar)")}),e.jsx(U,{children:e.jsx(_e,{rows:2,...f})}),e.jsx(R,{})]})}),e.jsx(P,{control:j.control,name:"food_noteEn",render:({field:f})=>e.jsxs(O,{className:"md:col-span-2",children:[e.jsx(V,{children:g("ملاحظات (En)","Notes (En)")}),e.jsx(U,{children:e.jsx(_e,{rows:2,...f})}),e.jsx(R,{})]})}),e.jsx(P,{control:j.control,name:"food_ingredientsAr",render:({field:f})=>e.jsxs(O,{className:"md:col-span-2",children:[e.jsx(V,{children:g("المكونات (ع)","Ingredients (Ar)")}),e.jsx(U,{children:e.jsx(_e,{rows:3,...f})}),e.jsx(R,{})]})}),e.jsx(P,{control:j.control,name:"food_ingredientsEn",render:({field:f})=>e.jsxs(O,{className:"md:col-span-2",children:[e.jsx(V,{children:g("المكونات (En)","Ingredients (En)")}),e.jsx(U,{children:e.jsx(_e,{rows:3,...f})}),e.jsx(R,{})]})}),e.jsx(P,{control:j.control,name:"food_preparationAr",render:({field:f})=>e.jsxs(O,{className:"md:col-span-2",children:[e.jsx(V,{children:g("طريقة التحضير (Ar)","Preparation (Ar)")}),e.jsx(U,{children:e.jsx(_e,{rows:3,...f})}),e.jsx(R,{})]})}),e.jsx(P,{control:j.control,name:"food_preparationEn",render:({field:f})=>e.jsxs(O,{className:"md:col-span-2",children:[e.jsx(V,{children:g("طريقة التحضير (En)","Preparation (En)")}),e.jsx(U,{children:e.jsx(_e,{rows:3,...f})}),e.jsx(R,{})]})}),e.jsx(P,{control:j.control,name:"food_img",render:({field:f})=>e.jsxs(O,{className:"md:col-span-2",children:[e.jsx(l,{variant:"p",className:"text-sm font-medium",children:g("صورة الوجبة","Meal image")}),e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors",children:[p?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:p,alt:"preview",className:"w-full h-full object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>{f.onChange(void 0),o(null)},className:"absolute top-2 right-2 bg-destructive text-white rounded-full p-1 hover:bg-destructive/90 transition-colors",children:e.jsx(ve,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(ms,{className:"w-8 h-8 mb-2 text-gray-400"}),e.jsx(l,{variant:"para",className:"text-sm text-gray-500",children:g("انقر للرفع","Click to upload")}),e.jsx(l,{variant:"para",className:"text-xs text-gray-400",children:g("يدعم صور PNG/JPG فقط","PNG/JPG only supported")})]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/png,image/jpeg,image/jpg",onChange:_=>{const q=_.target.files?.[0];q&&(f.onChange(q),o(URL.createObjectURL(q)))}})]})}),e.jsx(R,{})]})}),e.jsxs(be,{className:"md:col-span-2 mt-4",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:x,children:g("إلغاء","Cancel")}),e.jsx(k,{type:"submit",disabled:x,children:x?g("جارٍ الحفظ...","Saving..."):g("حفظ","Save")})]})]})})]})})},Ko=()=>{const{t:s,i18n:t}=re(),{data:a,isLoading:n,isError:i}=Ma(),{data:r,isLoading:c}=Ds(),[x,p]=d.useState(""),[o,j]=d.useState("all"),[y,g]=d.useState(null),[f,_]=d.useState(!1),[q,b]=d.useState(!1),h=v=>{g(v),_(!0)},m=d.useMemo(()=>a?a.filter(v=>{const A=v.food_nameAr||"",I=v.food_nameEn||"",S=A.toLowerCase().includes(x.toLowerCase())||I.toLowerCase().includes(x.toLowerCase());if(o==="all")return S;const M=(v.food_diettype_id?String(v.food_diettype_id).split(",").map($=>$.trim()):[]).includes(String(o));return S&&M}):[],[a,x,o]),u=()=>n?e.jsx("div",{className:"h-screen  ",children:e.jsx($e,{})}):i?e.jsxs("div",{className:"text-center py-10",children:[e.jsx(l,{variant:"h2",children:s("error.title")}),e.jsx(l,{variant:"para",children:s("error.fetch_failed")})]}):m.length===0?e.jsxs("div",{className:"text-center py-10",children:[e.jsx(l,{variant:"h2",children:s("no_results.title")}),e.jsx(l,{variant:"para",children:s("no_results.description")})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4  gap-6",children:m.map(v=>e.jsx(Go,{meal:v,onSelectMeal:h,t:s,i18n:t},v.food_id))});return e.jsxs("div",{className:"relative min-h-screen bg-background",children:[e.jsx("header",{className:"fixed pt-12 pb-8 lg:pt-6 lg:pb-6 top-0 z-30 bg-background/95 backdrop-blur-sm left-0 right-0 shadow-sm lg:ltr:left-66 lg:rtl:right-66 lg:w-[calc(100%-300px)] w-full",children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6 lg:gap-8",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx(l,{variant:"h2",className:"font-semibold",children:s("meals_management.title")}),!n&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary/10 text-primary",children:[m.length," ",s("meals_management.meals_count")]})]}),e.jsx(l,{variant:"p",children:s("meals_management.description")})]}),e.jsxs("div",{className:"flex flex-row  sm:items-center gap-3 lg:gap-4 min-w-0 lg:flex-shrink-0",children:[e.jsxs(ze,{onValueChange:j,defaultValue:"all",children:[e.jsx(Oe,{className:"w-full sm:w-[180px] h-10",children:e.jsx(Ue,{placeholder:s("meals_management.filter_by_diet")})}),e.jsxs(Le,{children:[e.jsx(Ce,{value:"all",children:s("meals_management.all_diets")}),!c&&r?.data?.map(v=>e.jsx(Ce,{value:v.diettype_id.toString(),children:t.language==="ar"?v.diettype_titleAr:v.diettype_titleEn},v.diettype_id))]})]}),e.jsxs(k,{className:"gap-2 h-10 px-4",onClick:()=>b(!0),children:[e.jsx(Pe,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:s("meals_management.add_meal_button")})]})]}),e.jsxs("div",{className:"relative flex-1 sm:flex-initial",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(F,{type:"text",placeholder:s("meals_management.search_placeholder"),value:x,onChange:v=>p(v.target.value),className:"pl-10 pr-4 h-10 w-full sm:w-64"})]})]})})}),e.jsx("main",{className:"pt-32 lg:pt-36 px-4 sm:px-6 lg:px-8 pb-8",children:e.jsx("div",{className:"container mx-auto",children:u()})}),e.jsx(Vo,{meal:y,open:f,onOpenChange:_,t:s,i18n:t}),e.jsx(Ho,{open:q,onOpenChange:b,t:s,i18n:t})]})},Wo=({...s})=>{const{theme:t="system"}=jr();return e.jsx(yr,{theme:t,className:"toaster group",style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...s})};function Qo(){return ie({queryKey:["all-equipments"],queryFn:()=>Js(),staleTime:10*60*1e3,cacheTime:30*60*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1,retry:3,retryDelay:s=>Math.min(1e3*2**s,3e4)})}function Yo(){const s=pe();return de({mutationFn:vo,onSuccess:()=>{s.invalidateQueries(["all-equipments"])},onError:t=>{console.error("Error inserting equipment:",t)}})}function Zo(){const s=pe();return de({mutationFn:_o,onSuccess:()=>{s.invalidateQueries(["all-equipments"])},onError:t=>{console.error("Error deleting equipment:",t)}})}function Jo(){const s=pe();return de({mutationFn:bo,onSuccess:()=>{s.invalidateQueries(["all-equipments"])},onError:t=>{console.error("Error updating equipment:",t)}})}const Xo=({isOpen:s,onClose:t,onSubmit:a,isLoading:n})=>{const{t:i,i18n:r}=re(),c=r.language==="ar",[x,p]=d.useState({equipments_nameAr:"",equipments_nameEn:"",equipments_price:"",equipments_url:"",equipments_img:null}),[o,j]=d.useState({}),y=(h,m)=>{p(u=>({...u,[h]:m})),o[h]&&j(u=>({...u,[h]:""}))},g=h=>{p(m=>({...m,equipments_img:h})),o.equipments_img&&j(m=>({...m,equipments_img:""}))},f=()=>{const h={};return x.equipments_nameAr.trim()||(h.equipments_nameAr=i("equipment_management.add_modal.name_ar_required")),x.equipments_nameEn.trim()||(h.equipments_nameEn=i("equipment_management.add_modal.name_en_required")),!x.equipments_price&&x.equipments_price!=="0"?h.equipments_price=i("equipment_management.add_modal.price_required"):(isNaN(x.equipments_price)||x.equipments_price<0)&&(h.equipments_price=i("equipment_management.add_modal.price_invalid")),x.equipments_img||(h.equipments_img=i("equipment_management.add_modal.image_required")),j(h),Object.keys(h).length===0},_=h=>{if(h.preventDefault(),!f())return;const m=new FormData;m.append("equipments_nameAr",x.equipments_nameAr.trim()),m.append("equipments_nameEn",x.equipments_nameEn.trim()),m.append("equipments_price",parseFloat(x.equipments_price)),m.append("equipments_url",x.equipments_url.trim()),m.append("equipments_img",x.equipments_img),a(m)},q=()=>{p({equipments_nameAr:"",equipments_nameEn:"",equipments_price:"",equipments_url:"",equipments_img:null}),j({})},b=()=>{q(),t()};return e.jsx(me,{open:s,onOpenChange:b,children:e.jsxs(ue,{className:"max-w-md max-h-[90vh] overflow-y-auto",dir:c?"rtl":"ltr",children:[e.jsx(ye,{children:e.jsxs(xe,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(ys,{className:"w-5 h-5 text-primary"})}),i("equipment_management.add_modal.title")]})}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ts,{className:`w-4 h-4 inline ${c?"ml-2":"mr-2"}`}),i("equipment_management.add_modal.name_ar_label")," *"]}),e.jsx(F,{value:x.equipments_nameAr,onChange:h=>y("equipments_nameAr",h.target.value),placeholder:i("equipment_management.add_modal.name_ar_placeholder"),className:o.equipments_nameAr?"border-red-500":""}),o.equipments_nameAr&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:o.equipments_nameAr})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ts,{className:`w-4 h-4 inline ${c?"ml-2":"mr-2"}`}),i("equipment_management.add_modal.name_en_label")," *"]}),e.jsx(F,{value:x.equipments_nameEn,onChange:h=>y("equipments_nameEn",h.target.value),placeholder:i("equipment_management.add_modal.name_en_placeholder"),className:o.equipments_nameEn?"border-red-500":""}),o.equipments_nameEn&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:o.equipments_nameEn})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Qe,{className:`w-4 h-4 inline ${c?"ml-2":"mr-2"}`}),i("equipment_management.add_modal.price_label")," *"]}),e.jsx(F,{type:"number",min:"0",step:"0.01",value:x.equipments_price,onChange:h=>y("equipments_price",h.target.value),placeholder:i("equipment_management.add_modal.price_placeholder"),className:o.equipments_price?"border-red-500":""}),o.equipments_price&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:o.equipments_price}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i("equipment_management.add_modal.price_hint")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Xt,{className:`w-4 h-4 inline ${c?"ml-2":"mr-2"}`}),i("equipment_management.add_modal.url_label")]}),e.jsx(F,{type:"url",value:x.equipments_url,onChange:h=>y("equipments_url",h.target.value),placeholder:i("equipment_management.add_modal.url_placeholder")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[i("equipment_management.add_modal.image_label")," *"]}),e.jsx(bt,{value:x.equipments_img,onChange:g,labelText:{ar:"انقر لتحميل صورة المعدة",en:"Click to upload equipment image"}}),o.equipments_img&&e.jsx("p",{className:"text-red-500 text-xs mt-2",children:o.equipments_img})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(k,{type:"submit",disabled:n,className:"flex-1",children:i(n?"equipment_management.add_modal.submitting_button":"equipment_management.add_modal.submit_button")}),e.jsx(k,{type:"button",variant:"outline",onClick:b,disabled:n,children:i("equipment_management.add_modal.cancel_button")})]})]})]})})},ec=({isOpen:s,onClose:t,onConfirm:a,equipment:n,isLoading:i})=>{const{t:r,i18n:c}=re(),x=c.language==="ar";return n?e.jsx(me,{open:s,onOpenChange:t,children:e.jsxs(ue,{className:"max-w-md ",dir:x?"rtl":"ltr",children:[e.jsx(ye,{children:e.jsxs(xe,{className:"flex items-center rtl:pt-7 gap-3 text-destructive",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(Ze,{className:"w-5 h-5 text-destructive"})}),r("equipment_management.delete_modal.title")]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-lg overflow-hidden flex-shrink-0",children:n.equipments_img?e.jsx(ps.LazyLoadImage,{src:`${mt}/${n.equipments_img}`,alt:x?n.equipments_nameAr||"Equipment":n.equipments_nameEn||"Equipment",className:"w-full h-full object-cover",effect:"blur",placeholderSrc:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMTAiIGZpbGw9IiNjY2MiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5JbWFnZTwvdGV4dD48L3N2Zz4=",wrapperClassName:"w-full h-full"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-300",children:e.jsx(ys,{className:"w-6 h-6 text-gray-500"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{variant:"h2",children:x?n.equipments_nameAr||"Equipment":n.equipments_nameEn||"Equipment"}),e.jsx("p",{className:"text-sm text-gray-500",children:x?n.equipments_nameEn||"":n.equipments_nameAr||""}),e.jsx("p",{className:"text-sm text-accent-foreground font-medium",children:n.equipments_price===0||n.equipments_price===void 0?r("equipment_management.free"):`$${n.equipments_price}`})]})]}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ze,{className:"w-5 h-5 text-destructive flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-destructive mb-1",children:r("equipment_management.delete_modal.warning_title")}),e.jsx("p",{className:"text-sm text-destructive",children:r("equipment_management.delete_modal.warning_desc")})]})]})}),e.jsxs("div",{className:"text-center",children:[e.jsx(l,{variant:"md",children:r("equipment_management.delete_modal.confirm_question")}),e.jsx(l,{variant:"para",children:r("equipment_management.delete_modal.confirm_hint")})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(k,{variant:"destructive",onClick:a,disabled:i,className:"flex-1 flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),r(i?"equipment_management.delete_modal.deleting_button":"equipment_management.delete_modal.delete_button")]}),e.jsx(k,{variant:"outline",onClick:t,disabled:i,className:"flex-1",children:r("equipment_management.delete_modal.cancel_button")})]})]})]})}):null},sc=Ge({equipments_id:vr([B(),ot()]),equipments_nameAr:B().min(1,"الاسم العربي مطلوب"),equipments_nameEn:B().min(1,"الاسم الإنجليزي مطلوب"),equipments_price:B().min(1,"السعر مطلوب").refine(s=>!Number.isNaN(Number(s))&&Number(s)>=0,"سعر غير صالح"),equipments_url:B().optional().nullable(),equipments_img:Je().optional().nullable()});function tc({isOpen:s,onClose:t,initialData:a,onSubmit:n,isLoading:i}){const{i18n:r,t:c}=re(),x=r.language==="ar",p=d.useMemo(()=>({equipments_id:a?.equipments_id??"",equipments_nameAr:a?.equipments_nameAr??"",equipments_nameEn:a?.equipments_nameEn??"",equipments_price:typeof a?.equipments_price=="number"?String(a?.equipments_price):a?.equipments_price??"",equipments_url:a?.equipments_url??"",equipments_img:null}),[a]),{register:o,handleSubmit:j,setValue:y,reset:g,formState:{errors:f},watch:_}=Ve({resolver:Be(sc),defaultValues:p});d.useEffect(()=>{s&&g(p)},[s,p,g]);const q=_("equipments_img"),b=m=>{y("equipments_img",m)},h=m=>{const u=new FormData;u.append("equipments_id",m.equipments_id),u.append("equipments_nameAr",m.equipments_nameAr.trim()),u.append("equipments_nameEn",m.equipments_nameEn.trim()),u.append("equipments_price",String(Number(m.equipments_price))),u.append("equipments_url",m.equipments_url??""),m.equipments_img instanceof File&&u.append("equipments_img",m.equipments_img),n(u)};return e.jsx(me,{open:s,onOpenChange:t,children:e.jsxs(ue,{className:"max-w-md max-h-[90vh] overflow-y-auto",dir:x?"rtl":"ltr",children:[e.jsx(ye,{children:e.jsxs(xe,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(ys,{className:"w-5 h-5 text-primary"})}),c("equipment_management.edit_modal.title","تعديل المعدة")]})}),e.jsxs("form",{onSubmit:j(h),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ts,{className:`w-4 h-4 inline ${x?"ml-2":"mr-2"}`}),c("equipment_management.add_modal.name_ar_label")," *"]}),e.jsx(F,{...o("equipments_nameAr"),placeholder:c("equipment_management.add_modal.name_ar_placeholder"),className:f.equipments_nameAr?"border-destructive":""}),f.equipments_nameAr&&e.jsx("p",{className:"text-destructive text-xs mt-1",children:f.equipments_nameAr.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ts,{className:`w-4 h-4 inline ${x?"ml-2":"mr-2"}`}),c("equipment_management.add_modal.name_en_label")," *"]}),e.jsx(F,{...o("equipments_nameEn"),placeholder:c("equipment_management.add_modal.name_en_placeholder"),className:f.equipments_nameEn?"border-destructive":""}),f.equipments_nameEn&&e.jsx("p",{className:"text-destructive text-xs mt-1",children:f.equipments_nameEn.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Qe,{className:`w-4 h-4 inline ${x?"ml-2":"mr-2"}`}),c("equipment_management.add_modal.price_label")," *"]}),e.jsx(F,{type:"number",min:"0",step:"0.01",...o("equipments_price"),placeholder:c("equipment_management.add_modal.price_placeholder"),className:f.equipments_price?"border-destructive":""}),f.equipments_price&&e.jsx("p",{className:"text-destructive text-xs mt-1",children:f.equipments_price.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c("equipment_management.add_modal.url_label")}),e.jsx(F,{type:"url",...o("equipments_url"),placeholder:c("equipment_management.add_modal.url_placeholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c("equipment_management.add_modal.image_label")}),e.jsx(bt,{value:q,onChange:b,defaultImage:a?.equipments_img_url||null,labelText:{ar:"انقر لتغيير الصورة",en:"Click to change image"}}),f.equipments_img&&e.jsx("p",{className:"text-red-500 text-xs mt-2",children:f.equipments_img.message})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(k,{type:"submit",disabled:i,className:"flex-1",children:i?c("equipment_management.edit_modal.saving_button","جارِ الحفظ..."):c("equipment_management.edit_modal.save_button","حفظ التعديلات")}),e.jsx(k,{type:"button",variant:"outline",onClick:t,disabled:i,children:c("equipment_management.add_modal.cancel_button")})]})]})]})})}function ac(){const{t:s,i18n:t}=re(),a=t.language==="ar",[n,i]=d.useState(""),[r,c]=d.useState(!1),[x,p]=d.useState(!1),[o,j]=d.useState(!1),[y,g]=d.useState(null),{data:f,isLoading:_,error:q}=Qo(),b=Yo(),h=Zo(),m=Jo(),u=f?.data?.filter(M=>M.equipments_nameAr.toLowerCase().includes(n.toLowerCase())||M.equipments_nameEn.toLowerCase().includes(n.toLowerCase()))||[],v=async M=>{try{await b.mutateAsync(M),G.success(s("equipment_management.toasts.add_success")),c(!1)}catch($){G.error(s("equipment_management.toasts.add_error")),console.error("Error adding equipment:",$)}},A=async()=>{if(!y){console.log("No equipment selected for deletion");return}try{await h.mutateAsync(y.equipments_id),G.success(s("equipment_management.toasts.delete_success")),p(!1),g(null)}catch(M){G.error(s("equipment_management.toasts.delete_error")),console.error("Error deleting equipment:",M)}},I=async M=>{try{await m.mutateAsync(M),G.success(s("equipment_management.toasts.update_success","تم تحديث المعدة بنجاح")),j(!1),g(null)}catch($){G.error(s("equipment_management.toasts.update_error","حدث خطأ أثناء التحديث")),console.error("Error updating equipment:",$)}},S=M=>{g(M),p(!0)},C=M=>{g(M),j(!0)};return _?e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx($e,{})}):q?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] text-center",children:[e.jsx(ys,{className:"w-16 h-16 text-gray-400 mb-4"}),e.jsx(l,{className:"text-xl font-semibold text-gray-600 mb-2",children:s("equipment_management.loading_error")}),e.jsx(l,{variant:"para",children:s("equipment_management.loading_error_desc")})]}):e.jsxs("div",{className:"space-y-6",dir:a?"rtl":"ltr",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-2xl font-bold text-gray-900 mb-2",children:s("equipment_management.title")}),e.jsx("p",{className:"text-gray-600",children:s("equipment_management.subtitle")})]}),e.jsxs(k,{onClick:()=>c(!0),className:"flex items-center gap-2",disabled:b.isPending,children:[e.jsx(Pe,{className:"w-4 h-4"}),s("equipment_management.add_equipment")]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ms,{className:`absolute ${a?"right-3":"left-3"} top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4`}),e.jsx(F,{placeholder:s("equipment_management.search_placeholder"),value:n,onChange:M=>i(M.target.value),className:a?"pr-10":"pl-10"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(pa,{className:"w-4 h-4"}),e.jsxs("span",{children:[s("equipment_management.total_count"),": ",u.length," ",s("equipment_management.equipment_count")]})]})]}),u.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(ys,{className:"w-16 h-16 text-gray-400 mb-4"}),e.jsx(l,{className:"text-xl font-semibold text-gray-600 mb-2",children:s(n?"equipment_management.no_results":"equipment_management.no_equipment")}),e.jsx("p",{className:"text-gray-500 mb-4",children:s(n?"equipment_management.no_results_desc":"equipment_management.no_equipment_desc")}),!n&&e.jsxs(k,{onClick:()=>c(!0),className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),s("equipment_management.add_first_equipment")]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:u.map(M=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-all duration-300 group",children:[e.jsxs("div",{className:"relative h-48 bg-gray-100 overflow-hidden",children:[e.jsx(ps.LazyLoadImage,{src:`${mt}/${M.equipments_img}`,alt:a?M.equipments_nameAr:M.equipments_nameEn,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",effect:"blur",placeholderSrc:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2Y3ZjdmNyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjE4IiBmaWxsPSIjY2NjIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+TG9hZGluZy4uLjwvdGV4dD48L3N2Zz4=",wrapperClassName:"w-full h-full",loading:"lazy"}),e.jsx("div",{className:`absolute top-3 ${a?"left-3":"right-3"} opacity-0 group-hover:opacity-100 transition-opacity duration-300`,children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{size:"sm",variant:"outline",onClick:()=>C(M),className:"w-8 h-8 p-0",disabled:m.isPending,children:e.jsx(We,{className:"w-4 h-4"})}),e.jsx(k,{size:"sm",variant:"destructive",onClick:()=>S(M),className:"w-8 h-8 p-0",disabled:h.isPending,children:e.jsx(we,{className:"w-4 h-4"})})]})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(l,{variant:"md",children:a?M.equipments_nameAr:M.equipments_nameEn}),e.jsx(l,{variant:"para",children:a?M.equipments_nameEn:M.equipments_nameAr})]}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4 text-accent-foreground"}),e.jsx("span",{className:"font-semibold text-accent-foreground",children:M.equipments_price===0?s("equipment_management.free"):`$${M.equipments_price}`})]}),M.equipments_url&&e.jsxs("a",{href:M.equipments_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-primary-foreground  text-sm transition-colors",children:[e.jsx(_r,{className:"w-3 h-3"}),s("equipment_management.link")]})]}),e.jsxs("div",{className:"text-xs text-gray-400 border-t pt-2",children:[s("equipment_management.equipment_id"),": #",M.equipments_id]})]})]},M.equipments_id))}),e.jsx(Xo,{isOpen:r,onClose:()=>c(!1),onSubmit:v,isLoading:b.isPending}),e.jsx(tc,{isOpen:o,onClose:()=>{j(!1),g(null)},onSubmit:I,isLoading:m.isPending,initialData:y?{...y,equipments_img_url:y?.equipments_img?`${mt}/${y.equipments_img}`:null}:null}),e.jsx(ec,{isOpen:x,onClose:()=>{p(!1),g(null)},onConfirm:A,equipment:y,isLoading:h.isPending})]})}function nc(s){return Ge({offers_titleEn:B().min(1,s("offers.validation.requiredEn")),offers_titleAr:B().min(1,s("offers.validation.requiredAr")),offers_price:B().min(1,s("offers.validation.requiredPrice")).refine(t=>!isNaN(parseFloat(t))&&parseFloat(t)>0,{message:s("offers.validation.invalidPrice")}),offers_discount:B().optional().refine(t=>t===""||!isNaN(parseFloat(t)),{message:s("offers.validation.invalidDiscount")})})}function rc({isOpen:s,onClose:t,offer:a}){const{t:n}=re(),i=si(),r=nc(n),{register:c,handleSubmit:x,setValue:p,reset:o,formState:{errors:j}}=Ve({resolver:Be(r),defaultValues:{offers_titleEn:"",offers_titleAr:"",offers_price:"",offers_discount:""}});d.useEffect(()=>{a&&s&&o({offers_titleEn:a.offers_titleEn||"",offers_titleAr:a.offers_titleAr||"",offers_price:a.offers_price?.toString()||"",offers_discount:a.offers_discount?.toString()||""})},[a,s,o]);const y=async g=>{if(!a){G.error(n("offers.errors.offerNotFound"));return}const f=parseFloat(g.offers_discount)===0?1e-7:parseFloat(g.offers_discount)||0,_={offers_id:a.offers_id,offers_titleEn:g.offers_titleEn,offers_titleAr:g.offers_titleAr,offers_price:parseFloat(g.offers_price),offers_discount:f};try{await i.mutateAsync(_),G.success(n("offers.toasts.updateSuccess")),t()}catch(q){G.error(n("offers.toasts.updateError")),console.error("Error updating offer:",q)}};return a?e.jsx(me,{open:s,onOpenChange:t,children:e.jsxs(ue,{className:"sm:max-w-md",children:[e.jsx(ye,{children:e.jsx(xe,{children:e.jsx(l,{className:"text-start",variant:"h2",children:n("offers.dialogs.edit.title")})})}),e.jsxs("form",{onSubmit:x(y),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{variant:"p",children:n("offers.fields.titleEn")}),e.jsx(F,{...c("offers_titleEn"),placeholder:n("offers.placeholders.titleEn"),disabled:!0}),j.offers_titleEn&&e.jsx("p",{className:"text-destructive text-sm",children:j.offers_titleEn.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{variant:"p",children:n("offers.fields.titleAr")}),e.jsx(F,{...c("offers_titleAr"),placeholder:n("offers.placeholders.titleAr"),disabled:!0}),j.offers_titleAr&&e.jsx("p",{className:"text-destructive text-sm",children:j.offers_titleAr.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{variant:"p",children:n("offers.fields.price")}),e.jsx(F,{type:"number",step:"0.01",min:"0",...c("offers_price"),placeholder:n("offers.placeholders.price")}),j.offers_price&&e.jsx("p",{className:"text-destructive text-sm",children:j.offers_price.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{variant:"p",children:n("offers.fields.discount")}),e.jsx(F,{type:"text",...c("offers_discount"),placeholder:n("offers.placeholders.discount")}),j.offers_discount&&e.jsx("p",{className:"text-destructive text-sm",children:j.offers_discount.message})]}),e.jsxs(be,{className:"gap-2",children:[e.jsx(k,{type:"button",variant:"outline",onClick:t,disabled:i.isPending,children:n("offers.actions.cancel")}),e.jsx(k,{type:"submit",disabled:i.isPending,children:i.isPending?n("offers.actions.updating"):n("offers.actions.update")})]})]})]})}):null}function ic({isOpen:s,onClose:t,offer:a}){const{t:n}=re(),i=ti(),r=async()=>{if(a)try{await i.mutateAsync(a.offers_id),G.success(n("offers.toasts.deleteSuccess")),t()}catch(c){G.error(n("offers.toasts.deleteError")),console.error("Error deleting offer:",c)}};return a?e.jsx(me,{open:s,onOpenChange:t,children:e.jsxs(ue,{className:"sm:max-w-md",children:[e.jsx(ye,{children:e.jsx(xe,{className:"rtl:pt-5 text-start",children:e.jsx(l,{variant:"md",children:n("offers.dialogs.delete.title")})})}),e.jsxs("div",{className:"py-2",children:[e.jsx(l,{variant:"p",children:n("offers.dialogs.delete.message",{title:a.offers_titleAr})}),e.jsx(l,{variant:"p",className:"mt-2 text-destructive",children:n("offers.dialogs.delete.warning")})]}),e.jsxs(be,{className:"gap-2",children:[e.jsx(k,{type:"button",variant:"outline",onClick:t,disabled:i.isPending,children:n("offers.actions.cancel")}),e.jsx(k,{variant:"destructive",onClick:r,disabled:i.isPending,children:i.isPending?n("offers.actions.deleting"):n("offers.actions.delete")})]})]})}):null}function lc({offers:s=[]}){const{t}=re(),a=s.length,n=s.reduce((r,c)=>r+(parseFloat(c.offers_discount)||0),0),i=s.filter(r=>parseFloat(r.offers_price)===0).length;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2  gap-4 mb-6",children:[e.jsx(je,{name:t("offers.stats.totalOffers"),number:a,icon:e.jsx(ys,{className:"w-5 h-5 text-primary"}),Text:t("offers.stats.freeCount",{count:i}),ColorOfText:"text-primary",bgText:"bg-primary/10",para:t("offers.stats.fromTotalOffers")}),e.jsx(je,{name:t("offers.stats.totalDiscounts"),number:`$${n.toFixed(2)}`,icon:e.jsx(ha,{className:"w-5 h-5 text-yellow-700"}),Text:t("offers.stats.discountLabel"),ColorOfText:"text-yellow-700",bgText:"bg-yellow-100",para:t("offers.stats.totalDiscountsDesc")})]})}function oc(){const{t:s,i18n:t}=re(),a=t?.language?.startsWith("ar"),[n,i]=d.useState(!1),[r,c]=d.useState(!1),[x,p]=d.useState(!1),[o,j]=d.useState(null),{data:y,isLoading:g,error:f}=Ws(),_=y?.data||[],q=m=>{j(m),c(!0)},b=m=>{const u=parseFloat(m)||0;return u===0?s("offers.free"):`$${u.toFixed(2)}`},h=(m,u)=>{const v=parseFloat(m)||0,A=parseFloat(u)||0,I=v-A;return I<=0?s("offers.free"):`$${I.toFixed(2)}`};return g?e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx($e,{})}):f?(G.error(s("offers.errors.loadingFailed")),e.jsx("div",{className:"text-center py-8",children:e.jsx(l,{variant:"p",className:"text-destructive",children:s("offers.errors.loadingFailed")})})):e.jsxs("div",{className:" space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx(l,{variant:"h2",className:"text-2xl font-bold",children:s("offers.page.headerTitle")}),e.jsx(l,{variant:"p",className:"mt-1",children:s("offers.page.headerSubtitle")})]})}),e.jsx(lc,{offers:_}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg ",children:[e.jsx("div",{className:"p-4 ",children:e.jsxs(l,{variant:"md",className:"font-semibold",children:[s("offers.table.list")," (",_.length,")"]})}),_.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Qe,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx(l,{variant:"md",className:"mb-2",children:s("offers.empty.title")}),e.jsx(l,{variant:"p",children:s("offers.empty.subtitle")}),e.jsxs(k,{onClick:()=>i(!0),children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),s("offers.actions.addOffer")]})]}):e.jsxs(Qs,{children:[e.jsx(Ys,{children:e.jsxs(is,{children:[e.jsx(fe,{children:s("offers.table.no")}),e.jsx(fe,{children:s("offers.table.title")}),e.jsx(fe,{children:s("offers.table.originalPrice")}),e.jsx(fe,{children:s("offers.table.discount")}),e.jsx(fe,{children:s("offers.table.finalPrice")}),e.jsx(fe,{children:s("common.actions")})]})}),e.jsx(Zs,{children:_.map((m,u)=>{const v=a?m.offers_titleAr:m.offers_titleEn;return e.jsxs(is,{children:[e.jsx(oe,{children:e.jsx(l,{variant:"p",children:u+1})}),e.jsx(oe,{children:e.jsx(l,{variant:"md",className:"font-medium",children:v})}),e.jsx(oe,{children:e.jsx(l,{variant:"p",children:b(m.offers_price)})}),e.jsx(oe,{children:e.jsx(l,{variant:"p",children:m.offers_discount>0?`$${parseFloat(m.offers_discount).toFixed(2)}`:s("offers.none")})}),e.jsx(oe,{children:e.jsx(l,{variant:"md",className:"font-semibold text-accent-foreground",children:h(m.offers_price,m.offers_discount)})}),e.jsx(oe,{children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx(k,{variant:"Edit",size:"sm",onClick:()=>q(m),children:e.jsx(We,{className:"w-3 h-3"})})})})]},m.offers_id)})})]})]}),e.jsx(rc,{isOpen:r,onClose:()=>{c(!1),j(null)},offer:o}),e.jsx(ic,{isOpen:x,onClose:()=>{p(!1),j(null)},offer:o})]})}async function cc(){try{return(await K.post(`${z}/api84818datafeedback/getDataFeedback`)).data}catch(s){throw s}}const dc=async s=>{if(!s)throw new Error("Feedback ID is required");try{const t=`${z}/api84818datafeedback/deleteDataFeedback`,{data:a}=await K.post(t,{feedbacks_id:s});return a}catch(t){throw console.error("❌ Error deleting feedback:",t),t}},mc=()=>ie({queryKey:["feedBack"],queryFn:()=>cc(),staleTime:5*60*1e3,cacheTime:10*60*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1,retry:3,retryDelay:s=>Math.min(1e3*2**s,3e4)}),uc=()=>{const s=pe();return de({mutationFn:t=>dc(t),onSuccess:(t,a)=>{s.setQueryData(["getFeedback"],n=>{if(!n)return n;const i=n.data?.filter(r=>r.feedbacks_id!==a);return{...n,data:i}})},onError:t=>{console.error("Error deleting feedback:",t)}})};function xc(){const{data:s,isLoading:t,isError:a}=mc(),[n,i]=d.useState(null),[r,c]=d.useState({isOpen:!1,feedbackId:null}),x=Me.language==="ar",{data:p,isLoading:o,isError:j}=Na(n?{field:"users_id",value:String(n)}:void 0,{enabled:!!n}),y=uc();if(t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx($e,{})});if(a)return e.jsx("div",{className:"flex justify-center items-center min-h-[200px]",children:e.jsx(l,{variant:"p",className:"text-destructive",children:"Failed to load feedbacks."})});const g=s?.data||[];if(!g.length)return e.jsx("div",{className:"flex justify-center items-center min-h-[200px]",children:e.jsx(l,{variant:"p",children:"No feedbacks found."})});const f=b=>{c({isOpen:!0,feedbackId:b})},_=()=>{y.mutate(r.feedbackId),c({isOpen:!1,feedbackId:null})},q=()=>{c({isOpen:!1,feedbackId:null})};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(l,{variant:"h2",children:x?"نظام الملاحظات":"Feedbacks"}),e.jsx(l,{variant:"p",children:x?"تابع ما يقوله عملاؤك عن تجربتهم معنا":"What our customers say about us"})]}),e.jsx("div",{className:"space-y-6 max-w-3xl mx-auto p-6",children:g.map(b=>{const h=new Date(b.feedbacks_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"2-digit"}),m=n===b.feedbacks_user_id;return e.jsxs("div",{className:`relative p-6 rounded-2xl border border-secondary/20 \r
             bg-white shadow-lg transition-all duration-300 hover:shadow-xl`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"w-5 h-5 text-primary"}),e.jsxs(l,{variant:"md",className:"font-semibold text-black",children:["User ID: ",b.feedbacks_user_id]}),e.jsx("button",{onClick:()=>i(m?null:b.feedbacks_user_id),className:"p-1 rounded-full hover:bg-secondary/20 transition-colors",children:e.jsx(ra,{size:20,className:`text-black transition-transform ${m?"rotate-180":""}`})})]}),e.jsxs("div",{className:"flex items-center gap-5 text-secondary text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ds,{size:14}),e.jsx(l,{variant:"secondary",children:h})]}),e.jsx(k,{variant:"Delete",onClick:()=>f(b.feedbacks_id),children:e.jsx(we,{})})]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-black/80",children:[e.jsx(Jt,{className:"w-5 h-5 text-primary mt-1"}),e.jsx(l,{variant:"para",className:"whitespace-pre-wrap leading-relaxed",children:b.feedbacks_body})]}),m&&e.jsxs("div",{className:`mt-4 p-4 rounded-xl border border-secondary/20 \r
                    bg-secondary/10 transition-all duration-300`,children:[o&&e.jsx(l,{className:"text-secondary",children:"Loading user..."}),j&&e.jsx(l,{className:"text-destructive",children:"Failed to load user info."}),p?.data?.[0]&&e.jsxs("div",{className:"space-y-2 text-black",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"w-5 h-5 text-primary"}),e.jsx(l,{variant:"md",className:"font-medium",children:p.data[0].users_name})]}),e.jsxs("div",{className:"flex items-center gap-2 text-secondary text-sm",children:[e.jsx(ds,{size:16}),e.jsxs(l,{children:[x?"آخر تسجيل دخول":"Last login",":"," ",new Date(p.data[0].last_log).toLocaleString()]})]})]})]})]},b.feedbacks_id)})}),r.isOpen&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-sm w-full space-y-4",children:[e.jsx(l,{variant:"h3",className:"text-center",children:x?"تأكيد الحذف":"Confirm Deletion"}),e.jsx(l,{variant:"p",className:"text-center",children:x?"هل أنت متأكد من حذف هذه الملاحظة؟":"Are you sure you want to delete this feedback?"}),e.jsxs("div",{className:"flex justify-between gap-4 mt-4",children:[e.jsx(k,{className:"w-1/2",onClick:q,children:x?"إلغاء":"Cancel"}),e.jsx(k,{className:"w-1/2",variant:"destructive",onClick:_,children:x?"حذف":"Delete"})]})]})})]})}function pc(){return e.jsxs("div",{className:"font-arabic",children:[e.jsxs(br,{children:[e.jsx(De,{path:"/",element:e.jsx(Rr,{})}),e.jsxs(De,{path:"dashboard",element:e.jsx(Mr,{children:e.jsx(Vr,{})}),children:[e.jsx(De,{index:!0,element:e.jsx(ci,{})}),e.jsx(De,{path:"trainees",element:e.jsx(Ol,{})}),e.jsx(De,{path:"finance",element:e.jsx(Ll,{})}),e.jsx(De,{path:"coupon",element:e.jsx(zl,{})}),e.jsx(De,{path:"Activites",element:e.jsx(so,{})}),e.jsx(De,{path:"training/:id",element:e.jsx(uo,{})}),e.jsx(De,{path:"training/:id/exercises/:exerciseId",element:e.jsx(Rt,{})}),e.jsx(De,{path:"exercises/:trainingId",element:e.jsx(Rt,{})}),e.jsx(De,{path:"challenges",element:e.jsx(To,{})}),e.jsx(De,{path:"StartYourMind",element:e.jsx($o,{})}),e.jsx(De,{path:"meals",element:e.jsx(Ko,{})}),e.jsx(De,{path:"equipments",element:e.jsx(ac,{})}),e.jsx(De,{path:"plans",element:e.jsx(oc,{})}),e.jsx(De,{path:"feedback",element:e.jsx(xc,{})})]})]}),e.jsx(Wo,{position:"bottom-right",theme:"light",richColors:!0,closeButton:!0})]})}const hc=new Nr;wr.createRoot(document.getElementById("root")).render(e.jsx(ke.StrictMode,{children:e.jsx(Er,{client:hc,children:e.jsx(Ar,{children:e.jsx(Ir,{children:e.jsx(pc,{})})})})}));
